<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Centosâ€”æ›´æ¢å›½å†…yumæº</title>
      <link href="/2020/03/10/Centos-%E6%9B%B4%E6%8D%A2%E5%9B%BD%E5%86%85yum%E6%BA%90/"/>
      <url>/2020/03/10/Centos-%E6%9B%B4%E6%8D%A2%E5%9B%BD%E5%86%85yum%E6%BA%90/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>redhat çš„æ›´æ–°åŒ…åªå¯¹æ³¨å†Œçš„ç”¨æˆ·ç”Ÿæ•ˆï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨æ›´æ”¹æˆCentOS çš„æ›´æ–°åŒ…ï¼ŒCentOSå‡ ä¹å’Œredhatæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æ— éœ€æ‹…å¿ƒè½¯ä»¶åŒ…æ˜¯å¦å¯å®‰è£…ï¼Œå®‰è£…ä¹‹åæ˜¯å¦æœ‰é—®é¢˜ã€‚</p><h2 id="æ£€æŸ¥æ˜¯å¦å®‰è£…yumåŒ…"><a href="#æ£€æŸ¥æ˜¯å¦å®‰è£…yumåŒ…" class="headerlink" title="æ£€æŸ¥æ˜¯å¦å®‰è£…yumåŒ…"></a>æ£€æŸ¥æ˜¯å¦å®‰è£…yumåŒ…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 ~]# rpm -qa |grep yum</span><br><span class="line">yum-metadata-parser-1.1.4-10.el7.x86_64</span><br><span class="line">yum-3.4.3-161.el7.centos.noarch</span><br><span class="line">yum-plugin-fastestmirror-1.1.31-50.el7.noarch</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤redhatè‡ªå¸¦çš„yumåŒ…"><a href="#åˆ é™¤redhatè‡ªå¸¦çš„yumåŒ…" class="headerlink" title="åˆ é™¤redhatè‡ªå¸¦çš„yumåŒ…"></a>åˆ é™¤redhatè‡ªå¸¦çš„yumåŒ…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 ~]# rpm -qa|grep yum|xargs rpm -e --nodeps</span><br></pre></td></tr></table></figure><h2 id="ä¸‹è½½yum-å®‰è£…åŒ…ï¼ˆæˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯163çš„ï¼‰"><a href="#ä¸‹è½½yum-å®‰è£…åŒ…ï¼ˆæˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯163çš„ï¼‰" class="headerlink" title="ä¸‹è½½yum å®‰è£…åŒ…ï¼ˆæˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯163çš„ï¼‰"></a>ä¸‹è½½yum å®‰è£…åŒ…ï¼ˆæˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯163çš„ï¼‰</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 ~]# cd /opt</span><br><span class="line">[root@elasticsearch-04 opt]# wget http://mirrors.163.com/centos/7/os/x86_64/Packages/python-iniparse-0.4-9.el7.noarch.rpm</span><br><span class="line">[root@elasticsearch-04 opt]# wget http://mirrors.163.com/centos/7/os/x86_64/Packages/python-urlgrabber-3.10-9.el7.noarch.rpm</span><br><span class="line">[root@elasticsearch-04 opt]# wget http://mirrors.163.com/centos/7/os/x86_64/Packages/yum-metadata-parser-1.1.4-10.el7.x86_64.rpm</span><br><span class="line">[root@elasticsearch-04 opt]# wget http://mirrors.163.com/centos/7/os/x86_64/Packages/yum-plugin-fastestmirror-1.1.31-52.el7.noarch.rpm</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…yum"><a href="#å®‰è£…yum" class="headerlink" title="å®‰è£…yum"></a>å®‰è£…yum</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 opt]# rpm -ivh *.rpm</span><br><span class="line">å‡†å¤‡ä¸­...                          ################################# [100%]</span><br><span class="line">è½¯ä»¶åŒ… python-urlgrabber-3.10-9.el7.noarch å·²ç»å®‰è£…</span><br><span class="line">è½¯ä»¶åŒ… python-iniparse-0.4-9.el7.noarch å·²ç»å®‰è£…</span><br><span class="line">[root@elasticsearch-04 opt]# rpm -ivh --force *.rpm</span><br><span class="line">--force å³ä½¿è¦†ç›–å±äºå…¶å®ƒåŒ…çš„æ–‡ä»¶ä¹Ÿå¼ºè¿«å®‰è£…</span><br><span class="line">--nodeps å¦‚æœè¯¥RPMåŒ…çš„å®‰è£…ä¾èµ–å…¶å®ƒåŒ…ï¼Œå³ä½¿å…¶å®ƒåŒ…æ²¡è£…ï¼Œä¹Ÿå¼ºè¿«å®‰è£…ã€‚</span><br><span class="line">å‡†å¤‡ä¸­...                          ################################# [100%]</span><br><span class="line">æ­£åœ¨å‡çº§/å®‰è£…...</span><br><span class="line">   1:yum-metadata-parser-1.1.4-10.el7 ################################# [ 20%]</span><br><span class="line">   2:python-urlgrabber-3.10-9.el7     ################################# [ 40%]</span><br><span class="line">   3:python-iniparse-0.4-9.el7        ################################# [ 60%]</span><br><span class="line">   4:yum-plugin-fastestmirror-1.1.31-5################################# [ 80%]</span><br><span class="line">   5:yum-3.4.3-163.el7.centos         ################################# [100%]</span><br></pre></td></tr></table></figure><h2 id="æ›´æ”¹yumåº“çš„åœ°å€-è¿™é‡Œä½¿ç”¨æˆ‘ä»¬å›½å†…è‡ªå·±çš„yumåº“"><a href="#æ›´æ”¹yumåº“çš„åœ°å€-è¿™é‡Œä½¿ç”¨æˆ‘ä»¬å›½å†…è‡ªå·±çš„yumåº“" class="headerlink" title="æ›´æ”¹yumåº“çš„åœ°å€,è¿™é‡Œä½¿ç”¨æˆ‘ä»¬å›½å†…è‡ªå·±çš„yumåº“"></a>æ›´æ”¹yumåº“çš„åœ°å€,è¿™é‡Œä½¿ç”¨æˆ‘ä»¬å›½å†…è‡ªå·±çš„yumåº“</h2><p>ç”±äºç½‘æ˜“çš„CentOSé•œåƒæºå¥½å¤šåŒ…ä¸èƒ½å®‰è£…ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„ã€‚é˜¿é‡Œäº‘Linuxå®‰è£…é•œåƒæºåœ°å€ï¼š<a href="http://mirrors.aliyun.com/" target="_blank" rel="noopener">http://mirrors.aliyun.com/</a></p><h3 id="å¤‡ä»½ä½ çš„åŸé•œåƒæ–‡ä»¶ï¼Œä»¥å…å‡ºé”™åå¯ä»¥æ¢å¤ã€‚"><a href="#å¤‡ä»½ä½ çš„åŸé•œåƒæ–‡ä»¶ï¼Œä»¥å…å‡ºé”™åå¯ä»¥æ¢å¤ã€‚" class="headerlink" title="å¤‡ä»½ä½ çš„åŸé•œåƒæ–‡ä»¶ï¼Œä»¥å…å‡ºé”™åå¯ä»¥æ¢å¤ã€‚"></a>å¤‡ä»½ä½ çš„åŸé•œåƒæ–‡ä»¶ï¼Œä»¥å…å‡ºé”™åå¯ä»¥æ¢å¤ã€‚</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 opt]# mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure><h3 id="ä¸‹è½½æ–°çš„CentOS-Base-repo-åˆ°-etc-yum-repos-d"><a href="#ä¸‹è½½æ–°çš„CentOS-Base-repo-åˆ°-etc-yum-repos-d" class="headerlink" title="ä¸‹è½½æ–°çš„CentOS-Base.repo åˆ°/etc/yum.repos.d/"></a>ä¸‹è½½æ–°çš„CentOS-Base.repo åˆ°/etc/yum.repos.d/</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 opt]# cd /etc/yum.repos.d/</span><br><span class="line">[root@elasticsearch-04 yum.repos.d]# ls</span><br><span class="line">CentOS-Base.repo</span><br><span class="line">[root@elasticsearch-04 yum.repos.d]# wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br></pre></td></tr></table></figure><h3 id="æ›´æ”¹CentOS-Media-repoä½¿å…¶ä¸ºä¸ç”Ÿæ•ˆ"><a href="#æ›´æ”¹CentOS-Media-repoä½¿å…¶ä¸ºä¸ç”Ÿæ•ˆ" class="headerlink" title="æ›´æ”¹CentOS-Media.repoä½¿å…¶ä¸ºä¸ç”Ÿæ•ˆ"></a>æ›´æ”¹CentOS-Media.repoä½¿å…¶ä¸ºä¸ç”Ÿæ•ˆ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 yum.repos.d]# vim CentOS-Base.repo </span><br><span class="line">enabled=0</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œyum-makecacheç”Ÿæˆç¼“å­˜"><a href="#è¿è¡Œyum-makecacheç”Ÿæˆç¼“å­˜" class="headerlink" title="è¿è¡Œyum makecacheç”Ÿæˆç¼“å­˜"></a>è¿è¡Œyum makecacheç”Ÿæˆç¼“å­˜</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 yum.repos.d]# yum clean all</span><br><span class="line">[root@elasticsearch-04 yum.repos.d]# yum makecache</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux_application </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux_application </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dockerâ€”nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜</title>
      <link href="/2020/03/09/docker-nextcloud%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E5%90%8C%E6%AD%A5%E7%BD%91%E7%9B%98/"/>
      <url>/2020/03/09/docker-nextcloud%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E5%90%8C%E6%AD%A5%E7%BD%91%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><code>nextcloud</code>æ˜¯ä¸€æ¬¾å¼€æºç§æœ‰äº‘æ–¹æ¡ˆï¼ŒGitHubå¼€æºåœ°å€ï¼š<a href="https://github.com/nextcloudï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ç”¨`nextcloud`æ¥æ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜ã€‚" target="_blank" rel="noopener">https://github.com/nextcloudï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ç”¨`nextcloud`æ¥æ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜ã€‚</a></p><p>ä¹‹å‰å°±æœ‰æ­å»ºç§æœ‰ç½‘ç›˜çš„éœ€æ±‚ï¼Œæ¯•ç«Ÿå›½å¤–ç½‘ç›˜å®¹é‡å°ï¼Œé€Ÿåº¦æ…¢ï¼Œå›½å†…ç›®å‰ä¹Ÿå°±åªæœ‰115å’Œç™¾åº¦äº‘åœ¨è‹Ÿå»¶æ®‹å–˜ï¼Œ115å·²æ˜¯åŠæ®‹ï¼Œç™¾åº¦äº‘é™é€Ÿä¸è¯´ï¼Œè¿˜ä¼šå°†å°å§å§å˜æˆ8ç§’æ•™è‚²ç‰‡ï¼Œå…ˆä¸è®ºè¿™ç§å·çª¥ä¸ªäººç½‘ç›˜éšç§çš„è¡Œä¸ºæ˜¯å¦è¿æ³•ï¼Œè¦çŸ¥é“ç™¾åº¦äº‘åˆ é™¤è¿™äº›ä¸œè¥¿çš„æ—¶å€™å¯æ²¡æœ‰å‘ŠçŸ¥ç”¨æˆ·ï¼Œæ›´ä¸ç”¨è¯´ä»»ä½•çš„æé†’å’Œäº¤æµäº†ï¼ŒæŠŠèµ„æ–™ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠä¸ªäººéšç§çš„èµ„æ–™æ”¾åœ¨ç™¾åº¦äº‘å®åœ¨æ˜¯æ”¾å¿ƒä¸ä¸‹ã€‚</p><p>æ€»çš„æ¥çœ‹ç›®å‰å…¬æœ‰ç½‘ç›˜å¤§éƒ½ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œä¹Ÿå°±å‚¬ç”Ÿäº†ä¸€å¤§æ‰¹å¼€æºç§æœ‰ç½‘ç›˜ï¼Œ<code>nextcloud</code>å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚</p><h2 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h2><ul><li>cenntos 7</li><li>2Gå†…å­˜, 2Må¸¦å®½(å¸¦å®½è¶Šå¤§, åŒæ­¥è¶Šæµç•…)</li></ul><h2 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 ~]# yum -y install docker</span><br><span class="line">[root@elasticsearch-04 ~]# systemctl start docker</span><br><span class="line">[root@elasticsearch-04 ~]# systemctl enable docker</span><br></pre></td></tr></table></figure><h2 id="è·å–nextcloudé•œåƒ-å®Œæˆç½‘ç›˜æ­å»º-ç»“æŸğŸ”š"><a href="#è·å–nextcloudé•œåƒ-å®Œæˆç½‘ç›˜æ­å»º-ç»“æŸğŸ”š" class="headerlink" title="è·å–nextcloudé•œåƒ, å®Œæˆç½‘ç›˜æ­å»º(ç»“æŸğŸ”š)"></a>è·å–nextcloudé•œåƒ, å®Œæˆç½‘ç›˜æ­å»º(ç»“æŸğŸ”š)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 html]# docker run -d -p 8080:80 nextcloud</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®ä¸»æœºipçš„8080ç«¯å£-ä¸ºç½‘ç›˜è®¾ç½®ç®¡ç†å‘˜åç§°å’Œå¯†ç "><a href="#è®¿é—®ä¸»æœºipçš„8080ç«¯å£-ä¸ºç½‘ç›˜è®¾ç½®ç®¡ç†å‘˜åç§°å’Œå¯†ç " class="headerlink" title="è®¿é—®ä¸»æœºipçš„8080ç«¯å£,ä¸ºç½‘ç›˜è®¾ç½®ç®¡ç†å‘˜åç§°å’Œå¯†ç "></a>è®¿é—®ä¸»æœºipçš„8080ç«¯å£,ä¸ºç½‘ç›˜è®¾ç½®ç®¡ç†å‘˜åç§°å’Œå¯†ç </h2><p>æ¯”å¦‚æˆ‘çš„vpsä¸»æœºipä¸º<code>172.17.120.14</code>, é‚£ä¹ˆæˆ‘è®¿é—®çš„å°±æ˜¯<code>172.17.120.14:8080</code></p><p><img src="01.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="è¿›å…¥ç½‘ç›˜å-å¯ä»¥è·å–å…¨å¹³å°çš„å®¢æˆ·ç«¯"><a href="#è¿›å…¥ç½‘ç›˜å-å¯ä»¥è·å–å…¨å¹³å°çš„å®¢æˆ·ç«¯" class="headerlink" title="è¿›å…¥ç½‘ç›˜å, å¯ä»¥è·å–å…¨å¹³å°çš„å®¢æˆ·ç«¯"></a>è¿›å…¥ç½‘ç›˜å, å¯ä»¥è·å–å…¨å¹³å°çš„å®¢æˆ·ç«¯</h2><p><img src="02.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><blockquote><ul><li>è‡³æ­¤ç½‘ç›˜å·²ç»æ­å»ºå®Œæˆï¼</li></ul></blockquote><h2 id="è‡ªç”±å­˜å–æ–‡ä»¶"><a href="#è‡ªç”±å­˜å–æ–‡ä»¶" class="headerlink" title="è‡ªç”±å­˜å–æ–‡ä»¶"></a>è‡ªç”±å­˜å–æ–‡ä»¶</h2><p>å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯ä¸Šä¼ å›¾ç‰‡, ä¹Ÿå¯ä»¥ç›´æ¥æ‹–æ‹½ä¸Šä¼ </p><p><img src="03.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><p><img src="04.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="æŠŠæ–‡ä»¶åˆ†äº«ç»™å¥½å‹"><a href="#æŠŠæ–‡ä»¶åˆ†äº«ç»™å¥½å‹" class="headerlink" title="æŠŠæ–‡ä»¶åˆ†äº«ç»™å¥½å‹"></a>æŠŠæ–‡ä»¶åˆ†äº«ç»™å¥½å‹</h2><p><img src="05.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="å®ç°åŒæ­¥ç›˜çš„åŠŸèƒ½-ç”¨webdriveè¿æ¥"><a href="#å®ç°åŒæ­¥ç›˜çš„åŠŸèƒ½-ç”¨webdriveè¿æ¥" class="headerlink" title="å®ç°åŒæ­¥ç›˜çš„åŠŸèƒ½(ç”¨webdriveè¿æ¥)"></a>å®ç°åŒæ­¥ç›˜çš„åŠŸèƒ½(ç”¨webdriveè¿æ¥)</h2><h3 id="ç‚¹å‡»å³ä¸‹è§’è®¾ç½®"><a href="#ç‚¹å‡»å³ä¸‹è§’è®¾ç½®" class="headerlink" title="ç‚¹å‡»å³ä¸‹è§’è®¾ç½®"></a>ç‚¹å‡»å³ä¸‹è§’è®¾ç½®</h3><p><img src="06.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h3 id="è·å–webdavåœ°å€"><a href="#è·å–webdavåœ°å€" class="headerlink" title="è·å–webdavåœ°å€"></a>è·å–webdavåœ°å€</h3><p><img src="07.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h3 id="macç›´æ¥æŒ‚è½½"><a href="#macç›´æ¥æŒ‚è½½" class="headerlink" title="macç›´æ¥æŒ‚è½½"></a>macç›´æ¥æŒ‚è½½</h3><p><img src="08.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h3 id="è¿æ¥æœåŠ¡å™¨"><a href="#è¿æ¥æœåŠ¡å™¨" class="headerlink" title="è¿æ¥æœåŠ¡å™¨"></a>è¿æ¥æœåŠ¡å™¨</h3><p><img src="09.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h3 id="è®¤è¯"><a href="#è®¤è¯" class="headerlink" title="è®¤è¯"></a>è®¤è¯</h3><p><img src="010.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h3 id="æŒ‚è½½æˆåŠŸ"><a href="#æŒ‚è½½æˆåŠŸ" class="headerlink" title="æŒ‚è½½æˆåŠŸ"></a>æŒ‚è½½æˆåŠŸ</h3><p><img src="011.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="å®¢æˆ·ç«¯è¿æ¥ã€‚transmitæ”¯æŒwebdavåè®®-å¯ä»¥è®©æˆ‘ä»¬åœ¨ç½‘ç»œçŠ¶å†µå¾ˆå·®çš„æƒ…å†µä¸‹-ä¹Ÿèƒ½è¿›è¡Œç¨³å®šåŒæ­¥"><a href="#å®¢æˆ·ç«¯è¿æ¥ã€‚transmitæ”¯æŒwebdavåè®®-å¯ä»¥è®©æˆ‘ä»¬åœ¨ç½‘ç»œçŠ¶å†µå¾ˆå·®çš„æƒ…å†µä¸‹-ä¹Ÿèƒ½è¿›è¡Œç¨³å®šåŒæ­¥" class="headerlink" title="å®¢æˆ·ç«¯è¿æ¥ã€‚transmitæ”¯æŒwebdavåè®®, å¯ä»¥è®©æˆ‘ä»¬åœ¨ç½‘ç»œçŠ¶å†µå¾ˆå·®çš„æƒ…å†µä¸‹,ä¹Ÿèƒ½è¿›è¡Œç¨³å®šåŒæ­¥"></a>å®¢æˆ·ç«¯è¿æ¥ã€‚transmitæ”¯æŒwebdavåè®®, å¯ä»¥è®©æˆ‘ä»¬åœ¨ç½‘ç»œçŠ¶å†µå¾ˆå·®çš„æƒ…å†µä¸‹,ä¹Ÿèƒ½è¿›è¡Œç¨³å®šåŒæ­¥</h2><p><img src="012.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="æ‰‹æœºè¿æ¥"><a href="#æ‰‹æœºè¿æ¥" class="headerlink" title="æ‰‹æœºè¿æ¥"></a>æ‰‹æœºè¿æ¥</h2><h3 id="è¾“å…¥ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç "><a href="#è¾“å…¥ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç " class="headerlink" title="è¾“å…¥ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç "></a>è¾“å…¥ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç </h3><p><img src="013.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><p><img src="014.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h3 id="è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç "><a href="#è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç " class="headerlink" title="è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç "></a>è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç </h3><p><img src="015.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h3 id="å¯ä»¥çœ‹åˆ°åˆšåˆšåœ¨æµè§ˆå™¨ä¸Šä¼ çš„å›¾ç‰‡"><a href="#å¯ä»¥çœ‹åˆ°åˆšåˆšåœ¨æµè§ˆå™¨ä¸Šä¼ çš„å›¾ç‰‡" class="headerlink" title="å¯ä»¥çœ‹åˆ°åˆšåˆšåœ¨æµè§ˆå™¨ä¸Šä¼ çš„å›¾ç‰‡"></a>å¯ä»¥çœ‹åˆ°åˆšåˆšåœ¨æµè§ˆå™¨ä¸Šä¼ çš„å›¾ç‰‡</h3><p><img src="016.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h3 id="æ‰‹æœºä¸Šä¼ å›¾ç‰‡"><a href="#æ‰‹æœºä¸Šä¼ å›¾ç‰‡" class="headerlink" title="æ‰‹æœºä¸Šä¼ å›¾ç‰‡"></a>æ‰‹æœºä¸Šä¼ å›¾ç‰‡</h3><p><img src="017.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h3 id="pcå¯ä»¥æŸ¥çœ‹æ‰‹æœºä¸Šä¼ çš„å›¾ç‰‡"><a href="#pcå¯ä»¥æŸ¥çœ‹æ‰‹æœºä¸Šä¼ çš„å›¾ç‰‡" class="headerlink" title="pcå¯ä»¥æŸ¥çœ‹æ‰‹æœºä¸Šä¼ çš„å›¾ç‰‡"></a>pcå¯ä»¥æŸ¥çœ‹æ‰‹æœºä¸Šä¼ çš„å›¾ç‰‡</h3><p><img src="018.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="è®°ç¬”è®°"><a href="#è®°ç¬”è®°" class="headerlink" title="è®°ç¬”è®°"></a>è®°ç¬”è®°</h2><p><img src="023.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="æ¢ç´¢æ’ä»¶"><a href="#æ¢ç´¢æ’ä»¶" class="headerlink" title="æ¢ç´¢æ’ä»¶"></a>æ¢ç´¢æ’ä»¶</h2><p>ç‚¹å‡»é¡µé¢å³ä¸Šè§’é½¿è½®å›¾æ ‡, å¯ä»¥å®‰è£…æ’ä»¶</p><p><img src="019.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><p><img src="020.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><p><img src="021.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><p><img src="022.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p>]]></content>
      
      
      <categories>
          
          <category> Linux_docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux_docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python-æ—¥å¿—å¤„ç†</title>
      <link href="/2020/03/09/python-%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/"/>
      <url>/2020/03/09/python-%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>æ—¥å¿—æ˜¯ä¸€ç§å¯ä»¥è¿½è¸ªæŸäº›è½¯ä»¶è¿è¡Œæ—¶æ‰€å‘ç”Ÿäº‹ä»¶çš„æ–¹æ³•ã€‚è½¯ä»¶å¼€å‘äººå‘˜å¯ä»¥å‘ä»–ä»¬çš„ä»£ç ä¸­è°ƒç”¨æ—¥å¿—è®°å½•ç›¸å…³çš„æ–¹æ³•æ¥è¡¨æ˜å‘ç”Ÿäº†æŸäº›äº‹æƒ…ã€‚ä¸€ä¸ªäº‹ä»¶å¯ä»¥ç”¨ä¸€ä¸ªå¯åŒ…å«å¯é€‰å˜é‡æ•°æ®çš„æ¶ˆæ¯æ¥æè¿°ã€‚æ­¤å¤–ï¼Œäº‹ä»¶ä¹Ÿæœ‰é‡è¦æ€§çš„æ¦‚å¿µï¼Œè¿™ä¸ªé‡è¦æ€§ä¹Ÿå¯ä»¥è¢«ç§°ä¸ºä¸¥é‡æ€§çº§åˆ«ï¼ˆlevelï¼‰ã€‚</p><h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><p>é€šè¿‡logçš„åˆ†æï¼Œå¯ä»¥æ–¹ä¾¿ç”¨æˆ·äº†è§£ç³»ç»Ÿæˆ–è½¯ä»¶ã€åº”ç”¨çš„è¿è¡Œæƒ…å†µï¼›å¦‚æœä½ çš„åº”ç”¨logè¶³å¤Ÿä¸°å¯Œï¼Œä¹Ÿå¯ä»¥åˆ†æä»¥å¾€ç”¨æˆ·çš„æ“ä½œè¡Œä¸ºã€ç±»å‹å–œå¥½ã€åœ°åŸŸåˆ†å¸ƒæˆ–å…¶ä»–æ›´å¤šä¿¡æ¯ï¼›å¦‚æœä¸€ä¸ªåº”ç”¨çš„logåŒæ—¶ä¹Ÿåˆ†äº†å¤šä¸ªçº§åˆ«ï¼Œé‚£ä¹ˆå¯ä»¥å¾ˆè½»æ˜“åœ°åˆ†æå¾—åˆ°è¯¥åº”ç”¨çš„å¥åº·çŠ¶å†µï¼ŒåŠæ—¶å‘ç°é—®é¢˜å¹¶å¿«é€Ÿå®šä½ã€è§£å†³é—®é¢˜ï¼Œè¡¥æ•‘æŸå¤±ã€‚<br>ç®€å•æ¥è®²å°±æ˜¯ï¼Œæˆ‘ä»¬é€šè¿‡è®°å½•å’Œåˆ†ææ—¥å¿—å¯ä»¥äº†è§£ä¸€ä¸ªç³»ç»Ÿæˆ–è½¯ä»¶ç¨‹åºè¿è¡Œæƒ…å†µæ˜¯å¦æ­£å¸¸ï¼Œä¹Ÿå¯ä»¥åœ¨åº”ç”¨ç¨‹åºå‡ºç°æ•…éšœæ—¶å¿«é€Ÿå®šä½é—®é¢˜ã€‚æ¯”å¦‚ï¼Œåšè¿ç»´çš„åŒå­¦ï¼Œåœ¨æ¥æ”¶åˆ°æŠ¥è­¦æˆ–å„ç§é—®é¢˜åé¦ˆåï¼Œè¿›è¡Œé—®é¢˜æ’æŸ¥æ—¶é€šå¸¸éƒ½ä¼šå…ˆå»çœ‹å„ç§æ—¥å¿—ï¼Œå¤§éƒ¨åˆ†é—®é¢˜éƒ½å¯ä»¥åœ¨æ—¥å¿—ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚å†æ¯”å¦‚ï¼Œåšå¼€å‘çš„åŒå­¦ï¼Œå¯ä»¥é€šè¿‡IDEæ§åˆ¶å°ä¸Šè¾“å‡ºçš„å„ç§æ—¥å¿—è¿›è¡Œç¨‹åºè°ƒè¯•ã€‚å¯¹äºè¿ç»´è€å¸æœºæˆ–è€…æœ‰ç»éªŒçš„å¼€å‘äººå‘˜ï¼Œå¯ä»¥å¿«é€Ÿçš„é€šè¿‡æ—¥å¿—å®šä½åˆ°é—®é¢˜çš„æ ¹æºã€‚å¯è§ï¼Œæ—¥å¿—çš„é‡è¦æ€§ä¸å¯å°è§‘ã€‚æ—¥å¿—çš„ä½œç”¨å¯ä»¥ç®€å•æ€»ç»“ä¸ºä»¥ä¸‹3ç‚¹ï¼š</p><ul><li>ç¨‹åºè°ƒè¯•</li><li>äº†è§£è½¯ä»¶ç¨‹åºè¿è¡Œæƒ…å†µï¼Œæ˜¯å¦æ­£å¸¸</li><li>è½¯ä»¶ç¨‹åºè¿è¡Œæ•…éšœåˆ†æä¸é—®é¢˜å®šä½</li></ul><p>å¦‚æœåº”ç”¨çš„æ—¥å¿—ä¿¡æ¯è¶³å¤Ÿè¯¦ç»†å’Œä¸°å¯Œï¼Œè¿˜å¯ä»¥ç”¨æ¥åšç”¨æˆ·è¡Œä¸ºåˆ†æï¼Œå¦‚ï¼šåˆ†æç”¨æˆ·çš„æ“ä½œè¡Œä¸ºã€ç±»å‹æ´—å¥½ã€åœ°åŸŸåˆ†å¸ƒä»¥åŠå…¶å®ƒæ›´å¤šçš„ä¿¡æ¯ï¼Œç”±æ­¤å¯ä»¥å®ç°æ”¹è¿›ä¸šåŠ¡ã€æé«˜å•†ä¸šåˆ©ç›Šã€‚</p><h2 id="Loggingå·¥ä½œæµç¨‹"><a href="#Loggingå·¥ä½œæµç¨‹" class="headerlink" title="Loggingå·¥ä½œæµç¨‹"></a>Loggingå·¥ä½œæµç¨‹</h2><h3 id="loggingæ¨¡å—ä½¿ç”¨è¿‡ç¨‹"><a href="#loggingæ¨¡å—ä½¿ç”¨è¿‡ç¨‹" class="headerlink" title="loggingæ¨¡å—ä½¿ç”¨è¿‡ç¨‹"></a>loggingæ¨¡å—ä½¿ç”¨è¿‡ç¨‹</h3><p>1.ç¬¬ä¸€æ¬¡å¯¼å…¥loggingæ¨¡å—æˆ–ä½¿ç”¨reloadå‡½æ•°é‡æ–°å¯¼å…¥loggingæ¨¡å—ï¼Œloggingæ¨¡å—ä¸­çš„ä»£ç å°†è¢«æ‰§è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å°†äº§ç”Ÿloggingæ—¥å¿—ç³»ç»Ÿçš„é»˜è®¤é…ç½®ã€‚</p><p>2.è‡ªå®šä¹‰é…ç½®(å¯é€‰)ã€‚loggingæ ‡å‡†æ¨¡å—æ”¯æŒä¸‰ç§é…ç½®æ–¹å¼: dictConfigï¼ŒfileConfigï¼Œlistenã€‚å…¶ä¸­ï¼ŒdictConfigæ˜¯é€šè¿‡ä¸€ä¸ªå­—å…¸è¿›è¡Œé…ç½®Loggerï¼ŒHandlerï¼ŒFilterï¼ŒFormatterï¼›fileConfigåˆ™æ˜¯é€šè¿‡ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œé…ç½®ï¼›è€Œlistenåˆ™ç›‘å¬ä¸€ä¸ªç½‘ç»œç«¯å£ï¼Œé€šè¿‡æ¥æ”¶ç½‘ç»œæ•°æ®æ¥è¿›è¡Œé…ç½®ã€‚å½“ç„¶ï¼Œé™¤äº†ä»¥ä¸Šé›†ä½“åŒ–é…ç½®å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨Loggerï¼ŒHandlerç­‰å¯¹è±¡ä¸­çš„æ–¹æ³•åœ¨ä»£ç ä¸­æ¥æ˜¾å¼é…ç½®ã€‚</p><p>3.ä½¿ç”¨loggingæ¨¡å—çš„å…¨å±€ä½œç”¨åŸŸä¸­çš„getLoggerå‡½æ•°æ¥å¾—åˆ°ä¸€ä¸ªLoggerå¯¹è±¡å®ä¾‹(å…¶å‚æ•°å³æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºLoggerå¯¹è±¡å®ä¾‹çš„åå­—ï¼Œå³é€šè¿‡è¯¥åå­—æ¥å¾—åˆ°ç›¸åº”çš„Loggerå¯¹è±¡å®ä¾‹)ã€‚</p><p>4.ä½¿ç”¨Loggerå¯¹è±¡ä¸­çš„debugï¼Œinfoï¼Œerrorï¼Œwarnï¼Œcriticalç­‰æ–¹æ³•è®°å½•æ—¥å¿—ä¿¡æ¯ã€‚</p><h3 id="loggingæ¨¡å—å¤„ç†æµç¨‹"><a href="#loggingæ¨¡å—å¤„ç†æµç¨‹" class="headerlink" title="loggingæ¨¡å—å¤„ç†æµç¨‹"></a>loggingæ¨¡å—å¤„ç†æµç¨‹</h3><p><img src="/Users/huqi/Desktop/å±å¹•å¿«ç…§ 2020-02-28 ä¸‹åˆ9.41.12.png" alt="å±å¹•å¿«ç…§ 2020-02-28 ä¸‹åˆ9.41.12"></p><p>1.åˆ¤æ–­æ—¥å¿—çš„ç­‰çº§æ˜¯å¦å¤§äºLoggerå¯¹è±¡çš„ç­‰çº§ï¼Œå¦‚æœå¤§äºï¼Œåˆ™å¾€ä¸‹æ‰§è¡Œï¼Œå¦åˆ™ï¼Œæµç¨‹ç»“æŸã€‚</p><p>2.äº§ç”Ÿæ—¥å¿—ã€‚ç¬¬ä¸€æ­¥ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å¼‚å¸¸ï¼Œå¦‚æœæœ‰ï¼Œåˆ™æ·»åŠ å¼‚å¸¸ä¿¡æ¯ã€‚ç¬¬äºŒæ­¥ï¼Œå¤„ç†æ—¥å¿—è®°å½•æ–¹æ³•(å¦‚debugï¼Œinfoç­‰)ä¸­çš„å ä½ç¬¦ï¼Œå³ä¸€èˆ¬çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–å¤„ç†ã€‚</p><p>3.ä½¿ç”¨æ³¨å†Œåˆ°Loggerå¯¹è±¡ä¸­çš„Filtersè¿›è¡Œè¿‡æ»¤ã€‚å¦‚æœæœ‰å¤šä¸ªè¿‡æ»¤å™¨ï¼Œåˆ™ä¾æ¬¡è¿‡æ»¤ï¼›åªè¦æœ‰ä¸€ä¸ªè¿‡æ»¤å™¨è¿”å›å‡ï¼Œåˆ™è¿‡æ»¤ç»“æŸï¼Œä¸”è¯¥æ—¥å¿—ä¿¡æ¯å°†ä¸¢å¼ƒï¼Œä¸å†å¤„ç†ï¼Œè€Œå¤„ç†æµç¨‹ä¹Ÿè‡³æ­¤ç»“æŸã€‚å¦åˆ™ï¼Œå¤„ç†æµç¨‹å¾€ä¸‹æ‰§è¡Œã€‚</p><p>4.åœ¨å½“å‰Loggerå¯¹è±¡ä¸­æŸ¥æ‰¾Handlersï¼Œå¦‚æœæ‰¾ä¸åˆ°ä»»ä½•Handlerï¼Œåˆ™å¾€ä¸Šåˆ°è¯¥Loggerå¯¹è±¡çš„çˆ¶Loggerä¸­æŸ¥æ‰¾ï¼›å¦‚æœæ‰¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªHandlerï¼Œåˆ™ä¾æ¬¡ç”¨Handleræ¥å¤„ç†æ—¥å¿—ä¿¡æ¯ã€‚ä½†åœ¨æ¯ä¸ªHandlerå¤„ç†æ—¥å¿—ä¿¡æ¯è¿‡ç¨‹ä¸­ï¼Œä¼šé¦–å…ˆåˆ¤æ–­æ—¥å¿—ä¿¡æ¯çš„ç­‰çº§æ˜¯å¦å¤§äºè¯¥Handlerçš„ç­‰çº§ï¼Œå¦‚æœå¤§äºï¼Œåˆ™å¾€ä¸‹æ‰§è¡Œ(ç”±Loggerå¯¹è±¡è¿›å…¥Handlerå¯¹è±¡ä¸­)ï¼Œå¦åˆ™ï¼Œå¤„ç†æµç¨‹ç»“æŸã€‚</p><p>5.æ‰§è¡ŒHandlerå¯¹è±¡ä¸­çš„filteræ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šä¾æ¬¡æ‰§è¡Œæ³¨å†Œåˆ°è¯¥Handlerå¯¹è±¡ä¸­çš„Filterã€‚å¦‚æœæœ‰ä¸€ä¸ªFilteråˆ¤æ–­è¯¥æ—¥å¿—ä¿¡æ¯ä¸ºå‡ï¼Œåˆ™æ­¤åçš„æ‰€æœ‰Filteréƒ½ä¸å†æ‰§è¡Œï¼Œè€Œç›´æ¥å°†è¯¥æ—¥å¿—ä¿¡æ¯ä¸¢å¼ƒï¼Œå¤„ç†æµç¨‹ç»“æŸã€‚</p><p>6.ä½¿ç”¨Formatterç±»æ ¼å¼åŒ–æœ€ç»ˆçš„è¾“å‡ºç»“æœã€‚ æ³¨ï¼šFormatteråŒä¸Šè¿°ç¬¬2æ­¥çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¸åŒï¼Œå®ƒä¼šæ·»åŠ é¢å¤–çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ—¥å¿—äº§ç”Ÿçš„æ—¶é—´ï¼Œäº§ç”Ÿæ—¥å¿—çš„æºä»£ç æ‰€åœ¨çš„æºæ–‡ä»¶çš„è·¯å¾„ç­‰ç­‰ã€‚</p><p>7.çœŸæ­£åœ°è¾“å‡ºæ—¥å¿—ä¿¡æ¯(åˆ°ç½‘ç»œï¼Œæ–‡ä»¶ï¼Œç»ˆç«¯ï¼Œé‚®ä»¶ç­‰)ã€‚è‡³äºè¾“å‡ºåˆ°å“ªä¸ªç›®çš„åœ°ï¼Œç”±Handlerçš„ç§ç±»æ¥å†³å®šã€‚</p><h2 id="æ—¥å¿—ç­‰çº§"><a href="#æ—¥å¿—ç­‰çº§" class="headerlink" title="æ—¥å¿—ç­‰çº§"></a>æ—¥å¿—ç­‰çº§</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">çº§åˆ«          æ—¥å¿—å‡½æ•°                 æè¿°</span><br><span class="line">DEBUG     logging.debug()     æœ€ä½çº§åˆ«ï¼Œè¿½è¸ªé—®é¢˜æ—¶ä½¿ç”¨</span><br><span class="line">INFO      logging.info()      è®°å½•ç¨‹åºä¸­ä¸€èˆ¬äº‹ä»¶çš„ä¿¡æ¯ï¼Œæˆ–ç¡®è®¤ä¸€åˆ‡å·¥ä½œæ­£å¸¸</span><br><span class="line">WARNING    logging.warning()    è®°å½•ä¿¡æ¯ï¼Œç”¨äºè­¦å‘Š</span><br><span class="line">ERROR      logging.error()      ç”¨äºè®°å½•ç¨‹åºæŠ¥é”™ä¿¡æ¯</span><br><span class="line">CRITICAL  logging.critical()  æœ€é«˜çº§åˆ«ï¼Œè®°å½•å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒçš„é”™è¯¯</span><br></pre></td></tr></table></figure><h2 id="æ—¥å¿—æ ¼å¼å…è®¸çš„å­—æ®µ"><a href="#æ—¥å¿—æ ¼å¼å…è®¸çš„å­—æ®µ" class="headerlink" title="æ—¥å¿—æ ¼å¼å…è®¸çš„å­—æ®µ"></a>æ—¥å¿—æ ¼å¼å…è®¸çš„å­—æ®µ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    æ ¼å¼                            æè¿°</span><br><span class="line">%(levelno)s                   æ‰“å°æ—¥å¿—çº§åˆ«çš„æ•°å€¼</span><br><span class="line">%(levelname)s                  æ‰“å°æ—¥å¿—çº§åˆ«åç§°</span><br><span class="line">%(pathname)s                  æ‰“å°å½“å‰æ‰§è¡Œç¨‹åºçš„è·¯å¾„</span><br><span class="line">%(filename)s                  æ‰“å°å½“å‰æ‰§è¡Œç¨‹åºåç§°</span><br><span class="line">%(funcName)s                  æ‰“å°æ—¥å¿—çš„å½“å‰å‡½æ•°</span><br><span class="line">%(lineno)d                    æ‰“å°æ—¥å¿—çš„å½“å‰è¡Œå·</span><br><span class="line">%(asctime)s                    æ‰“å°æ—¥å¿—çš„æ—¶é—´</span><br><span class="line">%(thread)d                    æ‰“å°çº¿ç¨‹id</span><br><span class="line">%(threadName)s                æ‰“å°çº¿ç¨‹åç§°</span><br><span class="line">%(process)d                    æ‰“å°è¿›ç¨‹ID</span><br><span class="line">%(message)s                    æ‰“å°æ—¥å¿—ä¿¡æ¯</span><br></pre></td></tr></table></figure><h2 id="ç®€å•åº”ç”¨"><a href="#ç®€å•åº”ç”¨" class="headerlink" title="ç®€å•åº”ç”¨"></a>ç®€å•åº”ç”¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.debug(<span class="string">'debug message'</span>)</span><br><span class="line">logging.info(<span class="string">'info message'</span>)</span><br><span class="line">logging.warning(<span class="string">'warning message'</span>)</span><br><span class="line">logging.error(<span class="string">'error message'</span>)</span><br><span class="line">logging.critical(<span class="string">'critical message'</span>)</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">WARNING:root:warning message</span><br><span class="line">ERROR:root:error message</span><br><span class="line">CRITICAL:root:critical message</span><br></pre></td></tr></table></figure><p>å¯è§ï¼Œé»˜è®¤æƒ…å†µä¸‹<a href="http://lib.csdn.net/base/11" target="_blank" rel="noopener">Python</a>çš„loggingæ¨¡å—å°†æ—¥å¿—æ‰“å°åˆ°äº†æ ‡å‡†è¾“å‡ºä¸­ï¼Œä¸”åªæ˜¾ç¤ºäº†å¤§äºç­‰äºWARNINGçº§åˆ«çš„æ—¥å¿—ï¼Œè¿™è¯´æ˜é»˜è®¤çš„æ—¥å¿—çº§åˆ«è®¾ç½®ä¸ºWARNINGï¼ˆæ—¥å¿—çº§åˆ«ç­‰çº§CRITICAL &gt; ERROR &gt; WARNING &gt; INFO &gt; DEBUG &gt; NOTSETï¼‰</p><h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®æ—¥å¿—æ ¼å¼</span></span><br><span class="line">fmt = <span class="string">'%(asctime)s %(levename)7.7s %(funcName)s: %(message)s'</span></span><br><span class="line">formatter = logging.Formatter(fmt, datefmt=<span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½® handler</span></span><br><span class="line">handler = logging.handlers.TimedRotatingFileHandler(<span class="string">'myapp.log'</span>,when=<span class="string">'D'</span>,backupCount=<span class="number">30</span>)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰ loggerå¯¹è±¡</span></span><br><span class="line">logger = logging.getLogger(<span class="string">"MyApp"</span>)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line">logger.setLevel(logging.INFO)</span><br></pre></td></tr></table></figure><h2 id="çµæ´»é…ç½®æ—¥å¿—æ ¼å¼ï¼ˆå¤šæ¬¡è¿è¡Œä¼šè¢«è¦†ç›–ï¼‰"><a href="#çµæ´»é…ç½®æ—¥å¿—æ ¼å¼ï¼ˆå¤šæ¬¡è¿è¡Œä¼šè¢«è¦†ç›–ï¼‰" class="headerlink" title="çµæ´»é…ç½®æ—¥å¿—æ ¼å¼ï¼ˆå¤šæ¬¡è¿è¡Œä¼šè¢«è¦†ç›–ï¼‰"></a>çµæ´»é…ç½®æ—¥å¿—æ ¼å¼ï¼ˆå¤šæ¬¡è¿è¡Œä¼šè¢«è¦†ç›–ï¼‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.basicConfig(level=logging.DEBUG,</span><br><span class="line">                    format=<span class="string">'%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s'</span>,</span><br><span class="line">                    datefmt=<span class="string">'%a, %d %b %Y %H:%M:%S'</span>,</span><br><span class="line">                    filename=<span class="string">'/root/log/test.log'</span>,</span><br><span class="line">                    filemode=<span class="string">'w'</span>)</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">'debug message'</span>)</span><br><span class="line">logging.info(<span class="string">'info message'</span>)</span><br><span class="line">logging.warning(<span class="string">'warning message'</span>)</span><br><span class="line">logging.error(<span class="string">'error message'</span>)</span><br><span class="line">logging.critical(<span class="string">'critical message'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test log]<span class="comment"># cat test.log </span></span><br><span class="line">Tue, <span class="number">25</span> Feb <span class="number">2020</span> <span class="number">14</span>:<span class="number">17</span>:<span class="number">41</span> <span class="number">2.</span>py[line:<span class="number">8</span>] DEBUG debug message</span><br><span class="line">Tue, <span class="number">25</span> Feb <span class="number">2020</span> <span class="number">14</span>:<span class="number">17</span>:<span class="number">41</span> <span class="number">2.</span>py[line:<span class="number">9</span>] INFO info message</span><br><span class="line">Tue, <span class="number">25</span> Feb <span class="number">2020</span> <span class="number">14</span>:<span class="number">17</span>:<span class="number">41</span> <span class="number">2.</span>py[line:<span class="number">10</span>] WARNING warning message</span><br><span class="line">Tue, <span class="number">25</span> Feb <span class="number">2020</span> <span class="number">14</span>:<span class="number">17</span>:<span class="number">41</span> <span class="number">2.</span>py[line:<span class="number">11</span>] ERROR error message</span><br><span class="line">Tue, <span class="number">25</span> Feb <span class="number">2020</span> <span class="number">14</span>:<span class="number">17</span>:<span class="number">41</span> <span class="number">2.</span>py[line:<span class="number">12</span>] CRITICAL critical message</span><br></pre></td></tr></table></figure><h2 id="loggingåº“Formatterç»„ä»¶"><a href="#loggingåº“Formatterç»„ä»¶" class="headerlink" title="loggingåº“Formatterç»„ä»¶"></a>loggingåº“Formatterç»„ä»¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger()</span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªhandlerï¼Œç”¨äºå†™å…¥æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">fh = logging.FileHandler(<span class="string">'test.log'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å†åˆ›å»ºä¸€ä¸ªhandlerï¼Œç”¨äºè¾“å‡ºåˆ°æ§åˆ¶å°</span></span><br><span class="line">ch = logging.StreamHandler()</span><br><span class="line"></span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line"></span><br><span class="line">fh.setFormatter(formatter)</span><br><span class="line">ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line">logger.addHandler(fh) <span class="comment">#loggerå¯¹è±¡å¯ä»¥æ·»åŠ å¤šä¸ªfhå’Œchå¯¹è±¡</span></span><br><span class="line">logger.addHandler(ch)</span><br><span class="line"></span><br><span class="line">logger.debug(<span class="string">'logger debug message'</span>)</span><br><span class="line">logger.info(<span class="string">'logger info message'</span>)</span><br><span class="line">logger.warning(<span class="string">'logger warning message'</span>)</span><br><span class="line">logger.error(<span class="string">'logger error message'</span>)</span><br><span class="line">logger.critical(<span class="string">'logger critical message'</span>)</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">14</span>:<span class="number">33</span>:<span class="number">10</span>,<span class="number">717</span> - root - WARNING - logger warning message</span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">14</span>:<span class="number">33</span>:<span class="number">10</span>,<span class="number">717</span> - root - ERROR - logger error message</span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">14</span>:<span class="number">33</span>:<span class="number">10</span>,<span class="number">717</span> - root - CRITICAL - logger critical message</span><br><span class="line">loggingåº“æä¾›äº†å¤šä¸ªç»„ä»¶ï¼šLoggerã€Handlerã€Filterã€Formatterã€‚Loggerå¯¹è±¡æä¾›åº”ç”¨ç¨‹åºå¯ç›´æ¥ä½¿ç”¨çš„æ¥å£ï¼ŒHandlerå‘é€æ—¥å¿—åˆ°é€‚å½“çš„ç›®çš„åœ°ï¼ŒFilteræä¾›äº†è¿‡æ»¤æ—¥å¿—ä¿¡æ¯çš„æ–¹æ³•ï¼ŒFormatteræŒ‡å®šæ—¥å¿—æ˜¾ç¤ºæ ¼å¼ã€‚ä»è¿™ä¸ªè¾“å‡ºå¯ä»¥çœ‹å‡ºlogger = logging.getLogger()è¿”å›çš„Loggeråä¸ºrootã€‚è¿™é‡Œæ²¡æœ‰ç”¨logger.setLevel(logging.Debug)æ˜¾ç¤ºçš„ä¸ºloggerè®¾ç½®æ—¥å¿—çº§åˆ«ï¼Œæ‰€ä»¥ä½¿ç”¨é»˜è®¤çš„æ—¥å¿—çº§åˆ«WARNIINGï¼Œæ•…ç»“æœåªè¾“å‡ºäº†å¤§äºç­‰äºWARNIINGçº§åˆ«çš„ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºä¸¤ä¸ªloggerå¯¹è±¡"><a href="#åˆ›å»ºä¸¤ä¸ªloggerå¯¹è±¡" class="headerlink" title="åˆ›å»ºä¸¤ä¸ªloggerå¯¹è±¡"></a>åˆ›å»ºä¸¤ä¸ªloggerå¯¹è±¡</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line">fh = logging.FileHandler(<span class="string">'test.log'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®æ—¥å¿—æ ¼å¼</span></span><br><span class="line">ch = logging.StreamHandler()</span><br><span class="line">formatter = logging.Formatter(<span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line">fh.setFormatter(formatter)</span><br><span class="line">ch.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰ loggerå¯¹è±¡</span></span><br><span class="line">logger1 = logging.getLogger(<span class="string">'logger'</span>)</span><br><span class="line">logger1.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line">logger2 = logging.getLogger(<span class="string">'mylogger'</span>)</span><br><span class="line">logger2.setLevel(logging.INFO)</span><br><span class="line"></span><br><span class="line">logger1.addHandler(fh)</span><br><span class="line">logger1.addHandler(ch)</span><br><span class="line"></span><br><span class="line">logger2.addHandler(fh)</span><br><span class="line">logger2.addHandler(ch)</span><br><span class="line"></span><br><span class="line">logger1.debug(<span class="string">'logger1 debug message'</span>)</span><br><span class="line">logger1.info(<span class="string">'logger1 info message'</span>)</span><br><span class="line">logger1.warning(<span class="string">'logger1 warning message'</span>)</span><br><span class="line">logger1.error(<span class="string">'logger1 error message'</span>)</span><br><span class="line">logger1.critical(<span class="string">'logger1 critical message'</span>)</span><br><span class="line"></span><br><span class="line">logger2.debug(<span class="string">'logger2 debug message'</span>)</span><br><span class="line">logger2.info(<span class="string">'logger2 info message'</span>)</span><br><span class="line">logger2.warning(<span class="string">'logger2 warning message'</span>)</span><br><span class="line">logger2.error(<span class="string">'logger2 error message'</span>)</span><br><span class="line">logger2.critical(<span class="string">'logger2 critical message'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test log]<span class="comment"># cat test.log </span></span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">27</span>,<span class="number">366</span> - logger - DEBUG - logger1 debug message</span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">27</span>,<span class="number">367</span> - logger - INFO - logger1 info message</span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">27</span>,<span class="number">367</span> - logger - WARNING - logger1 warning message</span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">27</span>,<span class="number">367</span> - logger - ERROR - logger1 error message</span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">27</span>,<span class="number">367</span> - logger - CRITICAL - logger1 critical message</span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">27</span>,<span class="number">367</span> - mylogger - INFO - logger2 info message</span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">27</span>,<span class="number">367</span> - mylogger - WARNING - logger2 warning message</span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">27</span>,<span class="number">367</span> - mylogger - ERROR - logger2 error message</span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">15</span>:<span class="number">02</span>:<span class="number">27</span>,<span class="number">367</span> - mylogger - CRITICAL - logger2 critical message</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line"><span class="number">1.</span>æˆ‘ä»¬æ˜æ˜é€šè¿‡logger1.setLevel(logging.DEBUG)å°†logger1çš„æ—¥å¿—çº§åˆ«è®¾ç½®ä¸ºäº†DEBUGï¼Œä¸ºä½•æ˜¾ç¤ºçš„æ—¶å€™æ²¡æœ‰æ˜¾ç¤ºå‡ºDEBUGçº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ï¼Œè€Œæ˜¯ä»INFOçº§åˆ«çš„æ—¥å¿—å¼€å§‹æ˜¾ç¤ºå‘¢ï¼Ÿ</span><br><span class="line">åŸæ¥logger1å’Œlogger2å¯¹åº”çš„æ˜¯åŒä¸€ä¸ªLoggerå®ä¾‹ï¼Œåªè¦logging.getLoggerï¼ˆnameï¼‰ä¸­åç§°å‚æ•°nameç›¸åŒåˆ™è¿”å›çš„Loggerå®ä¾‹å°±æ˜¯åŒä¸€ä¸ªï¼Œä¸”ä»…æœ‰ä¸€ä¸ªï¼Œä¹Ÿå³nameä¸Loggerå®ä¾‹ä¸€ä¸€å¯¹åº”ã€‚åœ¨logger2å®ä¾‹ä¸­é€šè¿‡logger2.setLevel(logging.INFO)è®¾ç½®myloggerçš„æ—¥å¿—çº§åˆ«ä¸ºlogging.INFOï¼Œæ‰€ä»¥æœ€ålogger1çš„è¾“å‡ºéµä»äº†åæ¥è®¾ç½®çš„æ—¥å¿—çº§åˆ«ã€‚</span><br><span class="line">2.ä¸ºä»€ä¹ˆlogger1ã€logger2å¯¹åº”çš„æ¯ä¸ªè¾“å‡ºåˆ†åˆ«æ˜¾ç¤ºä¸¤æ¬¡?</span><br><span class="line">è¿™æ˜¯å› ä¸ºæˆ‘ä»¬é€šè¿‡logger = logging.getLogger()æ˜¾ç¤ºçš„åˆ›å»ºäº†root Loggerï¼Œè€Œlogger1 = logging.getLogger(<span class="string">'mylogger'</span>)åˆ›å»ºäº†root Loggerçš„å­©å­(root.)mylogger,logger2åŒæ ·ã€‚è€Œå­©å­,å­™å­ï¼Œé‡å­™â€¦â€¦æ—¢ä¼šå°†æ¶ˆæ¯åˆ†å‘ç»™ä»–çš„handlerè¿›è¡Œå¤„ç†ä¹Ÿä¼šä¼ é€’ç»™æ‰€æœ‰çš„ç¥–å…ˆLoggerå¤„ç†ã€‚</span><br></pre></td></tr></table></figure><h2 id="å†™å…¥é…ç½®æ–‡ä»¶"><a href="#å†™å…¥é…ç½®æ–‡ä»¶" class="headerlink" title="å†™å…¥é…ç½®æ–‡ä»¶"></a>å†™å…¥é…ç½®æ–‡ä»¶</h2><h3 id="å®šä¹‰ä¸€ä¸ª-yaml-é…ç½®æ–‡ä»¶"><a href="#å®šä¹‰ä¸€ä¸ª-yaml-é…ç½®æ–‡ä»¶" class="headerlink" title="å®šä¹‰ä¸€ä¸ª yaml é…ç½®æ–‡ä»¶"></a>å®šä¹‰ä¸€ä¸ª yaml é…ç½®æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–‡ä»¶åï¼šconfig.yaml</span></span><br><span class="line">version: <span class="number">1</span></span><br><span class="line">formatters:</span><br><span class="line">  brief:</span><br><span class="line">    format: <span class="string">"%(asctime)s - %(message)s"</span></span><br><span class="line">  simple:</span><br><span class="line">    format: <span class="string">"%(asctime)s - %(name)s - %(levelname)s - %(message)s"</span></span><br><span class="line">handlers:</span><br><span class="line">  console:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> :</span> logging.StreamHandler</span><br><span class="line">    formatter: brief</span><br><span class="line">    level   : INFO</span><br><span class="line">    stream  : ext://sys.stdout</span><br><span class="line">  file:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> :</span> logging.FileHandler</span><br><span class="line">    formatter: simple</span><br><span class="line">    level: DEBUG</span><br><span class="line">    filename: debug.log</span><br><span class="line">  error:</span><br><span class="line">    <span class="class"><span class="keyword">class</span>:</span> logging.handlers.RotatingFileHandler</span><br><span class="line">    level: ERROR</span><br><span class="line">    formatter: simple</span><br><span class="line">    filename: error.log</span><br><span class="line">    maxBytes: <span class="number">10485760</span></span><br><span class="line">    backupCount: <span class="number">20</span></span><br><span class="line">    encoding: utf8</span><br><span class="line">loggers:</span><br><span class="line">  main.core:</span><br><span class="line">    level: DEBUG</span><br><span class="line">    handlers: [console, file, error]</span><br><span class="line">root:</span><br><span class="line">  level: DEBUG</span><br><span class="line">  handlers: [console]</span><br></pre></td></tr></table></figure><h3 id="å®šä¹‰ä¸€ä¸ªä¸»å…¥å£æ–‡ä»¶"><a href="#å®šä¹‰ä¸€ä¸ªä¸»å…¥å£æ–‡ä»¶" class="headerlink" title="å®šä¹‰ä¸€ä¸ªä¸»å…¥å£æ–‡ä»¶"></a>å®šä¹‰ä¸€ä¸ªä¸»å…¥å£æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–‡ä»¶åï¼šmain.py</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> core</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup_logging</span><span class="params">(default_path=<span class="string">'config.yaml'</span>, default_level=logging.INFO)</span>:</span></span><br><span class="line">    path = default_path</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        <span class="keyword">with</span> open(path, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            config = yaml.load(f)</span><br><span class="line">            logging.config.dictConfig(config)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logging.basicConfig(level=default_level)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">()</span>:</span></span><br><span class="line">    logging.debug(<span class="string">'Start'</span>)</span><br><span class="line">    logging.info(<span class="string">'Exec'</span>)</span><br><span class="line">    logging.info(<span class="string">'Finished'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    yaml_path = <span class="string">'config.yaml'</span></span><br><span class="line">    setup_logging(yaml_path)</span><br><span class="line">    log()</span><br><span class="line">    core.run()</span><br><span class="line"><span class="comment">#è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª setup_logging() æ–¹æ³•ï¼Œé‡Œé¢è¯»å–äº† yaml æ–‡ä»¶çš„é…ç½®ï¼Œç„¶åé€šè¿‡ dictConfig() æ–¹æ³•å°†é…ç½®é¡¹ä¼ ç»™äº† logging æ¨¡å—è¿›è¡Œå…¨å±€åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><h3 id="è¿™ä¸ªæ¨¡å—è¿˜å¼•å…¥äº†å¦å¤–ä¸€ä¸ªæ¨¡å—-core"><a href="#è¿™ä¸ªæ¨¡å—è¿˜å¼•å…¥äº†å¦å¤–ä¸€ä¸ªæ¨¡å—-core" class="headerlink" title="è¿™ä¸ªæ¨¡å—è¿˜å¼•å…¥äº†å¦å¤–ä¸€ä¸ªæ¨¡å— core"></a>è¿™ä¸ªæ¨¡å—è¿˜å¼•å…¥äº†å¦å¤–ä¸€ä¸ªæ¨¡å— core</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–‡ä»¶åï¼šcore.py</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line">logger = logging.getLogger(<span class="string">'main.core'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    logger.info(<span class="string">'Core Info'</span>)</span><br><span class="line">    logger.debug(<span class="string">'Core Debug'</span>)</span><br><span class="line">    logger.error(<span class="string">'Core Error'</span>)</span><br></pre></td></tr></table></figure><h3 id="æ§åˆ¶å°è¿è¡Œç»“æœè¾“å‡º"><a href="#æ§åˆ¶å°è¿è¡Œç»“æœè¾“å‡º" class="headerlink" title="æ§åˆ¶å°è¿è¡Œç»“æœè¾“å‡º"></a>æ§åˆ¶å°è¿è¡Œç»“æœè¾“å‡º</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - Exec</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - Finished</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - Core Info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - Core Info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">728</span> - Core Error</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">728</span> - Core Error</span><br></pre></td></tr></table></figure><h3 id="åœ¨-debug-log-æ–‡ä»¶ä¸­åˆ™åŒ…å«äº†-core-py-çš„è¿è¡Œç»“æœ"><a href="#åœ¨-debug-log-æ–‡ä»¶ä¸­åˆ™åŒ…å«äº†-core-py-çš„è¿è¡Œç»“æœ" class="headerlink" title="åœ¨ debug.log æ–‡ä»¶ä¸­åˆ™åŒ…å«äº† core.py çš„è¿è¡Œç»“æœ"></a>åœ¨ debug.log æ–‡ä»¶ä¸­åˆ™åŒ…å«äº† core.py çš„è¿è¡Œç»“æœ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - main.core - INFO - Core Info</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">727</span> - main.core - DEBUG - Core Debug</span><br><span class="line"><span class="number">2018</span><span class="number">-06</span><span class="number">-03</span> <span class="number">17</span>:<span class="number">07</span>:<span class="number">12</span>,<span class="number">728</span> - main.core - ERROR - Core Error</span><br></pre></td></tr></table></figure><h2 id="å¯¹loggingæ¨¡å—è¿›è¡Œå°è£…"><a href="#å¯¹loggingæ¨¡å—è¿›è¡Œå°è£…" class="headerlink" title="å¯¹loggingæ¨¡å—è¿›è¡Œå°è£…"></a>å¯¹loggingæ¨¡å—è¿›è¡Œå°è£…</h2><h3 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test log]<span class="comment"># ls</span></span><br><span class="line">bin  lib  logs</span><br><span class="line"><span class="comment"># biné‡Œé¢æœ‰ä¸»å‡½æ•°main.py</span></span><br><span class="line"><span class="comment"># libé‡Œé¢æœ‰log.py</span></span><br></pre></td></tr></table></figure><h3 id="å±•ç°ä»£ç "><a href="#å±•ç°ä»£ç " class="headerlink" title="å±•ç°ä»£ç "></a>å±•ç°ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># log.py</span></span><br><span class="line">[root@RedHat_test lib]<span class="comment"># cat log.py</span></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> logging.handlers <span class="keyword">import</span> TimedRotatingFileHandler</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">initlog</span><span class="params">(log_file,loglevel,rotat=True)</span>:</span></span><br><span class="line">    <span class="keyword">global</span>  logger</span><br><span class="line">    <span class="comment">#ç”Ÿæˆä¸€ä¸ªæ—¥å¿—å¯¹è±¡</span></span><br><span class="line">    logger = logging.getLogger()</span><br><span class="line">    logger.setLevel(loglevel)</span><br><span class="line">    <span class="keyword">if</span> loglevel <span class="keyword">is</span> logging.DEBUG:</span><br><span class="line">        formatter = logging.Formatter(<span class="string">'%(asctime)s  %(levelname)s %(threadName)s  %(funcName)s  %(lineno)d %(message)s '</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        formatter = logging.Formatter(<span class="string">'%(asctime)s  %(levelname)s %(threadName)s [%(funcName)s] %(message)s '</span>)</span><br><span class="line">    <span class="comment"># Create a file handler to store error messages</span></span><br><span class="line">    <span class="comment">#fhdr = logging.FileHandler(log_file)</span></span><br><span class="line">    <span class="keyword">if</span> rotat:</span><br><span class="line">        <span class="comment">#fhdr =  TimedRotatingFileHandler(log_file,when='midnight',backupCount=3000)</span></span><br><span class="line">        <span class="comment">#fhdr.suffix= "%Y%m%d"</span></span><br><span class="line">        fhdr =  TimedRotatingFileHandler(log_file,when=<span class="string">'D'</span>,interval=<span class="number">1</span>,backupCount=<span class="number">200</span>)</span><br><span class="line">        fhdr.suffix= <span class="string">"%Y-%m-%d.log"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        fhdr = logging.FileHandler(log_file)</span><br><span class="line">    fhdr.setFormatter(formatter)</span><br><span class="line">    <span class="comment"># Create a stream handler to print all messages to console </span></span><br><span class="line">    chdr = logging.StreamHandler()</span><br><span class="line">    chdr.setFormatter(formatter)</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    logger.addHandler(fhdr)</span><br><span class="line">    logger.addHandler(chdr)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line">[root@RedHat_test bin]<span class="comment"># cat main.py </span></span><br><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> sys,os,string,inspect</span><br><span class="line">sys.path.append(os.path.join(os.path.dirname(os.path.dirname(os.path.abspath(__file__))),<span class="string">'lib'</span>))</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> log</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">logger = logging.getLogger()</span><br><span class="line"></span><br><span class="line">logfile=os.path.join(<span class="string">'/root/log/logs'</span>,<span class="string">'dyscripty.log'</span>)</span><br><span class="line">loglevel=logging.INFO</span><br><span class="line">log.initlog(logfile, loglevel)</span><br><span class="line"></span><br><span class="line">a = <span class="string">'123456789'</span></span><br><span class="line">logger.info(a)</span><br></pre></td></tr></table></figure><h3 id="å±•ç¤ºæ•ˆæœ"><a href="#å±•ç¤ºæ•ˆæœ" class="headerlink" title="å±•ç¤ºæ•ˆæœ"></a>å±•ç¤ºæ•ˆæœ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test bin]<span class="comment"># python main.py </span></span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">15</span>:<span class="number">14</span>:<span class="number">33</span>,<span class="number">596</span>  INFO MainThread [&lt;module&gt;] <span class="number">123456789</span> </span><br><span class="line">[root@RedHat_test logs]<span class="comment"># cat dyscripty.log </span></span><br><span class="line"><span class="number">2020</span><span class="number">-02</span><span class="number">-25</span> <span class="number">15</span>:<span class="number">14</span>:<span class="number">33</span>,<span class="number">596</span>  INFO MainThread [&lt;module&gt;] <span class="number">123456789</span></span><br></pre></td></tr></table></figure><h2 id="Djangoä¸­çš„æ—¥å¿—é…ç½®"><a href="#Djangoä¸­çš„æ—¥å¿—é…ç½®" class="headerlink" title="Djangoä¸­çš„æ—¥å¿—é…ç½®"></a>Djangoä¸­çš„æ—¥å¿—é…ç½®</h2><h3 id="Djangoçš„æ—¥å¿—åœ¨-your-project-name-settings-pyæ–‡ä»¶ä¸­é…ç½®"><a href="#Djangoçš„æ—¥å¿—åœ¨-your-project-name-settings-pyæ–‡ä»¶ä¸­é…ç½®" class="headerlink" title="Djangoçš„æ—¥å¿—åœ¨/your_project_name/settings.pyæ–‡ä»¶ä¸­é…ç½®"></a>Djangoçš„æ—¥å¿—åœ¨/your_project_name/settings.pyæ–‡ä»¶ä¸­é…ç½®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  log  é¦–å…ˆåˆ›å»ºæ—¥å¿—å­˜å‚¨è·¯å¾„.</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> django.utils.log</span><br><span class="line"><span class="keyword">import</span> logging.handlers</span><br><span class="line"> </span><br><span class="line">log_path = os.path.join(BASE_DIR, <span class="string">"logs"</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(log_path):</span><br><span class="line">    os.makedirs(<span class="string">"logs"</span>)</span><br><span class="line"><span class="comment"># DJANGO_LOG_LEVEL=DEBUG</span></span><br><span class="line"> </span><br><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">'version'</span>: <span class="number">1</span>,  <span class="comment"># ä¿ç•™å­—</span></span><br><span class="line">    <span class="string">'disable_existing_loggers'</span>: <span class="literal">False</span>,  <span class="comment"># ç¦ç”¨å·²ç»å­˜åœ¨çš„loggerå®ä¾‹</span></span><br><span class="line">    <span class="comment"># æ—¥å¿—æ–‡ä»¶çš„æ ¼å¼</span></span><br><span class="line">    <span class="string">'formatters'</span>: &#123;</span><br><span class="line">        <span class="comment"># è¯¦ç»†çš„æ—¥å¿—æ ¼å¼</span></span><br><span class="line">        <span class="string">'standard'</span>: &#123;</span><br><span class="line">            <span class="string">'format'</span>: <span class="string">'[%(asctime)s][%(threadName)s:%(thread)d][task_id:%(name)s][%(filename)s:%(lineno)d]'</span></span><br><span class="line">                      <span class="string">'[%(levelname)s][%(message)s]'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment"># ç®€å•çš„æ—¥å¿—æ ¼å¼</span></span><br><span class="line">        <span class="string">'simple'</span>: &#123;</span><br><span class="line">            <span class="string">'format'</span>: <span class="string">'[%(levelname)s][%(asctime)s][%(filename)s:%(lineno)d]%(message)s'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment"># å®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„æ—¥å¿—æ ¼å¼</span></span><br><span class="line">        <span class="string">'collect'</span>: &#123;</span><br><span class="line">            <span class="string">'format'</span>: <span class="string">'%(message)s'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment"># è¿‡æ»¤å™¨</span></span><br><span class="line">    <span class="string">'filters'</span>: &#123;</span><br><span class="line">        <span class="string">'require_debug_true'</span>: &#123;</span><br><span class="line">            <span class="string">'()'</span>: <span class="string">'django.utils.log.RequireDebugTrue'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment"># å¤„ç†å™¨</span></span><br><span class="line">    <span class="string">'handlers'</span>: &#123;</span><br><span class="line">        <span class="string">'console'</span>: &#123;     <span class="comment"># åœ¨ç»ˆç«¯æ‰“å°</span></span><br><span class="line">            <span class="string">'level'</span>: <span class="string">'DEBUG'</span>,</span><br><span class="line">            <span class="string">'filters'</span>: [<span class="string">'require_debug_true'</span>],  <span class="comment"># åªæœ‰åœ¨Django debugä¸ºTrueæ—¶æ‰åœ¨å±å¹•æ‰“å°æ—¥å¿—</span></span><br><span class="line">            <span class="string">'class'</span>: <span class="string">'logging.StreamHandler'</span>,  <span class="comment">#</span></span><br><span class="line">            <span class="string">'formatter'</span>: <span class="string">'simple'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'default'</span>: &#123;    <span class="comment"># é»˜è®¤çš„</span></span><br><span class="line">            <span class="string">'level'</span>: <span class="string">'INFO'</span>,</span><br><span class="line">            <span class="string">'class'</span>: <span class="string">'logging.handlers.RotatingFileHandler'</span>,  <span class="comment"># ä¿å­˜åˆ°æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ‡</span></span><br><span class="line">            <span class="string">'filename'</span>: os.path.join(BASE_DIR+<span class="string">'/logs/'</span>, <span class="string">"all.log"</span>),  <span class="comment"># æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">            <span class="string">'maxBytes'</span>: <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">50</span>,                    <span class="comment"># æ—¥å¿—å¤§å° 50M</span></span><br><span class="line">            <span class="string">'backupCount'</span>: <span class="number">3</span>,                                <span class="comment"># æœ€å¤šå¤‡ä»½å‡ ä¸ª</span></span><br><span class="line">            <span class="string">'formatter'</span>: <span class="string">'standard'</span>,</span><br><span class="line">            <span class="string">'encoding'</span>: <span class="string">'utf-8'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'error'</span>: &#123;   <span class="comment"># ä¸“é—¨ç”¨æ¥è®°é”™è¯¯æ—¥å¿—</span></span><br><span class="line">            <span class="string">'level'</span>: <span class="string">'ERROR'</span>,</span><br><span class="line">            <span class="string">'class'</span>: <span class="string">'logging.handlers.RotatingFileHandler'</span>,  <span class="comment"># ä¿å­˜åˆ°æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ‡</span></span><br><span class="line">            <span class="string">'filename'</span>: os.path.join(BASE_DIR+<span class="string">'/logs/'</span>, <span class="string">"error.log"</span>),  <span class="comment"># æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line">            <span class="string">'maxBytes'</span>: <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">50</span>,  <span class="comment"># æ—¥å¿—å¤§å° 50M</span></span><br><span class="line">            <span class="string">'backupCount'</span>: <span class="number">5</span>,</span><br><span class="line">            <span class="string">'formatter'</span>: <span class="string">'standard'</span>,</span><br><span class="line">            <span class="string">'encoding'</span>: <span class="string">'utf-8'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'collect'</span>: &#123;   <span class="comment"># ä¸“é—¨å®šä¹‰ä¸€ä¸ªæ”¶é›†ç‰¹å®šä¿¡æ¯çš„æ—¥å¿—</span></span><br><span class="line">            <span class="string">'level'</span>: <span class="string">'INFO'</span>,</span><br><span class="line">            <span class="string">'class'</span>: <span class="string">'logging.handlers.RotatingFileHandler'</span>,  <span class="comment"># ä¿å­˜åˆ°æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ‡</span></span><br><span class="line">            <span class="string">'filename'</span>: os.path.join(BASE_DIR+<span class="string">'/logs/'</span>, <span class="string">"collect.log"</span>),</span><br><span class="line">            <span class="string">'maxBytes'</span>: <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">50</span>,  <span class="comment"># æ—¥å¿—å¤§å° 50M</span></span><br><span class="line">            <span class="string">'backupCount'</span>: <span class="number">5</span>,</span><br><span class="line">            <span class="string">'formatter'</span>: <span class="string">'collect'</span>,</span><br><span class="line">            <span class="string">'encoding'</span>: <span class="string">"utf-8"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'scprits_handler'</span>: &#123;</span><br><span class="line">            <span class="string">'level'</span>:<span class="string">'DEBUG'</span>,</span><br><span class="line">            <span class="string">'class'</span>:<span class="string">'logging.handlers.RotatingFileHandler'</span>,</span><br><span class="line">            <span class="string">'filename'</span>: os.path.join(BASE_DIR+<span class="string">'/logs/'</span>, <span class="string">"script.log"</span>),</span><br><span class="line">            <span class="string">'maxBytes'</span>: <span class="number">1024</span>*<span class="number">1024</span>*<span class="number">5</span>,</span><br><span class="line">            <span class="string">'backupCount'</span>: <span class="number">5</span>,</span><br><span class="line">            <span class="string">'formatter'</span>:<span class="string">'standard'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'loggers'</span>: &#123;</span><br><span class="line">        <span class="string">'django'</span>: &#123;             <span class="comment"># é»˜è®¤çš„loggeråº”ç”¨å¦‚ä¸‹é…ç½®</span></span><br><span class="line">            <span class="string">'handlers'</span>: [<span class="string">'default'</span>, <span class="string">'console'</span>, <span class="string">'error'</span>],  <span class="comment"># ä¸Šçº¿ä¹‹åå¯ä»¥æŠŠ'console'ç§»é™¤</span></span><br><span class="line">            <span class="string">'level'</span>: <span class="string">'DEBUG'</span>,</span><br><span class="line">            <span class="string">'propagate'</span>: <span class="literal">True</span>,  <span class="comment"># å‘ä¸å‘æ›´é«˜çº§åˆ«çš„loggerä¼ é€’</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'collect'</span>: &#123;      <span class="comment"># åä¸º 'collect'çš„loggerè¿˜å•ç‹¬å¤„ç†</span></span><br><span class="line">            <span class="string">'handlers'</span>: [<span class="string">'console'</span>, <span class="string">'collect'</span>],</span><br><span class="line">            <span class="string">'level'</span>: <span class="string">'INFO'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'scripts'</span>: &#123;</span><br><span class="line">            <span class="string">'handlers'</span>: [<span class="string">'scprits_handler'</span>],</span><br><span class="line">            <span class="string">'level'</span>: <span class="string">'INFO'</span>,</span><br><span class="line">            <span class="string">'propagate'</span>: <span class="literal">False</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ­¤é…ç½®çš„ä¸‰ä¸ªéƒ¨åˆ†"><a href="#æ­¤é…ç½®çš„ä¸‰ä¸ªéƒ¨åˆ†" class="headerlink" title="æ­¤é…ç½®çš„ä¸‰ä¸ªéƒ¨åˆ†"></a>æ­¤é…ç½®çš„ä¸‰ä¸ªéƒ¨åˆ†</h3><p>formatters: æŒ‡å®šè¾“å‡ºçš„æ ¼å¼ï¼Œè¢«handlerä½¿ç”¨ã€‚</p><p>handlersï¼š æŒ‡å®šè¾“å‡ºåˆ°æ§åˆ¶å°è¿˜æ˜¯æ–‡ä»¶ä¸­ï¼Œä»¥åŠè¾“å‡ºçš„æ–¹å¼ã€‚è¢«loggerå¼•ç”¨ã€‚</p><p>loggersï¼š æŒ‡å®šdjangoä¸­çš„æ¯ä¸ªæ¨¡å—ä½¿ç”¨å“ªä¸ªhandlersã€‚ä»¥åŠæ—¥å¿—è¾“å‡ºçš„çº§åˆ«ã€‚</p><p>æ³¨æ„ï¼šæ—¥å¿—çš„è¾“å‡ºçº§åˆ«æ˜¯ç”±loggersä¸­çš„æ¯ä¸ªæ¨¡å—ä¸­levelé€‰é¡¹å®šä¹‰ã€‚å¦‚æœæ²¡æœ‰é…ç½®ï¼Œé‚£ä¹ˆé»˜è®¤ä¸ºwarningçº§åˆ«ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handlersä¸loggerséƒ½å­˜åœ¨levelï¼Œä¸¤è€…ä¸åŒï¼š</span><br><span class="line"><span class="number">1</span>ã€loggersä¸­çš„levelè¡¨ç¤ºå¯ä»¥æ¥å—çš„é”™è¯¯çº§åˆ«ï¼Œå°±æ˜¯è¯´loggersæ¥å—levelæˆ–è€…æ¯”levelæ›´é«˜çº§åˆ«çš„é”™è¯¯ï¼Œç”±propagateå†³å®š:propagateä¸º<span class="literal">True</span>, åˆ™å‘ä¸Šä¼ æ’­ï¼›</span><br><span class="line"><span class="number">2</span>ã€handlersçš„levelè¡¨ç¤ºæ—¥å¿—çº§åˆ«</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging </span><br><span class="line">logger = logging.getLogger(<span class="string">'django'</span>)</span><br><span class="line">logger.info(<span class="string">'-------------------------'</span>)</span><br><span class="line">logger.error(str(e))</span><br><span class="line">logger.warn(<span class="string">'warn'</span>)</span><br><span class="line">logger.debug(<span class="string">'debug'</span>)</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="/Users/huqi/Desktop/å±å¹•å¿«ç…§ 2020-02-25 ä¸‹åˆ3.47.31.png" alt="å±å¹•å¿«ç…§ 2020-02-25 ä¸‹åˆ3.47.31"></p>]]></content>
      
      
      <categories>
          
          <category> Linux_python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux_python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sarâ€”æ€§èƒ½ç›‘æ§å‘½ä»¤</title>
      <link href="/2020/03/09/sar-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%91%BD%E4%BB%A4/"/>
      <url>/2020/03/09/sar-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨ä½¿ç”¨ Linux ç³»ç»Ÿæ—¶ï¼Œå¸¸å¸¸ä¼šé‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚ç³»ç»Ÿå®¹æ˜“æ­»æœºæˆ–è€…è¿è¡Œé€Ÿåº¦çªç„¶å˜æ…¢ï¼Œè¿™æ—¶æˆ‘ä»¬å¸¸å¸¸çŒœæµ‹ï¼šæ˜¯å¦ç¡¬ç›˜ç©ºé—´ä¸è¶³ï¼Œæ˜¯å¦å†…å­˜ä¸è¶³ï¼Œæ˜¯å¦ I/O å‡ºç°ç“¶é¢ˆï¼Œè¿˜æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒå‚æ•°å‡ºäº†é—®é¢˜ï¼Ÿè¿™æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘ä½¿ç”¨ sar å·¥å…·å¯¹ç³»ç»Ÿåšä¸€ä¸ªå…¨é¢äº†è§£ï¼Œåˆ†æç³»ç»Ÿçš„è´Ÿè½½çŠ¶å†µã€‚</p><p>sarï¼ˆSystem Activity Reporterï¼‰æ˜¯ç³»ç»Ÿæ´»åŠ¨æƒ…å†µæŠ¥å‘Šçš„ç¼©å†™ã€‚sar å·¥å…·å°†å¯¹ç³»ç»Ÿå½“å‰çš„çŠ¶æ€è¿›è¡Œå–æ ·ï¼Œç„¶åé€šè¿‡è®¡ç®—æ•°æ®å’Œæ¯”ä¾‹æ¥è¡¨è¾¾ç³»ç»Ÿçš„å½“å‰è¿è¡ŒçŠ¶æ€ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯å¯ä»¥è¿ç»­å¯¹ç³»ç»Ÿå–æ ·ï¼Œè·å¾—å¤§é‡çš„å–æ ·æ•°æ®ï¼›å–æ ·æ•°æ®å’Œåˆ†æçš„ç»“æœéƒ½å¯ä»¥å­˜å…¥æ–‡ä»¶ï¼Œæ‰€éœ€çš„è´Ÿè½½å¾ˆå°ã€‚ sar æ˜¯ç›®å‰ Linux ä¸Šæœ€ä¸ºå…¨é¢çš„ç³»ç»Ÿæ€§èƒ½åˆ†æå·¥å…·ä¹‹ä¸€ï¼Œå¯ä»¥ä»å¤šæ–¹é¢å¯¹ç³»ç»Ÿçš„æ´»åŠ¨è¿›è¡ŒæŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼šæ–‡ä»¶çš„è¯»å†™æƒ…å†µã€ç³»ç»Ÿè°ƒç”¨çš„ä½¿ç”¨æƒ…å†µã€ç£ç›˜I/Oã€CPUæ•ˆç‡ã€å†…å­˜ä½¿ç”¨çŠ¶å†µã€è¿›ç¨‹æ´»åŠ¨åŠIPCæœ‰å…³çš„æ´»åŠ¨ç­‰ã€‚ä¸ºäº†æä¾›ä¸åŒçš„ä¿¡æ¯ï¼Œsar æä¾›äº†ä¸°å¯Œçš„é€‰é¡¹ã€å› æ­¤ä½¿ç”¨è¾ƒä¸ºå¤æ‚ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# yum install sysstat</span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# service sysstat start</span><br></pre></td></tr></table></figure><h2 id="sarå‘½ä»¤å¸¸ç”¨æ ¼å¼"><a href="#sarå‘½ä»¤å¸¸ç”¨æ ¼å¼" class="headerlink" title="sarå‘½ä»¤å¸¸ç”¨æ ¼å¼"></a>sarå‘½ä»¤å¸¸ç”¨æ ¼å¼</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# sar  [options]  [-A]  [-o file]  t  [n]</span><br><span class="line">t : é‡‡æ ·é—´éš”</span><br><span class="line">n : é‡‡æ ·æ¬¡æ•°ï¼Œé»˜è®¤å€¼æ˜¯1</span><br><span class="line">-o file : å°†å‘½ä»¤ç»“æœä»¥äºŒè¿›åˆ¶æ ¼å¼å­˜æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Œfileæ˜¯æ–‡ä»¶å</span><br><span class="line">options : å‘½ä»¤è¡Œé€‰é¡¹ï¼Œsarå‘½ä»¤å¸¸ç”¨é€‰é¡¹å¦‚ä¸‹ï¼š</span><br><span class="line">-A : æ‰€æœ‰æŠ¥å‘Šçš„æ€»å’Œ</span><br><span class="line">-u : è¾“å‡ºCPUä½¿ç”¨æƒ…å†µçš„ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">-v : è¾“å‡ºinodeã€æ–‡ä»¶å’Œå…¶ä»–å†…æ ¸è¡¨çš„ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">-d : è¾“å‡ºæ¯ä¸€ä¸ªå—è®¾å¤‡çš„æ´»åŠ¨ä¿¡æ¯</span><br><span class="line">-r : è¾“å‡ºå†…å­˜å’Œäº¤æ¢ç©ºé—´çš„ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">-b : æ˜¾ç¤ºI/Oçš„ä¼ é€é€Ÿç‡å’Œç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">-a : æ–‡ä»¶è¯»å†™æƒ…å†µ</span><br><span class="line">-c : è¾“å‡ºè¿›ç¨‹ç»Ÿè®¡ä¿¡æ¯ï¼Œç¾å¦™åˆ›å»ºçš„è¿›ç¨‹æ•°</span><br><span class="line">-R : è¾“å‡ºå†…å­˜é¡µé¢çš„ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">-y : ç»ˆç«¯è®¾å¤‡æ´»åŠ¨æƒ…å†µ</span><br><span class="line">-w : è¾“å‡ºç³»ç»Ÿäº¤æ¢æ´»åŠ¨ä¿¡æ¯</span><br></pre></td></tr></table></figure><h2 id="CPUèµ„æºç›‘æ§"><a href="#CPUèµ„æºç›‘æ§" class="headerlink" title="CPUèµ„æºç›‘æ§"></a>CPUèµ„æºç›‘æ§</h2><p>ä¾‹å¦‚ï¼šæ¯10ç§’é‡‡æ ·ä¸€æ¬¡ï¼Œè¿ç»­é‡‡æ ·3æ¬¡ï¼Œè§‚å¯ŸCPUçš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶å°†é‡‡æ ·ç»“æœä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å…¥å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶testä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# sar -u -o test 10 3</span><br><span class="line">Linux 3.10.0-957.el7.x86_64 (RedHat_test) 2020å¹´01æœˆ17æ—¥ _x86_64_(4 CPU)</span><br><span class="line">16æ—¶04åˆ†12ç§’     CPU     %user     %nice   %system   %iowait    %steal     %idle</span><br><span class="line">16æ—¶04åˆ†22ç§’     all      0.00      0.00      0.03      0.00      0.00     99.97</span><br><span class="line">16æ—¶04åˆ†32ç§’     all      0.03      0.00      0.00      0.00      0.00     99.97</span><br><span class="line">16æ—¶04åˆ†42ç§’     all      0.00      0.00      0.03      0.00      0.00     99.97</span><br><span class="line">å¹³å‡æ—¶é—´:     all      0.01      0.00      0.02      0.00      0.00     99.97</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">CPU : all è¡¨ç¤ºç»Ÿè®¡ä¿¡æ¯ä¸ºæ‰€æœ‰CPUçš„å¹³å‡å€¼</span><br><span class="line"><span class="meta">%</span><span class="bash">user : æ˜¾ç¤ºç”¨æˆ·çº§åˆ«ï¼ˆapplicationï¼‰è¿è¡Œä½¿ç”¨CPUæ€»æ—¶é—´çš„ç™¾åˆ†æ¯”</span></span><br><span class="line"><span class="meta">%</span><span class="bash">nice : æ˜¾ç¤ºç”¨æˆ·çº§åˆ«ï¼Œç”¨äºniceæ“ä½œï¼Œæ‰€å ç”¨CPUæ€»æ—¶é—´çš„ç™¾åˆ†æ¯”</span></span><br><span class="line"><span class="meta">%</span><span class="bash">system : åœ¨æ ¸å¿ƒçº§åˆ«ï¼ˆkernelï¼‰è¿è¡Œæ‰€ä½¿ç”¨CPUæ€»æ—¶é—´çš„ç™¾åˆ†æ¯”</span></span><br><span class="line"><span class="meta">%</span><span class="bash">iowait : æ˜¾ç¤ºç”¨äºç­‰å¾…I/Oæ“ä½œå ç”¨CPUæ€»æ—¶é—´çš„ç™¾åˆ†æ¯”</span></span><br><span class="line"><span class="meta">%</span><span class="bash">steal : ç®¡ç†ç¨‹åºï¼ˆhypervisorï¼‰ä¸ºå¦ä¸€ä¸ªè™šæ‹Ÿè¿›ç¨‹æä¾›æœåŠ¡è€Œç­‰å¾…è™šæ‹ŸCPUçš„ç™¾åˆ†æ¯”</span></span><br><span class="line"><span class="meta">%</span><span class="bash">idle : æ˜¾ç¤ºCPUç©ºé—²æ—¶é—´å ç”¨CPUæ€»æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚</span></span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">1.è‹¥%iowaitçš„å€¼è¿‡é«˜ï¼Œè¡¨ç¤ºç¡¬ç›˜å­˜åœ¨I/Oç“¶é¢ˆ</span><br><span class="line">2.è‹¥%idleçš„å€¼é«˜ç³»ç»Ÿå“åº”æ…¢æ—¶ï¼Œæœ‰å¯èƒ½æ˜¯CPUç­‰å¾…åˆ†é…å†…å­˜ï¼Œæ­¤æ—¶åº”åŠ å¤§å†…å­˜å®¹é‡</span><br><span class="line">3.è‹¥%idleçš„å€¼æŒç»­ä½äº1ï¼Œåˆ™ç³»ç»Ÿçš„CPUå¤„ç†èƒ½åŠ›ç›¸å¯¹è¾ƒä½ï¼Œè¡¨æ˜ç³»ç»Ÿä¸­æœ€éœ€è¦è§£å†³çš„èµ„æºæ˜¯CPU</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">å¦‚æœè¦æŸ¥çœ‹äºŒè¿›åˆ¶æ–‡ä»¶testä¸­çš„å†…å®¹ï¼Œéœ€é”®å…¥å¦‚ä¸‹sarå‘½ä»¤ï¼š</span><br><span class="line">[root@RedHat_test ~]# sar -u -f test </span><br><span class="line">Linux 3.10.0-957.el7.x86_64 (RedHat_test) 2020å¹´01æœˆ17æ—¥ _x86_64_(4 CPU)</span><br><span class="line"></span><br><span class="line">16æ—¶04åˆ†12ç§’     CPU     %user     %nice   %system   %iowait    %steal     %idle</span><br><span class="line">16æ—¶04åˆ†22ç§’     all      0.00      0.00      0.03      0.00      0.00     99.97</span><br><span class="line">16æ—¶04åˆ†32ç§’     all      0.03      0.00      0.00      0.00      0.00     99.97</span><br><span class="line">16æ—¶04åˆ†42ç§’     all      0.00      0.00      0.03      0.00      0.00     99.97</span><br><span class="line">å¹³å‡æ—¶é—´:     all      0.01      0.00      0.02      0.00      0.00     99.97</span><br></pre></td></tr></table></figure><h2 id="inodeã€æ–‡ä»¶å’Œå…¶ä»–å†…æ ¸è¡¨ç›‘æ§"><a href="#inodeã€æ–‡ä»¶å’Œå…¶ä»–å†…æ ¸è¡¨ç›‘æ§" class="headerlink" title="inodeã€æ–‡ä»¶å’Œå…¶ä»–å†…æ ¸è¡¨ç›‘æ§"></a>inodeã€æ–‡ä»¶å’Œå…¶ä»–å†…æ ¸è¡¨ç›‘æ§</h2><p>ä¾‹å¦‚ï¼šæ¯10ç§’é‡‡æ ·ä¸€æ¬¡ï¼Œè¿ç»­é‡‡æ ·3æ¬¡ï¼Œè§‚å¯Ÿæ ¸å¿ƒè¡¨çš„çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# sar -v 10 3</span><br><span class="line">Linux 3.10.0-957.el7.x86_64 (RedHat_test) 2020å¹´01æœˆ17æ—¥ _x86_64_(4 CPU)</span><br><span class="line">16æ—¶28åˆ†07ç§’ dentunusd   file-nr  inode-nr    pty-nr</span><br><span class="line">16æ—¶28åˆ†17ç§’     18074       896     21105         1</span><br><span class="line">16æ—¶28åˆ†27ç§’     18074       896     21105         1</span><br><span class="line">16æ—¶28åˆ†37ç§’     18074       896     21105         1</span><br><span class="line">å¹³å‡æ—¶é—´:     18074       896     21105         1</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">dentunusd : ç›®å½•é«˜é€Ÿç¼“å­˜ä¸­æœªè¢«ä½¿ç”¨çš„æ¡ç›®æ•°é‡</span><br><span class="line">file-nr : æ–‡ä»¶å¥æŸ„ï¼ˆfile handleï¼‰çš„ä½¿ç”¨æ•°é‡</span><br><span class="line">inode-nr : ç´¢å¼•èŠ‚ç‚¹å¥æŸ„ï¼ˆinode handleï¼‰çš„ä½¿ç”¨æ•°é‡</span><br><span class="line">pty-nr : ä½¿ç”¨çš„ptyæ•°é‡</span><br></pre></td></tr></table></figure><h2 id="å†…å­˜å’Œäº¤æ¢ç©ºé—´ç›‘æ§"><a href="#å†…å­˜å’Œäº¤æ¢ç©ºé—´ç›‘æ§" class="headerlink" title="å†…å­˜å’Œäº¤æ¢ç©ºé—´ç›‘æ§"></a>å†…å­˜å’Œäº¤æ¢ç©ºé—´ç›‘æ§</h2><p>ä¾‹å¦‚ï¼šæ¯10ç§’é‡‡æ ·ä¸€æ¬¡ï¼Œè¿ç»­é‡‡æ ·3æ¬¡ï¼Œç›‘æ§å†…å­˜å’Œäº¤æ¢åˆ†åŒº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# sar -r 10 3</span><br><span class="line">Linux 3.10.0-957.el7.x86_64 (RedHat_test) 2020å¹´01æœˆ17æ—¥ _x86_64_(4 CPU)</span><br><span class="line">16æ—¶34åˆ†25ç§’ kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty</span><br><span class="line">16æ—¶34åˆ†35ç§’  15902672    363840      2.24      2108    137640    245052      1.33     95560     87300         0</span><br><span class="line">16æ—¶34åˆ†45ç§’  15902672    363840      2.24      2108    137640    245052      1.33     95560     87300         0</span><br><span class="line">16æ—¶34åˆ†55ç§’  15902672    363840      2.24      2108    137640    245052      1.33     95560     87300         0</span><br><span class="line">å¹³å‡æ—¶é—´:  15902672    363840      2.24      2108    137640    245052      1.33     95560     87300         0</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">kbmemfree : è¿™ä¸ªå€¼å’Œfreeå‘½ä¸­çš„freeå€¼åŸºæœ¬ä¸€è‡´ã€‚æ‰€ä»¥å®ƒä¸åŒ…æ‹¬bufferå’Œcacheçš„ç©ºé—´</span><br><span class="line">kbmemused : è¿™ä¸ªå€¼å’Œfreeå‘½ä»¤ä¸­çš„usedå€¼åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥å®ƒåŒ…æ‹¬bufferå’Œcacheçš„ç©ºé—´</span><br><span class="line">memused : è¿™ä¸ªå€¼æ˜¯kbmemusedå’Œå†…å­˜æ€»é‡ï¼ˆä¸åŒ…æ‹¬swqpï¼‰çš„ä¸€ä¸ªç™¾åˆ†æ¯”</span><br><span class="line">kbbuffers å’Œ kbcached : è¿™ä¸¤ä¸ªå€¼å°±æ˜¯freeå‘½ä¸­çš„bufferå’Œcache</span><br><span class="line">kbcommit : ä¿è¯å½“å‰ç³»ç»Ÿæ‰€éœ€è¦çš„å†…å­˜ï¼Œå³ä¸ºäº†ç¡®ä¿ä¸æº¢å‡ºè€Œéœ€è¦çš„å†…å­˜ï¼ˆRAM+swapï¼‰</span><br><span class="line"><span class="meta">%</span><span class="bash">commit : è¿™ä¸ªå€¼æ˜¯kbcommitä¸å†…å­˜æ€»é‡ï¼ˆåŒ…æ‹¬swapï¼‰çš„ä¸€ä¸ªç™¾åˆ†æ¯”</span></span><br></pre></td></tr></table></figure><h2 id="å†…å­˜åˆ†é¡µç›‘æ§"><a href="#å†…å­˜åˆ†é¡µç›‘æ§" class="headerlink" title="å†…å­˜åˆ†é¡µç›‘æ§"></a>å†…å­˜åˆ†é¡µç›‘æ§</h2><p>ä¾‹å¦‚ï¼šæ¯10ç§’é‡‡æ ·ä¸€æ¬¡ï¼Œè¿ç»­é‡‡æ ·3æ¬¡ï¼Œç›‘æ§å†…å­˜åˆ†é¡µ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# sar -B 10 3</span><br><span class="line">Linux 3.10.0-957.el7.x86_64 (RedHat_test) 2020å¹´01æœˆ17æ—¥ _x86_64_(4 CPU)</span><br><span class="line"></span><br><span class="line">16æ—¶44åˆ†18ç§’  pgpgin/s pgpgout/s   fault/s  majflt/s  pgfree/s pgscank/s pgscand/s pgsteal/s    %vmeff</span><br><span class="line">16æ—¶44åˆ†28ç§’      0.00      0.00      3.80      0.00      8.80      0.00      0.00      0.00      0.00</span><br><span class="line">16æ—¶44åˆ†38ç§’      0.00      0.00      3.70      0.00      8.50      0.00      0.00      0.00      0.00</span><br><span class="line">16æ—¶44åˆ†48ç§’      0.00      0.00      2.90      0.00      8.50      0.00      0.00      0.00      0.00</span><br><span class="line">å¹³å‡æ—¶é—´:      0.00      0.00      3.47      0.00      8.60      0.00      0.00      0.00      0.00</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">pgpgin/s : è¡¨ç¤ºæ¯ç§’ä»ç£ç›˜æˆ–SWAPç½®æ¢åˆ°å†…å­˜çš„å­—èŠ‚æ•°ï¼ˆKBï¼‰</span><br><span class="line">pgpgout/s : è¡¨ç¤ºæ¯ç§’ä»å†…å­˜ç½®æ¢åˆ°ç£ç›˜æˆ–SWAPçš„å­—èŠ‚æ•°ï¼ˆKBï¼‰</span><br><span class="line">fault/s : è¡¨ç¤ºæ¯ç§’ç³»ç»Ÿäº§ç”Ÿçš„ç¼ºé¡µæ•°ï¼Œå³ä¸»ç¼ºé¡µä¸æ¬¡ç¼ºé¡µä¹‹å’Œï¼ˆmajor+minorï¼‰</span><br><span class="line">majflt/s : è¡¨ç¤ºæ¯ç§’é’Ÿäº§ç”Ÿçš„ä¸»ç¼ºé¡µæ•°</span><br><span class="line">pgfree/s : æ¯ç§’è¢«æ”¾å…¥ç©ºé—²é˜Ÿåˆ—ä¸­çš„é¡µä¸ªæ•°</span><br><span class="line">pgscank/s : æ¯ç§’è¢«kswapdæ‰«æçš„é¡µä¸ªæ•°</span><br><span class="line">pgscand/s : æ¯ç§’ç›´æ¥è¢«æ‰«æçš„é¡µä¸ªæ•°</span><br><span class="line">pgsteal/s : æ¯ç§’é’Ÿä»cacheä¸­è¢«æ¸…é™¤æ¥æ»¡è¶³å†…å­˜éœ€è¦çš„é¡µä¸ªæ•°</span><br><span class="line"><span class="meta">%</span><span class="bash">vmeff : æ¯ç§’æ¸…é™¤çš„é¡µï¼ˆpgstealï¼‰å æ€»æ‰«æé¡µï¼ˆpgscank+pgscandï¼‰çš„ç™¾åˆ†æ¯”</span></span><br></pre></td></tr></table></figure><h2 id="I-Oå’Œä¼ é€é€Ÿç‡ç›‘æ§"><a href="#I-Oå’Œä¼ é€é€Ÿç‡ç›‘æ§" class="headerlink" title="I/Oå’Œä¼ é€é€Ÿç‡ç›‘æ§"></a>I/Oå’Œä¼ é€é€Ÿç‡ç›‘æ§</h2><p>ä¾‹å¦‚ï¼šæ¯10ç§’é‡‡æ ·ä¸€æ¬¡ï¼Œè¿ç»­é‡‡æ ·3æ¬¡ï¼ŒæŠ¥å‘Šç¼“å†²åŒºçš„ä½¿ç”¨æƒ…å†µ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# sar -b 10 3</span><br><span class="line">Linux 3.10.0-957.el7.x86_64 (RedHat_test) 2020å¹´01æœˆ17æ—¥ _x86_64_(4 CPU)</span><br><span class="line">17æ—¶03åˆ†12ç§’       tps      rtps      wtps   bread/s   bwrtn/s</span><br><span class="line">17æ—¶03åˆ†22ç§’      0.30      0.00      0.30      0.00      3.20</span><br><span class="line">17æ—¶03åˆ†32ç§’      0.60      0.00      0.60      0.00      4.80</span><br><span class="line">17æ—¶03åˆ†42ç§’      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">å¹³å‡æ—¶é—´:      0.30      0.00      0.30      0.00      2.67</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">tps : æ¯ç§’é’Ÿç‰©ç†è®¾å¤‡I/Oä¼ è¾“æ€»é‡</span><br><span class="line">rtps : æ¯ç§’é’Ÿä»ç‰©ç†è®¾å¤‡è¯»å…¥çš„æ•°æ®æ€»é‡</span><br><span class="line">wtps : æ¯ç§’é’Ÿå‘ç‰©ç†è®¾å¤‡å†™å…¥çš„æ•°æ®æ€»é‡</span><br><span class="line">bread/s : æ¯ç§’é’Ÿä»ç‰©ç†è®¾å¤‡è¯»å…¥çš„æ•°æ®é‡ï¼Œå•ä½ä¸º å—/s</span><br><span class="line">bwrtn/s : æ¯ç§’é’Ÿä»ç‰©ç†è®¾å¤‡å†™å…¥çš„æ•°æ®é‡ï¼Œå•ä½ä¸º å—/s</span><br></pre></td></tr></table></figure><h2 id="è¿›ç¨‹é˜Ÿåˆ—é•¿åº¦å’Œå¹³å‡è´Ÿè½½çŠ¶æ€ç›‘æ§"><a href="#è¿›ç¨‹é˜Ÿåˆ—é•¿åº¦å’Œå¹³å‡è´Ÿè½½çŠ¶æ€ç›‘æ§" class="headerlink" title="è¿›ç¨‹é˜Ÿåˆ—é•¿åº¦å’Œå¹³å‡è´Ÿè½½çŠ¶æ€ç›‘æ§"></a>è¿›ç¨‹é˜Ÿåˆ—é•¿åº¦å’Œå¹³å‡è´Ÿè½½çŠ¶æ€ç›‘æ§</h2><p>ä¾‹å¦‚ï¼šæ¯10ç§’é‡‡æ ·ä¸€æ¬¡ï¼Œè¿ç»­é‡‡æ ·3æ¬¡ï¼Œç›‘æ§è¿›ç¨‹é˜Ÿåˆ—é•¿åº¦å’Œå¹³å‡è´Ÿè½½çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# sar -q 10 3</span><br><span class="line">Linux 3.10.0-957.el7.x86_64 (RedHat_test) 2020å¹´01æœˆ17æ—¥ _x86_64_(4 CPU)</span><br><span class="line">17æ—¶09åˆ†34ç§’   runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15   blocked</span><br><span class="line">17æ—¶09åˆ†44ç§’         1       124      0.00      0.01      0.05         0</span><br><span class="line">17æ—¶09åˆ†54ç§’         0       124      0.00      0.01      0.05         0</span><br><span class="line">17æ—¶10åˆ†04ç§’         1       127      0.00      0.01      0.05         0</span><br><span class="line">å¹³å‡æ—¶é—´:         1       125      0.00      0.01      0.05         0</span><br><span class="line">------------------------------------------------------------------------------------------</span><br><span class="line">runq-sz : è¿è¡Œé˜Ÿåˆ—çš„é•¿åº¦ï¼ˆç­‰å¾…è¿è¡Œçš„è¿›ç¨‹æ•°ï¼‰</span><br><span class="line">plist-sz : è¿›ç¨‹åˆ—è¡¨ä¸­è¿›ç¨‹ï¼ˆprocessesï¼‰å’Œçº¿ç¨‹ï¼ˆthreadsï¼‰çš„æ•°é‡</span><br><span class="line">ldavg-1 : æœ€å1åˆ†é’Ÿçš„ç³»ç»Ÿå¹³å‡è´Ÿè½½ï¼ˆSystem load averageï¼‰</span><br><span class="line">ldavg-5 : è¿‡å»5åˆ†é’Ÿçš„ç³»ç»Ÿå¹³å‡è´Ÿè½½</span><br><span class="line">ldavg-15 : è¿‡å»15åˆ†é’Ÿçš„ç³»ç»Ÿå¹³å‡è´Ÿè½½</span><br></pre></td></tr></table></figure><h2 id="ç³»ç»Ÿäº¤æ¢æ´»åŠ¨ä¿¡æ¯ç›‘æ§"><a href="#ç³»ç»Ÿäº¤æ¢æ´»åŠ¨ä¿¡æ¯ç›‘æ§" class="headerlink" title="ç³»ç»Ÿäº¤æ¢æ´»åŠ¨ä¿¡æ¯ç›‘æ§"></a>ç³»ç»Ÿäº¤æ¢æ´»åŠ¨ä¿¡æ¯ç›‘æ§</h2><p>ä¾‹å¦‚ï¼šæ¯10ç§’é‡‡æ ·ä¸€æ¬¡ï¼Œè¿ç»­é‡‡æ ·3æ¬¡ï¼Œç›‘æ§ç³»ç»Ÿäº¤æ¢æ´»åŠ¨ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# sar -W 10 3</span><br><span class="line">Linux 3.10.0-957.el7.x86_64 (RedHat_test) 2020å¹´01æœˆ17æ—¥ _x86_64_(4 CPU)</span><br><span class="line">17æ—¶17åˆ†05ç§’  pswpin/s pswpout/s</span><br><span class="line">17æ—¶17åˆ†15ç§’      0.00      0.00</span><br><span class="line">17æ—¶17åˆ†25ç§’      0.00      0.00</span><br><span class="line">17æ—¶17åˆ†35ç§’      0.00      0.00</span><br><span class="line">å¹³å‡æ—¶é—´:      0.00      0.00</span><br><span class="line">----------------------------------------------------------------------------------------</span><br><span class="line">pswpin/s : æ¯ç§’ç³»ç»Ÿæ¢å…¥çš„äº¤æ¢é¡µé¢ï¼ˆswap pageï¼‰æ•°é‡</span><br><span class="line">pswpout/s : æ¯ç§’ç³»ç»Ÿæ¢å‡ºçš„äº¤æ¢é¡µé¢ï¼ˆswap pageï¼‰æ•°é‡</span><br></pre></td></tr></table></figure><h2 id="è®¾å¤‡ä½¿ç”¨æƒ…å†µç›‘æ§"><a href="#è®¾å¤‡ä½¿ç”¨æƒ…å†µç›‘æ§" class="headerlink" title="è®¾å¤‡ä½¿ç”¨æƒ…å†µç›‘æ§"></a>è®¾å¤‡ä½¿ç”¨æƒ…å†µç›‘æ§</h2><p>ä¾‹å¦‚ï¼šæ¯10ç§’é‡‡æ ·ä¸€æ¬¡ï¼Œè¿ç»­é‡‡æ ·3æ¬¡ï¼ŒæŠ¥å‘Šè®¾å¤‡ä½¿ç”¨æƒ…å†µ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# sar -d 10 3 -p</span><br><span class="line">Linux 3.10.0-957.el7.x86_64 (RedHat_test) 2020å¹´01æœˆ17æ—¥ _x86_64_(4 CPU)</span><br><span class="line"></span><br><span class="line">17æ—¶41åˆ†31ç§’       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util</span><br><span class="line">17æ—¶41åˆ†41ç§’       vda      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">17æ—¶41åˆ†41ç§’ centos-root      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">17æ—¶41åˆ†41ç§’ centos-swap      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"></span><br><span class="line">17æ—¶41åˆ†41ç§’       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util</span><br><span class="line">17æ—¶41åˆ†51ç§’       vda      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">17æ—¶41åˆ†51ç§’ centos-root      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">17æ—¶41åˆ†51ç§’ centos-swap      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"></span><br><span class="line">17æ—¶41åˆ†51ç§’       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util</span><br><span class="line">17æ—¶42åˆ†01ç§’       vda      0.30      0.00      0.30      1.00      0.03    112.00    103.67      3.11</span><br><span class="line">17æ—¶42åˆ†01ç§’ centos-root      0.20      0.00      0.30      1.50      0.03    168.00    168.00      3.36</span><br><span class="line">17æ—¶42åˆ†01ç§’ centos-swap      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line"></span><br><span class="line">å¹³å‡æ—¶é—´:       DEV       tps  rd_sec/s  wr_sec/s  avgrq-sz  avgqu-sz     await     svctm     %util</span><br><span class="line">å¹³å‡æ—¶é—´:       vda      0.10      0.00      0.10      1.00      0.01    112.00    103.67      1.04</span><br><span class="line">å¹³å‡æ—¶é—´: centos-root      0.07      0.00      0.10      1.50      0.01    168.00    168.00      1.12</span><br><span class="line">å¹³å‡æ—¶é—´: centos-swap      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</span><br><span class="line">-----------------------------------------------------------------------------------------</span><br><span class="line">-p : å¯ä»¥æ‰“å°å‡ºvdaã€centos-rootã€centos-swapç­‰ç£ç›˜è®¾å¤‡åç§°ï¼Œå¦‚æœä¸ç”¨å‚æ•°-pï¼Œè®¾å¤‡èŠ‚ç‚¹åˆ™æœ‰å¯èƒ½æ˜¯åˆ«çš„</span><br><span class="line">tps : æ¯ç§’ä»ç‰©ç†ç£ç›˜I/Oçš„æ¬¡æ•°ï¼Œå¤šä¸ªé€»è¾‘è¯·æ±‚ä¼šè¢«åˆå¹¶ä¸ºä¸€ä¸ªI/Oç£ç›˜è¯·æ±‚ï¼Œä¸€æ¬¡ä¼ è¾“çš„å¤§å°æ˜¯ä¸ç¡®å®šçš„ã€‚</span><br><span class="line">rd_sec/s : æ¯ç§’è¯»æ‰‡åŒºçš„æ¬¡æ•°</span><br><span class="line">wr_sec/s : æ¯ç§’å†™æ‰‡åŒºçš„æ¬¡æ•°</span><br><span class="line">avgrp-sz : å¹³å‡æ¯æ¬¡è®¾å¤‡I/Oæ“ä½œçš„æ•°æ®å¤§å°ï¼ˆæ‰‡åŒºï¼‰</span><br><span class="line">avgqu-sz : ç£ç›˜è¯·æ±‚é˜Ÿåˆ—çš„å¹³å‡é•¿åº¦</span><br><span class="line">await : ä»è¯·æ±‚ç£ç›˜æ“ä½œåˆ°ç³»ç»Ÿå®Œæˆå¤„ç†ï¼Œæ¯æ¬¡è¯·æ±‚çš„å¹³å‡æ¶ˆè€—æ—¶é—´ï¼ŒåŒ…æ‹¬è¯·æ±‚é˜Ÿåˆ—ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼ˆ1ç§’=1000æ¯«ç§’ï¼‰</span><br><span class="line">svctm : ç³»ç»Ÿå¤„ç†æ¯æ¬¡è¯·æ±‚çš„å¹³å‡æ—¶é—´ï¼Œä¸åŒ…æ‹¬åœ¨è¯·æ±‚é˜Ÿåˆ—ä¸­æ¶ˆè€—çš„æ—¶é—´</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux_command </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux_command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bcâ€”æ•°å­—è®¡ç®—å™¨</title>
      <link href="/2020/03/07/bc-%E6%95%B0%E5%AD%97%E8%AE%A1%E7%AE%97%E5%99%A8/"/>
      <url>/2020/03/07/bc-%E6%95%B0%E5%AD%97%E8%AE%A1%E7%AE%97%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>bcå‘½ä»¤æ˜¯ä¸€ç§æ”¯æŒä»»æ„ç²¾åº¦çš„äº¤äº’æ‰§è¡Œçš„è®¡ç®—å™¨è¯­è¨€ã€‚bashå†…ç½®äº†å¯¹æ•´æ•°å››åˆ™è¿ç®—çš„æ”¯æŒï¼Œä½†æ˜¯å¹¶ä¸æ”¯æŒæµ®ç‚¹è¿ç®—ï¼Œè€Œbcå‘½ä»¤å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œæµ®ç‚¹è¿ç®—ï¼Œå½“ç„¶æ•´æ•°è¿ç®—ä¹Ÿä¸å†è¯ä¸‹ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# yum install bc</span><br></pre></td></tr></table></figure><h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-03 ~]# bc(é€‰é¡¹)(å‚æ•°)</span><br><span class="line">-iï¼šå¼ºåˆ¶è¿›å…¥äº¤äº’å¼æ¨¡å¼ï¼›</span><br><span class="line">-lï¼šå®šä¹‰ä½¿ç”¨çš„æ ‡å‡†æ•°å­¦åº“ï¼›</span><br><span class="line">-wï¼šå¯¹POSIX bcçš„æ‰©å±•ç»™å‡ºè­¦å‘Šä¿¡æ¯ï¼›</span><br><span class="line">-qï¼šä¸æ‰“å°æ­£å¸¸çš„GNU bcç¯å¢ƒä¿¡æ¯ï¼›</span><br><span class="line">-vï¼šæ˜¾ç¤ºæŒ‡ä»¤ç‰ˆæœ¬ä¿¡æ¯ï¼›</span><br><span class="line">-hï¼šæ˜¾ç¤ºæŒ‡ä»¤çš„å¸®åŠ©ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><h2 id="è®¡ç®—åŠ å‡ä¹˜é™¤"><a href="#è®¡ç®—åŠ å‡ä¹˜é™¤" class="headerlink" title="è®¡ç®—åŠ å‡ä¹˜é™¤"></a>è®¡ç®—åŠ å‡ä¹˜é™¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# bc</span><br><span class="line">2+3</span><br><span class="line">5</span><br><span class="line">5-2</span><br><span class="line">3</span><br><span class="line">2+3*1</span><br><span class="line">5</span><br><span class="line">6/2</span><br><span class="line">3</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¾“å…¥ quit é€€å‡º</span></span><br></pre></td></tr></table></figure><h2 id="ç®¡é“ç¬¦è¾“å…¥"><a href="#ç®¡é“ç¬¦è¾“å…¥" class="headerlink" title="ç®¡é“ç¬¦è¾“å…¥"></a>ç®¡é“ç¬¦è¾“å…¥</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# echo "1.212*3" | bc </span><br><span class="line">3.636</span><br></pre></td></tr></table></figure><h2 id="è®¾å®šå°æ•°ç²¾åº¦"><a href="#è®¾å®šå°æ•°ç²¾åº¦" class="headerlink" title="è®¾å®šå°æ•°ç²¾åº¦"></a>è®¾å®šå°æ•°ç²¾åº¦</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# echo "scale=3;3/8" | bc</span><br><span class="line">.375</span><br><span class="line"><span class="meta">#</span><span class="bash">å‚æ•°scale=3æ˜¯å°†bcè¾“å‡ºç»“æœçš„å°æ•°ä½è®¾ç½®ä¸º3ä½</span></span><br></pre></td></tr></table></figure><h2 id="å°†åè¿›åˆ¶è½¬æ¢æˆäºŒè¿›åˆ¶"><a href="#å°†åè¿›åˆ¶è½¬æ¢æˆäºŒè¿›åˆ¶" class="headerlink" title="å°†åè¿›åˆ¶è½¬æ¢æˆäºŒè¿›åˆ¶"></a>å°†åè¿›åˆ¶è½¬æ¢æˆäºŒè¿›åˆ¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# #!/bin/bash</span><br><span class="line">[root@RedHat_test ~]# abc=11000000</span><br><span class="line">[root@RedHat_test ~]# echo "obase=10;ibase=2;$abc" | bc</span><br><span class="line">192</span><br></pre></td></tr></table></figure><h2 id="å°†åè¿›åˆ¶è½¬åå…­è¿›åˆ¶"><a href="#å°†åè¿›åˆ¶è½¬åå…­è¿›åˆ¶" class="headerlink" title="å°†åè¿›åˆ¶è½¬åå…­è¿›åˆ¶"></a>å°†åè¿›åˆ¶è½¬åå…­è¿›åˆ¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# m=31</span><br><span class="line">[root@RedHat_test ~]# n=$(echo "obase=16;$m"|bc)</span><br><span class="line">[root@RedHat_test ~]# echo $n</span><br><span class="line">1F</span><br></pre></td></tr></table></figure><h2 id="å°†åå…­è¿›åˆ¶è½¬åè¿›åˆ¶"><a href="#å°†åå…­è¿›åˆ¶è½¬åè¿›åˆ¶" class="headerlink" title="å°†åå…­è¿›åˆ¶è½¬åè¿›åˆ¶"></a>å°†åå…­è¿›åˆ¶è½¬åè¿›åˆ¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# m=1E</span><br><span class="line">[root@RedHat_test ~]# n=$(echo "obase=10;ibase=16;$m"|bc)</span><br><span class="line">[root@RedHat_test ~]# echo $n</span><br><span class="line">30</span><br></pre></td></tr></table></figure><h2 id="è®¡ç®—å¹³æ–¹å’Œå¹³æ–¹æ ¹"><a href="#è®¡ç®—å¹³æ–¹å’Œå¹³æ–¹æ ¹" class="headerlink" title="è®¡ç®—å¹³æ–¹å’Œå¹³æ–¹æ ¹"></a>è®¡ç®—å¹³æ–¹å’Œå¹³æ–¹æ ¹</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# echo "10^10" | bc</span><br><span class="line">10000000000</span><br><span class="line">[root@RedHat_test ~]# echo "sqrt(100)" | bc</span><br><span class="line">10</span><br></pre></td></tr></table></figure><h2 id="è®¡ç®—å¹³å‡å€¼"><a href="#è®¡ç®—å¹³å‡å€¼" class="headerlink" title="è®¡ç®—å¹³å‡å€¼"></a>è®¡ç®—å¹³å‡å€¼</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# cat script.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¨ˆç®—å…©å€‹æ•¸çš„å¹³å‡å€¼</span></span><br><span class="line">ans=$(echo "($1 + $2) / 2" | bc -l)</span><br><span class="line">echo "å¹³å‡ç‚ºï¼š$ans"</span><br><span class="line">[root@RedHat_test ~]# chmod +x script.sh</span><br><span class="line">[root@RedHat_test ~]# ./script.sh 12 34</span><br><span class="line">å¹³å‡ç‚ºï¼š23.00000000000000000000</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux_command </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux_command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rsyslogâ€”æ—¥å¿—åŠé›†ä¸­åŒ–ç®¡ç†</title>
      <link href="/2020/03/07/rsyslog-%E6%97%A5%E5%BF%97%E9%9B%86%E4%B8%AD%E5%8C%96%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/"/>
      <url>/2020/03/07/rsyslog-%E6%97%A5%E5%BF%97%E9%9B%86%E4%B8%AD%E5%8C%96%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>rsyslog åœ¨Linuxä¸Šè‡ªå¸¦ï¼Œå…¼å®¹syslogè¯­æ³•ï¼Œåœ¨syslogåŸºç¡€ä¸Šå¢åŠ äº†æ›´å¤šåè®®çš„æ”¯æŒï¼Œé…åˆé¢å¤–moduleæ’ä»¶å¯ä»¥å®Œæˆå¾ˆå¤šåœºæ™¯çš„ä½¿ç”¨ã€‚å€Ÿç”¨ä¸‹å®˜ç½‘çš„å›¾ç‰‡ï¼š</p><p><img src="640-3.jpeg" alt="rsyslog-æ—¥å¿—é›†ä¸­åŒ–ç®¡ç†å·¥å…·"></p><p>æ³¨ï¼š Windows å¹³å°éœ€è¦ nxlog ï¼ˆnxlog æ˜¯ç”¨C è¯­è¨€å†™çš„ä¸€ä¸ªè·¨å¹³å°æ—¥å¿—æ”¶é›†å¤„ç†è½¯ä»¶ï¼‰ã€‚</p><p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦æŠŠçº¿ä¸Šç¯å¢ƒçš„debugæ—¥å¿—åŠé›†ä¸­åŒ–æ”¶é›†èµ·æ¥ï¼Œä¸€æ–¹é¢æ˜¯æ–¹ä¾¿å¼€å‘è°ƒè¯•ï¼›ä¸€æ–¹é¢æ˜¯é¿å…ç›´æ¥åˆ°çº¿ä¸Šç¯å¢ƒæŸ¥çœ‹ï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ã€‚</p><h2 id="å¸¸ç”¨å¯é€‰æ–¹æ¡ˆ"><a href="#å¸¸ç”¨å¯é€‰æ–¹æ¡ˆ" class="headerlink" title="å¸¸ç”¨å¯é€‰æ–¹æ¡ˆ"></a>å¸¸ç”¨å¯é€‰æ–¹æ¡ˆ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rsyslogå‘é€ç«¯ + rsyslogæ¥æ”¶ç«¯ï¼š ç›´æ¥å­˜åœ¨æ¥æ”¶ç«¯çš„æœ¬åœ°ç¡¬ç›˜</span><br><span class="line"></span><br><span class="line">rsyslogå‘é€ç«¯ + logstashæ¥æ”¶ç«¯ + &lt;åç»­ç¬¬ä¸‰æ–¹å¤„ç†&gt;ï¼š æ¥å—åˆ°logæ›´æ–°è¡Œåï¼Œé€šè¿‡logstashç®€å•å¤„ç†åï¼Œå¯ä»¥ç»§ç»­å¾€ç¬¬ä¸‰æ–¹å¤„ç†ï¼Œå¦‚æ”¾åˆ°ElasticSearchï¼Œæˆ–è€…æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—Kfakaç­‰</span><br><span class="line"></span><br><span class="line">rsyslogå‘é€ç«¯ + Splunkï¼š Splunkæ˜¯å•†ä¸šè½¯ä»¶ï¼Œä¹Ÿæ˜¯ä¸šå†…ç”¨çš„æ¯”è¾ƒå¤šçš„æ–¹å¼ï¼Œä»·æ ¼ä¸è²</span><br></pre></td></tr></table></figure><p>åŸºæœ¬åŸç†å’Œå¤„ç†æµç¨‹éƒ½æ˜¯ç±»ä¼¼çš„ï¼š ç›‘æ§æœ¬åœ°logæ–‡ä»¶å†…å®¹çš„å˜åŒ–ï¼Œç„¶åæŠŠå˜åŒ–çš„æ–‡ä»¶å†…å®¹å‘é€åˆ°è¿œç«¯æ”¶é›†æœåŠ¡ä¸Šã€‚</p><p>ä¾‹å¦‚å¸¸è¯´çš„ELKstackï¼ˆElasticSearch+Logstash+Kibanaï¼‰çš„ç¬¬ä¸€æ­¥éƒ½æ˜¯é…ç½®rsyslogå‘é€ç«¯ã€‚</p><p>ä¸ç®¡å“ªç§æ–¹æ¡ˆéƒ½å¾—ç›‘æ§æœ¬åœ°æ–‡ä»¶çš„å˜åŒ–ï¼Œrsyslogå±äºå¿…é€‰ã€‚æˆ‘ä»¬éœ€æ±‚æ¯”è¾ƒç®€å•ï¼Œæš‚æ—¶é€‰ç”¨äº†è½åœ°åˆ°æœ¬åœ°ç›˜ï¼Œé»˜è®¤å­˜å‚¨15å¤©debugæ—¥å¿—ã€‚</p><p>æœ¬æ–‡ä¸»è¦ä»‹ç»rsyslogå‘é€ç«¯ã€æ¥æ”¶ç«¯çš„é…ç½®ï¼Œä»¥åŠé‡åˆ°çš„ä¸€äº›å‘ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>åœ¨CentOS 6.8 Final ä¸Šè‡ªå¸¦çš„ç‰ˆæœ¬ä¸º 5.8.10ã€‚å¦‚éœ€æœ€æ–°ç‰ˆæœ¬ï¼Œå¯å‚è€ƒå®˜ç½‘ã€‚</p><p> <a href="http://www.rsyslog.com" target="_blank" rel="noopener">http://www.rsyslog.com</a> </p><p>V5ç‰ˆæœ¬å¼€å‘äº2010å¹´ï¼Œå±äºæ¯”è¾ƒæ—§çš„ç‰ˆæœ¬ï¼Œæœ€æ–°ç‰ˆæœ¬æ˜¯V8ï¼Œæ”¯æŒäº†æ›´å¤šçš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°å’Œæ›´å¤šmoduleï¼Œå½“ç„¶æ€§èƒ½ä¹Ÿæ›´å¥½ã€‚</p><p>ç¼ºç‚¹æ˜¯ï¼šæ–°æ—§é…ç½®è¯­æ³•ä¸å…¼å®¹ï¼Œè€Œé‡‡ç”¨å†…ç½®ç‰ˆæœ¬çš„å¦ä¸€ä¸ªå·æ‡’çš„å¥½å¤„æ˜¯äº‘ç«¯çš„é•œåƒä¹Ÿä¸éœ€è¦å†é¢å¤–å‡çº§ï¼Œèƒ½æ”¯æŒæ›´å¤šè€æœºå™¨ã€‚</p><p>åé¢ä»‹ç»ä»¥V5ç‰ˆæœ¬ä¸ºä¾‹ï¼Œå¦‚æœ‰ä¸åŒçš„ï¼Œä¼šå•ç‹¬æŒ‡å‡ºã€‚</p><h2 id="é…ç½®æ–‡ä»¶ä»‹ç»"><a href="#é…ç½®æ–‡ä»¶ä»‹ç»" class="headerlink" title="é…ç½®æ–‡ä»¶ä»‹ç»"></a>é…ç½®æ–‡ä»¶ä»‹ç»</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/sbin/rsyslogd : æ‰§è¡Œæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">/etc/rsyslog.conf : ä¸»é…ç½®æ–‡ä»¶:</span><br><span class="line"></span><br><span class="line">/etc/rsyslog.d/*.conf : è‡ªå®šä¹‰é…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">/etc/init.d/rsyslog restart : ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œé‡å¯æœåŠ¡</span><br></pre></td></tr></table></figure><h2 id="ä¸€ä»½é…ç½®æ–‡ä»¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†"><a href="#ä¸€ä»½é…ç½®æ–‡ä»¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†" class="headerlink" title="ä¸€ä»½é…ç½®æ–‡ä»¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†"></a>ä¸€ä»½é…ç½®æ–‡ä»¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MODULES</span><br><span class="line">RULES</span><br><span class="line">å…¨å±€æŒ‡ä»¤ï¼Œæ¨¡æ¿ï¼Œæ¨¡å—å‚æ•°ç­‰</span><br></pre></td></tr></table></figure><p>è‡ªå¸¦çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼Œå‚è€ƒåé¢çš„æ³¨é‡Šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rsyslog v5 configuration file</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For more information see /usr/share/doc/rsyslog-*/rsyslog_conf.html</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you experience problems, see http://www.rsyslog.com/doc/troubleshoot.html</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### MODULES #### # æ¨¡å—æ”¾åœ¨å¼€å¤´åŠ è½½</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ModLoad imuxsock <span class="comment"># provides support for local system logging (e.g. via logger command) # å¯ä»¥ç”¨æ¥è°ƒè¯•ï¼Œç¨åæœ‰ä¾‹å­</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ModLoad imklog <span class="comment"># provides kernel logging support (previously done by rklogd)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ModLoad</span> immark <span class="comment"># provides --MARK-- message capability</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides UDP syslog reception</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ModLoad</span> imudp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$UDPServerRun</span> 514</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides TCP syslog reception <span class="comment"># TCP serverï¼Œæ¥æ”¶ç«¯éœ€è¦åŠ è½½è¿™ä¸ªæ¨¡å—ï¼Œå‘é€ç«¯ä¸éœ€è¦</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ModLoad</span> imtcp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$InputTCPServerRun</span> 514</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### GLOBAL DIRECTIVES ####</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Use default timestamp format</span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat <span class="comment"># æ¶ˆæ¯æ ¼å¼</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> File syncing capability is disabled by default. This feature is usually not required,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> not useful and an extreme performance hit</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionFileEnableSync</span> on</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### RULES #### # ç”¨æ¥æŒ‡å®šå“ªç§ç±»å‹çš„ï¼Œå“ªç§çº§åˆ«çš„logï¼Œå‘é€ç»™è°å¤„ç†</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Log all kernel messages to the console.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Logging much <span class="keyword">else</span> clutters up the screen.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kern.* /dev/console</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Log anything (except mail) of level info or higher.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Don<span class="string">'t log private authentication messages!</span></span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none /var/log/messages</span><br><span class="line"><span class="meta">#</span><span class="bash"> The authpriv file has restricted access.</span></span><br><span class="line">authpriv.* /var/log/secure</span><br><span class="line"><span class="meta">#</span><span class="bash"> Log all the mail messages <span class="keyword">in</span> one place.</span></span><br><span class="line">mail.* -/var/log/maillog # '-' è¡¨ç¤ºå¼‚æ­¥</span><br><span class="line"><span class="meta">#</span><span class="bash"> Log cron stuff</span></span><br><span class="line">cron.* /var/log/cron</span><br><span class="line"><span class="meta">#</span><span class="bash"> Everybody gets emergency messages</span></span><br><span class="line">*.emerg *</span><br><span class="line"><span class="meta">#</span><span class="bash"> Save news errors of level crit and higher <span class="keyword">in</span> a special file.</span></span><br><span class="line">uucp,news.crit /var/log/spooler</span><br><span class="line"><span class="meta">#</span><span class="bash"> Save boot messages also to boot.log</span></span><br><span class="line">local7.* /var/log/boot.log # localå¼€å¤´çš„æ˜¯è‡ªå®šä¹‰çš„æ—¥å¿—ç±»å‹</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment">### begin forwarding rule ###</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The statement between the begin ... end define a SINGLE forwarding</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rule. They belong together, <span class="keyword">do</span> NOT split them. If you create multiple</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> forwarding rules, duplicate the whole block!</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Remote Logging (we use TCP <span class="keyword">for</span> reliable delivery)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> An on-disk queue is created <span class="keyword">for</span> this action. If the remote host is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> down, messages are spooled to disk and sent when it is up again.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$WorkDirectory</span> /var/lib/rsyslog <span class="comment"># where to place spool files</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionQueueFileName</span> fwdRule1 <span class="comment"># unique name prefix for spool files</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionQueueMaxDiskSpace</span> 1g <span class="comment"># 1gb space limit (use as much as possible)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionQueueSaveOnShutdown</span> on <span class="comment"># save messages to disk on shutdown</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionQueueType</span> LinkedList <span class="comment"># run asynchronously</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionResumeRetryCount</span> -1 <span class="comment"># infinite retries if host is down</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> remote host is: name/ip:port, e.g. 192.168.0.1:514, port optional</span></span><br><span class="line"><span class="meta">#</span><span class="bash">*.* @@remote-host:514</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment">### end of the forwarding rule ###</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Finally include all config files <span class="keyword">in</span> /etc/rsyslog.d. This allows overrides</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of the default configuration above.</span></span><br><span class="line"><span class="meta">$</span><span class="bash">IncludeConfig /etc/rsyslog.d/*.conf <span class="comment"># è¿™é‡Œä¼šè‡ªåŠ¨åŠ è½½è‡ªå®šä¹‰çš„*.confé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥è¦†ç›–é»˜è®¤å‚æ•°</span></span></span><br></pre></td></tr></table></figure><h2 id="æ¨¡å—-imfile"><a href="#æ¨¡å—-imfile" class="headerlink" title="æ¨¡å— imfile"></a>æ¨¡å— imfile</h2><p>ä¸ºäº†å®Œæˆæˆ‘ä»¬çš„ä»»åŠ¡ï¼Œé™¤äº†ä¸Šé¢é»˜è®¤çš„æ¨¡å—ï¼Œè¿˜éœ€è¦åŠ è½½ imfileï¼Œ,æ¥æŒ‡å®šç›‘æ§å“ªäº›æ–‡ä»¶ï¼Œå‚è€ƒæ–‡æ¡£ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">ModLoad imfile <span class="comment"># Load the imfile input module</span></span></span><br></pre></td></tr></table></figure><p>è¯¥æ¨¡å—æŠŠæ ‡å‡†çš„æ–‡æœ¬æ–‡ä»¶è½¬æ¢æˆsyslogçš„messageæ ¼å¼ï¼Œ æ‰€è°“æ ‡å‡†æ–‡æœ¬æ˜¯æŒ‡ï¼šä¿æŠ¤å¯æ‰“å°çš„å­—ç¬¦ï¼Œæ¯è¡Œä»¥ LFä½œä¸ºåˆ†éš”ç¬¦å·ã€‚ æ”¯æŒæ–‡ä»¶æ­£åœ¨åœ¨logrotateçš„æ—¶å€™ï¼Œä»èƒ½æ­£ç¡®å¤„ç†ã€‚</p><p>å®ƒä¼šæŠŠç›‘æ§æ–‡ä»¶çš„è¯»å–åˆ°å“ªä¸€ä¸ªä½ç½®ï¼ˆç±»ä¼¼æ¸¸æ ‡cursorï¼‰ï¼Œå­˜å‚¨åœ¨stateæ–‡ä»¶é‡Œï¼ˆç”± $WorkDirectory æŒ‡å®šï¼‰ã€‚</p><p>è¯¥æ¨¡å—æ”¯æŒå¦‚ä¸‹æŒ‡ä»¤ï¼Œä¸€ç»„å¦‚ä¸‹è®¾ç½®ï¼Œå¯ä»¥ç§°ä¸ºä¸€ä¸ª <strong>listener</strong>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">InputFileName /path/to/file <span class="comment"># å¾…ç›‘æ§çš„æ–‡ä»¶è·¯å¾„</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileTag tag <span class="comment"># æ–‡ä»¶å”¯ä¸€æ ‡è¯†tagï¼Œæœ€å¥½ä¿æŒå”¯ä¸€ï¼Œç”¨äºæ¥æ”¶ç«¯åŒºåˆ†åŸå§‹logæ–‡ä»¶ï¼Œå¯ä»¥åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚":"ã€","ç­‰</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileStateFile /path/to/state/file</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ã€é‡è¦ã€‘éœ€è¦ä¿è¯å‘é€ç«¯å”¯ä¸€ï¼Œè®°å½•è¯»å–åˆ°å“ªå„¿ï¼ŒçŠ¶æ€æ–‡ä»¶ä¿å­˜åœ¨<span class="variable">$WorkDirectory</span>ï¼Œé»˜è®¤ä¸º /var/lib/rsyslog</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœæŸä¸ªè¦ç›‘æ§çš„æ–‡ä»¶åå˜åŒ–äº†ï¼Œä¸€å®šè¦é‡æ–°è®¾ç½®è¯¥å€¼</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileFacility facility <span class="comment"># logç±»å‹ï¼Œé»˜è®¤local0ï¼Œ localå¼€å¤´çš„è¡¨ç¤ºè‡ªå®šä¹‰ç±»å‹</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileSeverity severity <span class="comment"># logçº§åˆ«ï¼šinfoï¼Œwarningï¼Œé»˜è®¤notice</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputRunFileMonitor <span class="comment"># å¯åŠ¨ç›‘æ§å½“å‰çš„æ–‡ä»¶ï¼Œå¦‚æœå¿˜è®°è¿™è¡Œï¼Œåˆ™å•¥äº‹ä¹Ÿä¸ä¼šå‘ç”Ÿ</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFilePollInterval seconds <span class="comment"># å…¨å±€è®¾ç½®ï¼Œé»˜è®¤è½®è¯¢æ˜¯10s</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFilePersistStateInterval lines <span class="comment"># æ¯å¤šå°‘è¡Œæ›´æ–°stateæ–‡ä»¶çŠ¶æ€</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileReadMode mode <span class="comment"># å®˜ç½‘ç«Ÿç„¶æ²¡è¿™ä¸ªè§£é‡Šï¼Œä¸è¿‡ä¹Ÿæ²¡ç”¨åˆ°ã€‚ã€‚ã€‚</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileMaxLinesAtOnce number</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤10240ï¼Œå¦‚æœåœ¨å‘é€ç«¯ï¼Œéœ€è¦åŒæ—¶ç›‘æ§å¤šä¸ªæ–‡ä»¶ï¼Œä¼šå¤„ç†å®Œå½“å‰æ–‡ä»¶ç‰¹å®šè¡Œåï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼Œé¿å…ä¸€ä¸ªæ–‡ä»¶ä¸€ç›´å ç”¨å¤„ç†ï¼Œå¯¼è‡´æ”¶é›†åˆ«çš„æ–‡ä»¶ä¸åŠæ—¶ã€‚</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileBindRuleset ruleset <span class="comment"># å±äºè¾ƒé«˜çº§çš„è®¾ç½®ï¼Œå¯ä»¥æŠŠè¿™ä¸ªlistenerç»‘å®šåˆ°ç‰¹ç‚¹çš„è§„åˆ™(http://www.rsyslog.com/doc/v5-stable/concepts/multi_ruleset.html)</span></span></span><br></pre></td></tr></table></figure><p>æ¥æ”¶ç«¯é…ç½®ï¼Œæ³¨æ„tagé‡Œçš„é€—å· <strong>â€˜,â€™</strong>ï¼Œç¨ååœ¨æ¥æ”¶ç«¯ï¼Œä¼šå®ƒæ¥åˆ†éš”ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> For product, total 19 files.</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileName /Data/logs/product/cache-Statistic.log</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileTag product,cache-Statistic</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileSeverity info</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileStateFile state_product_cache-Statistic</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFilePersistStateInterval 25000</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileFacility local5</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputRunFileMonitor</span></span><br></pre></td></tr></table></figure><h2 id="Rule-è®¾ç½®"><a href="#Rule-è®¾ç½®" class="headerlink" title="Rule è®¾ç½®"></a>Rule è®¾ç½®</h2><p>ä¸€æ¡ruleçš„è¯­æ³•æ ¼å¼å¦‚ï¼š <Facility>.<Severity> <Target></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Log cron stuff</span></span><br><span class="line">cron.* /var/log/cron</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®°å½•infoåˆ°æœ¬åœ°messagesæ–‡ä»¶ï¼Œ.none ç»“å°¾è¡¨ç¤ºæ’é™¤æ‰è¿™äº›æ–‡ä»¶ç±»å‹ã€‚</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none /var/log/messages</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰€æœ‰ä¸ºlocal5çš„ä»»æ„çº§åˆ«æ—¥å¿—å‘é€åˆ°è¿œç«¯514</span></span><br><span class="line">local5.* @@192.168.56.10:514</span><br></pre></td></tr></table></figure><h2 id="Facility"><a href="#Facility" class="headerlink" title="Facility"></a>Facility</h2><p>æ—¥å¿—è®¾å¤‡(å¯ä»¥ç†è§£ä¸ºæ—¥å¿—ç±»å‹):</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">auth #pamäº§ç”Ÿçš„æ—¥å¿—ï¼Œè®¤è¯æ—¥å¿—</span><br><span class="line">authpriv #ssh,ftpç­‰ç™»å½•ä¿¡æ¯çš„éªŒè¯ä¿¡æ¯ï¼Œè®¤è¯æˆæƒè®¤è¯</span><br><span class="line">cron #æ—¶é—´ä»»åŠ¡ç›¸å…³</span><br><span class="line">kern #å†…æ ¸</span><br><span class="line">lpr #æ‰“å°</span><br><span class="line">mail #é‚®ä»¶</span><br><span class="line">mark(syslog) #rsyslogæœåŠ¡å†…éƒ¨çš„ä¿¡æ¯,æ—¶é—´æ ‡è¯†</span><br><span class="line">news #æ–°é—»ç»„</span><br><span class="line">user #ç”¨æˆ·ç¨‹åºäº§ç”Ÿçš„ç›¸å…³ä¿¡æ¯</span><br><span class="line">uucp #unix to unix copy, unixä¸»æœºä¹‹é—´ç›¸å…³çš„é€šè®¯</span><br><span class="line">local 1~7 #è‡ªå®šä¹‰çš„æ—¥å¿—è®¾å¤‡</span><br></pre></td></tr></table></figure><h2 id="Severity"><a href="#Severity" class="headerlink" title="Severity"></a>Severity</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">debug #æœ‰è°ƒå¼ä¿¡æ¯çš„ï¼Œæ—¥å¿—ä¿¡æ¯æœ€å¤š</span><br><span class="line">info #ä¸€èˆ¬ä¿¡æ¯çš„æ—¥å¿—ï¼Œæœ€å¸¸ç”¨</span><br><span class="line">notice #æœ€å…·æœ‰é‡è¦æ€§çš„æ™®é€šæ¡ä»¶çš„ä¿¡æ¯</span><br><span class="line">warning, warn #è­¦å‘Šçº§åˆ«</span><br><span class="line">err, error #é”™è¯¯çº§åˆ«ï¼Œé˜»æ­¢æŸä¸ªåŠŸèƒ½æˆ–è€…æ¨¡å—ä¸èƒ½æ­£å¸¸å·¥ä½œçš„ä¿¡æ¯</span><br><span class="line">crit #ä¸¥é‡çº§åˆ«ï¼Œé˜»æ­¢æ•´ä¸ªç³»ç»Ÿæˆ–è€…æ•´ä¸ªè½¯ä»¶ä¸èƒ½æ­£å¸¸å·¥ä½œçš„ä¿¡æ¯</span><br><span class="line">alert #éœ€è¦ç«‹åˆ»ä¿®æ”¹çš„ä¿¡æ¯</span><br><span class="line">emerg, panic #å†…æ ¸å´©æºƒç­‰ä¸¥é‡ä¿¡æ¯</span><br></pre></td></tr></table></figure><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶ï¼š /var/log/messages</span><br><span class="line"></span><br><span class="line">ç”¨æˆ·ï¼š rootï¼Œ*ï¼ˆè¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·ï¼‰ï¼Œ ä¼šå‘åˆ°/var/spool/mail/æ”¶ä»¶ç®±é‡Œ</span><br><span class="line"></span><br><span class="line">æ—¥å¿—æœåŠ¡å™¨ï¼š @192.168.56.10 æˆ–è€… @@192.168.56.10</span><br><span class="line"></span><br><span class="line">ç®¡é“ï¼š | COMMAND</span><br><span class="line"></span><br><span class="line">ä¸€ä¸ª @ è¡¨ç¤º UDP, ä¸¤ä¸ª @@ è¡¨ç¤º TCP åè®®ã€‚</span><br></pre></td></tr></table></figure><h2 id="æ¨¡æ¿-template"><a href="#æ¨¡æ¿-template" class="headerlink" title="æ¨¡æ¿$template"></a>æ¨¡æ¿$template</h2><p>æ¨¡æ¿ $templateï¼Œ æœ€ä¸»è¦çš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œåœ¨ æ¥æ”¶ç«¯ å¯ç”¨æ¥å®šä¹‰æ¶ˆæ¯æ ¼å¼ã€æ–‡ä»¶åã€‚ä¸»è¦æ˜¯åœ¨æ¥æ”¶ç«¯ä½¿ç”¨ã€‚</p><p>å¯å‚è€ƒ å®˜æ–¹æ–‡æ¡£Templates</p><p>è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">template &lt;name&gt;,&lt;å†…å®¹&gt;,&lt;å¯é€‰é¡¹&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template MyTemplateName,<span class="string">"\7Text %property% some more text\n"</span>,&lt;options&gt;</span></span><br></pre></td></tr></table></figure><p>é»˜è®¤çš„æ¶ˆæ¯æ ¼å¼ RSYSLOG_TraditionalFileFormat</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;æ¥æ”¶å†…å®¹çš„æ—¶é—´&gt; &lt;å‘é€è€…çš„hostname&gt; &lt;$InputFileTag&gt; &lt;åŸå§‹æ¶ˆæ¯%msg%&gt;</span><br><span class="line">Dec 18 20:39:27 jumper-172-31-56-18 karltestdemoTag blala... dummy msg</span><br></pre></td></tr></table></figure><p>å¦‚æœåªéœ€è¦æ˜¾ç¤ºåŸå§‹æ¶ˆæ¯ï¼Œå¯è®¾ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">template CleanMsgFormat,<span class="string">"%msg%\n"</span></span></span><br></pre></td></tr></table></figure><h2 id="å†…ç½®å±æ€§-Properties"><a href="#å†…ç½®å±æ€§-Properties" class="headerlink" title="å†…ç½®å±æ€§ Properties"></a>å†…ç½®å±æ€§ Properties</h2><p>æ¨¡æ¿é‡Œæ”¯æŒä¸€äº› å†…ç½®çš„å˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash">msg%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">syslogfacility%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">HOSTNAME%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">syslogpriority%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">timereported:::date-mysql%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">timegenerated:::date-mysql%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">iut%</span></span><br><span class="line">'%syslogtag%'</span><br></pre></td></tr></table></figure><h2 id="å±æ€§å¤„ç†-Property-Replacer"><a href="#å±æ€§å¤„ç†-Property-Replacer" class="headerlink" title="å±æ€§å¤„ç† Property Replacer"></a>å±æ€§å¤„ç† Property Replacer</h2><p>Property Replacer ç”¨æ¥å¤„ç†å˜é‡ï¼Œæ”¯æŒä¸€äº›ç®€å•çš„å­—ç¬¦ä¸²å¤„ç†ï¼Œå¦‚å¤§å°å†™ï¼Œsubstringç­‰ï¼Œç±»ä¼¼jinja2çš„filteræ¦‚å¿µã€‚</p><p>ç‰ˆæœ¬è¶Šæ–°æ”¯æŒçš„å¤„ç†å‡½æ•°è¶Šå¼ºå¤§ã€‚</p><p>è¯­æ³•ï¼š </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash">property:fromChar:toChar:options%</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For product</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template productFileFormat,<span class="string">"/Data/logs/product/%fromhost-ip%/%syslogtag:F,44:2%-%<span class="variable">$YEAR</span>%%<span class="variable">$MONTH</span>%%<span class="variable">$DAY</span>%.log"</span></span></span><br><span class="line">if $syslogtag startswith 'product' then ?productFileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨æ¥æ”¶ç«¯ä¼šä¿å­˜ä¸º /Data/logs/product/198.168.56.123/karltest_demo-20161218.log</p><p>è§£é‡Šä¸‹è¿™ä¸ªæŒ‡ä»¤%syslogtag:F,44:2%</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">F : - ä»£è¡¨è‡ªå®šä¹‰ä¸€ä¸ªåˆ†éš”ç¬¦</span><br><span class="line"></span><br><span class="line">44 : - æ˜¯é€—å· , çš„ ASCII ç å€¼ï¼Œå¦‚éœ€è¦åˆ«çš„åˆ†éš”ç¬¦ï¼Œéœ€è¦æŸ¥å¯¹åº” ASCII å€¼</span><br><span class="line"></span><br><span class="line">2 : - å–åˆ†éš”åçš„ç¬¬äºŒä¸ªå­—æ®µ</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å°±æ˜¯ï¼š å‡è®¾å‘é€ç«¯è‡ªå®šä¹‰çš„tagä¸º $InputFileTag product,karltest_demoï¼Œ</p><p>å¦‚æœtagä»¥productå¼€å§‹ï¼Œåˆ™å–å‡ºé€—å·åˆ†éš”çš„ç¬¬äºŒä¸ªå­—æ®µä½œä¸ºä¿å­˜çš„æ–‡ä»¶åï¼Œè¿™ä¹Ÿæ˜¯ä¸ºå•¥ä¸Šé¢tagé‡Œè¦è®¾ç½®ä¸€ä¸ªé€—å·çš„ç¼˜æ•…ã€‚</p><p>å¦å¤–ï¼Œè¿˜æ”¯æŒä¸€å®šçš„ regex è¯­æ³•ï¼Œå¯ä»¥è¿›è¡Œæ›´é«˜çº§çš„æ§åˆ¶ã€‚å®˜æ–¹æä¾›äº†ä¸€ä¸ªåœ¨çº¿çš„ regex è¯­æ³•æµ‹è¯•ã€‚</p><p><em>å‹æƒ…æé†’ï¼šçœŸçš„å¾ˆéš¾ç”¨ã€‚ã€‚ã€‚</em></p><h2 id="åœæ­¢æŒ‡ä»¤"><a href="#åœæ­¢æŒ‡ä»¤" class="headerlink" title="åœæ­¢æŒ‡ä»¤"></a>åœæ­¢æŒ‡ä»¤</h2><p>ä¸Šé¢çš„æ¥æ”¶ç«¯ï¼Œåœ¨ä¸€æ¡è§„åˆ™åï¼ŒåŠ ä¸Šäº†å¦‚ä¸‹çš„æŒ‡ä»¤ï¼ˆä¹Ÿå«åœæ­¢æŒ‡ä»¤ï¼‰ï¼Œä»£è¡¨å¦‚æœlogè¢«å½“å‰çš„ruleå·²ç»å¤„ç†è¿‡äº†ï¼Œåˆ™å®Œæˆæœ¬æ¬¡æ‰§è¡Œï¼Œè·³è¿‡åç»­ruleçš„å¤„ç†ã€‚ ç±»ä¼¼ C++é‡Œ switch/caseï¼Œå¦‚æœå¿˜è®°åŠ breakçš„ç©¿é€å‰¯ä½œç”¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp; ~</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªæŒ‡ä»¤ï¼Œåˆ™ä¸€æ¡æ–°æ¥çš„æ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªruleå¤„ç†ã€‚ è¿™é‡Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ï¼Œåªè¦å‘½ä¸­å°±ä¿å­˜åˆ°æ¥æ”¶ç«¯åŒåçš„æ–‡ä»¶é‡Œã€‚</p><h2 id="å‘é€ç«¯é…ç½®"><a href="#å‘é€ç«¯é…ç½®" class="headerlink" title="å‘é€ç«¯é…ç½®"></a>å‘é€ç«¯é…ç½®</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. åŠ è½½ imfile æ¨¡å—</span><br><span class="line">2. æŒ‡å®šè¦ç›‘æ§çš„ log æ–‡ä»¶è·¯å¾„ï¼Œè®¾ç½®åˆé€‚çš„tag</span><br><span class="line">3. æŒ‡å®šè¿œç«¯çš„æ¥æ”¶ç«¯çš„åœ°å€</span><br></pre></td></tr></table></figure><p>å®Œæ•´é…ç½®ï¼š /etc/rsyslog.conf å’Œ /etc/rsyslog.d/product.conf</p><h2 id="æ¥æ”¶ç«¯é…ç½®"><a href="#æ¥æ”¶ç«¯é…ç½®" class="headerlink" title="æ¥æ”¶ç«¯é…ç½®"></a>æ¥æ”¶ç«¯é…ç½®</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. åŠ è½½ imtcp æ¨¡å—</span><br><span class="line">2. è®¾ç½® message æ ¼å¼</span><br><span class="line">3. è®¾ç½® æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼Œæ–‡ä»¶åæ ¼å¼</span><br></pre></td></tr></table></figure><p>å®Œæ•´é…ç½®ï¼š /etc/rsyslog.conf</p><h2 id="é‡åˆ°çš„å‘"><a href="#é‡åˆ°çš„å‘" class="headerlink" title="é‡åˆ°çš„å‘"></a>é‡åˆ°çš„å‘</h2><h3 id="UDP-or-TCP"><a href="#UDP-or-TCP" class="headerlink" title="UDP or TCP ?"></a>UDP or TCP ?</h3><p>ä¸€èˆ¬æ¥è¯´é€‰æ‹©TCPéƒ½æ˜¯OKçš„ï¼Œé™¤éå¿å—éƒ¨åˆ†ä¸¢å¤±ï¼Œåœ¨æ„å½±å“æ€§èƒ½ï¼Œå¯ä»¥æ”¹ç”¨UDPã€‚</p><p>ä½†æ˜¯æ³¨æ„ï¼šå¦‚æœä½ çš„æ¶ˆæ¯æ¯è¡Œå¤§å°è¶…è¿‡äº†4kï¼Œåªèƒ½ç”¨TCPã€‚è¿™æ˜¯å› ä¸ºUDPæ ˆå¤§å°é™åˆ¶çš„ã€‚</p><p>å¼•ç”¨å®˜æ–¹æœ‰å…³ MaxMessageSize çš„æè¿°ï¼š</p><blockquote><p>Note: testing showed that 4k seems to be the typical maximum for UDP based syslog. This is an IP stack restriction. Not always â€¦ but very often. If you go beyond that value, be sure to test that rsyslogd actually does what you think it should do ;) It is highly suggested to use a TCP based transport instead of UDP (plain TCP syslog, RELP). This resolves the UDP stack size restrictions.</p></blockquote><h3 id="å¦‚ä½•æµ‹è¯•ï¼š-vim-vs-echo"><a href="#å¦‚ä½•æµ‹è¯•ï¼š-vim-vs-echo" class="headerlink" title="å¦‚ä½•æµ‹è¯•ï¼š vim vs echo ?"></a>å¦‚ä½•æµ‹è¯•ï¼š vim vs echo ?</h3><p>é…ç½®å¥½æ¥æ”¶ç«¯ã€å‘é€ç«¯rsyslogåï¼Œéœ€è¦éªŒè¯ä¸‹æ˜¯å¦èƒ½æ­£ç¡®ä¼ é€æ–°çš„logè¡Œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. echoè¿½åŠ ï¼š echo "dummy message" &gt;&gt; /Data/logs/product/karltest.log</span><br><span class="line">2. vimç¼–è¾‘ï¼š vim /Data/logs/product/karltest.log</span><br></pre></td></tr></table></figure><p>ç”¨vimç¼–è¾‘åï¼Œä¿å­˜ä¼šåˆ·æ–°æ•´ä¸ªæ–‡ä»¶ï¼Œå¯¼è‡´rsyslogåœ¨æ¯”è¾ƒstate fileçš„æ—¶å€™ï¼Œè®¤ä¸ºå…¨éƒ¨æ˜¯æ–°å¢çš„è¡Œï¼Œä¼šåœ¨æ¥æ”¶ç«¯å‡ºç°é‡å¤çš„logè¡Œã€‚</p><p>æ‰€ä»¥æ­£ç¡®æµ‹è¯•æ–¹æ³•æ˜¯ç”¨ echo è¿½åŠ çš„æ–¹å¼ã€‚</p><blockquote><p>Tips:</p><p>å‘é€ç«¯ï¼šå¯ä»¥é…åˆ watch æ¥æµ‹è¯•ï¼š watch -n 1 â€œ echo $(date) dummy message &gt;&gt; /Data/logs/product/karltest.log â€œ</p><p>æ¥æ”¶ç«¯ï¼š tailf /Data/logs/karltest/karltest.log</p></blockquote><h3 id="æ¥æ”¶ç«¯ï¼šlogè¡Œå¤ªé•¿ï¼Œè¢«æˆªæ–­äº†"><a href="#æ¥æ”¶ç«¯ï¼šlogè¡Œå¤ªé•¿ï¼Œè¢«æˆªæ–­äº†" class="headerlink" title="æ¥æ”¶ç«¯ï¼šlogè¡Œå¤ªé•¿ï¼Œè¢«æˆªæ–­äº†"></a>æ¥æ”¶ç«¯ï¼šlogè¡Œå¤ªé•¿ï¼Œè¢«æˆªæ–­äº†</h3><p>é»˜è®¤å¤§å°æ˜¯2kï¼Œå¤§æ¦‚å¯ä»¥ä¿å­˜1000ä¸ªä¸­æ–‡å­—ç¬¦ï¼Œå‚è€ƒå®˜æ–¹è¯´æ˜ $MaxMessageSizeï¼Œ æœ€å°ä¹Ÿæ˜¯2kã€‚</p><p>åœ¨åŠ è½½imtcp/imudpä¹‹å‰è®¾ç½®ï¼Œ æ­¤é…ç½®åŒ…æ‹¬å‘é€å’Œæ¥æ”¶ï¼Œæ‰€ä»¥rsyslogå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯éƒ½è¦è®¾ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">MaxMessageSize 32k</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides TCP syslog reception</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ModLoad</span> imtcp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$InputTCPServerRun</span> 514</span></span><br></pre></td></tr></table></figure><h3 id="å‘é€ç«¯ï¼š-var-log-messages-æ–‡ä»¶å˜å¤§"><a href="#å‘é€ç«¯ï¼š-var-log-messages-æ–‡ä»¶å˜å¤§" class="headerlink" title="å‘é€ç«¯ï¼š/var/log/messages æ–‡ä»¶å˜å¤§"></a>å‘é€ç«¯ï¼š/var/log/messages æ–‡ä»¶å˜å¤§</h3><p>logé™¤äº†å‘é€åˆ°äº†æ¥æ”¶ç«¯ï¼Œè¿˜åœ¨æœ¬åœ° /var/log/messages é‡Œé‡å¤å‡ºç°äº†ï¼Œå¯¼è‡´messagesä¸ŠG</p><p>ç½ªé­ç¥¸é¦–æ˜¯é»˜è®¤çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹è¿™è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹å‰</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none /var/log/messages</span><br><span class="line"><span class="meta">#</span><span class="bash"> Fixå</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none;local5.none;local6.none /var/log/messages</span><br></pre></td></tr></table></figure><p>å› ä¸ºå‰é¢æœ‰é€šé…ç¬¦ *.info å¯¼è‡´æˆ‘ä»¬è‡ªå®šä¹‰çš„ local5.info ä¹Ÿä¼šå†™åˆ°æœ¬åœ°messagesæ–‡ä»¶ã€‚</p><p>ä¸ºäº†ä¿é™©ï¼Œè¯·æŠŠæ¥æ”¶ç«¯ã€å‘é€ç«¯çš„é…ç½®æ–‡ä»¶éƒ½ä¿®æ”¹æ‰ï¼Œå¿½ç•¥æ‰local5ã€‚</p><h3 id="æ¥æ”¶ç«¯ï¼šæ¶ˆæ¯è¢«å¤šä¸ªruleå¤„ç†"><a href="#æ¥æ”¶ç«¯ï¼šæ¶ˆæ¯è¢«å¤šä¸ªruleå¤„ç†" class="headerlink" title="æ¥æ”¶ç«¯ï¼šæ¶ˆæ¯è¢«å¤šä¸ªruleå¤„ç†"></a>æ¥æ”¶ç«¯ï¼šæ¶ˆæ¯è¢«å¤šä¸ªruleå¤„ç†</h3><p>åœ¨å‘½ä¸­æŸæ¡ruleåï¼Œç›´æ¥breakåœæ­¢</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if $syslogtag startswith 'product' then ?productFileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ–°ç‰ˆæœ¬v6ä¹‹åï¼Œå˜ä¸ºï¼š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rsyslogd: warning: ~ action is deprecated, consider using the <span class="string">'stop'</span> statement instead [try http://www.rsyslog.com/e/2307 ]</span></span><br><span class="line">if $syslogtag startswith 'product' then ?productFileFormat;CleanMsgFormat</span><br><span class="line">stop</span><br></pre></td></tr></table></figure><h3 id="æ¥æ”¶ç«¯ï¼š-ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ä¸å¯¹"><a href="#æ¥æ”¶ç«¯ï¼š-ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ä¸å¯¹" class="headerlink" title="æ¥æ”¶ç«¯ï¼š ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ä¸å¯¹"></a>æ¥æ”¶ç«¯ï¼š ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ä¸å¯¹</h3><p>è¦æ³¨æ„è‡ªå®šä¹‰tagçš„å‰ç¼€åŒ¹é…ï¼Œå¦‚æœä¸¤ä¸ªtagæœ‰å…±åŒçš„å‰ç¼€ï¼Œéœ€è¦æŠŠé•¿çš„æ”¾åœ¨å‰é¢ï¼Œè°ƒæ•´å¥½é¡ºåºã€‚</p><p>Fix å‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> For erp_wms</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template erp_wms_FileFormat,<span class="string">"/Data/logs/erp/wms/%fromhost-ip%/%syslogtag:F,44:2%-%<span class="variable">$YEAR</span>%%<span class="variable">$MONTH</span>%%<span class="variable">$DAY</span>%.log"</span></span></span><br><span class="line">if $syslogtag startswith 'erp_wms' then ?erp_wms_FileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br><span class="line"><span class="meta">#</span><span class="bash"> For erp_wms3</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template erp_wms3_FileFormat,<span class="string">"/Data/logs/erp/wms3/%fromhost-ip%/%syslogtag:F,44:2%-%<span class="variable">$YEAR</span>%%<span class="variable">$MONTH</span>%%<span class="variable">$DAY</span>%.log"</span></span></span><br><span class="line">if $syslogtag startswith 'erp_wms3' then ?erp_wms3_FileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br></pre></td></tr></table></figure><p>Fix åï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿™é‡Œæ³¨æ„ä¸‹é¢çš„tagçš„é¡ºåºï¼Œ ä¸€å®šè¦è®©é•¿çš„tagï¼ˆerp_wms3ï¼‰ä¿æŒåœ¨ä¸Šé¢ï¼Œå› ä¸ºä»–ä»¬æœ‰å…±åŒçš„å‰ç¼€(erp_wms)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For erp_wms3</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template erp_wms3_FileFormat,<span class="string">"/Data/logs/erp/wms3/%fromhost-ip%/%syslogtag:F,44:2%-%<span class="variable">$YEAR</span>%%<span class="variable">$MONTH</span>%%<span class="variable">$DAY</span>%.log"</span></span></span><br><span class="line">if $syslogtag startswith 'erp_wms3' then ?erp_wms3_FileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br><span class="line"><span class="meta">#</span><span class="bash"> For erp_wms</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template erp_wms_FileFormat,<span class="string">"/Data/logs/erp/wms/%fromhost-ip%/%syslogtag:F,44:2%-%<span class="variable">$YEAR</span>%%<span class="variable">$MONTH</span>%%<span class="variable">$DAY</span>%.log"</span></span></span><br><span class="line">if $syslogtag startswith 'erp_wms' then ?erp_wms_FileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br></pre></td></tr></table></figure><h3 id="æ¥æ”¶ç«¯ï¼š-rsyslog-æ–‡ä»¶åå¤ªé•¿åè¢«æˆªæ–­"><a href="#æ¥æ”¶ç«¯ï¼š-rsyslog-æ–‡ä»¶åå¤ªé•¿åè¢«æˆªæ–­" class="headerlink" title="æ¥æ”¶ç«¯ï¼š rsyslog æ–‡ä»¶åå¤ªé•¿åè¢«æˆªæ–­"></a>æ¥æ”¶ç«¯ï¼š rsyslog æ–‡ä»¶åå¤ªé•¿åè¢«æˆªæ–­</h3><p>æ¯”å¦‚å‘é€ç«¯åŸå§‹æ–‡ä»¶åtag: productï¼Œcache_status_im_request.log</p><p>ä½†æ˜¯åˆ°äº†æ¥æ”¶ç«¯å°±æˆªæ–­äº†ï¼š cache_status_im_re-20161218.log</p><p>å› ä¸ºæœ¬æ¥åå­—å°±é•¿ï¼ŒåŠ ä¸Šäº†æ—¶é—´åæ›´é•¿äº†ï¼Œ</p><p>ä¸ªäººç†è§£ï¼ŒLinuxä¸­å…³äºæ–‡ä»¶åï¼ˆ255ï¼‰ï¼Œæ–‡ä»¶è·¯å¾„ï¼ˆ4096ï¼‰çš„é™åˆ¶å¦‚ä¸‹ï¼Œè€Œåœ¨æ¥æ”¶ç«¯ï¼Œéƒ½æ²¡æœ‰è¶…è¿‡è¿™ä¸ªé•¿åº¦ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /usr/include/linux/limits.h</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ifndef _LINUX_LIMITS_H</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define _LINUX_LIMITS_H</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define NR_OPEN         1024</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define NGROUPS_MAX    65536    /* supplemental group IDs are available */</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define ARG_MAX       131072    /* <span class="comment"># bytes of args + environ for exec() */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define LINK_MAX         127    /* <span class="comment"># links a file may have */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define MAX_CANON        255    /* size of the canonical input queue */</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define MAX_INPUT        255    /* size of the <span class="built_in">type</span>-ahead buffer */</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define NAME_MAX         255    /* <span class="comment"># chars in a file name */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define PATH_MAX        4096    /* <span class="comment"># chars in a path name including nul */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define PIPE_BUF        4096    /* <span class="comment"># bytes in atomic write to a pipe */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define XATTR_NAME_MAX   255    /* <span class="comment"># chars in an extended attribute name */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define XATTR_SIZE_MAX 65536    /* size of an extended attribute value (64k) */</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define XATTR_LIST_MAX 65536    /* size of extended attribute namelist (64k) */</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define RTSIG_MAX         32</span></span><br><span class="line"><span class="meta">#</span><span class="bash">endif</span></span><br></pre></td></tr></table></figure><p>è¿›è¿‡ä¸€ç•ªè‰°éš¾çš„æµ‹è¯•å¤ç°ï¼ŒçŒœæµ‹æ˜¯ $InputFileTag è¿™ä¸ª %syslogtag%çš„åŸå› ã€‚</p><p>å®˜æ–¹è§£é‡ŠSending messages with tags larger than 32 charactersã€‚</p><p>å‘é€ç«¯é»˜è®¤çš„æ¨¡æ¿ä¸ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¿½ç•¥æ—§çš„5.8.6çš„è¯­æ³•</span></span><br><span class="line">template (name="ForwardFormat" type="string" string="&lt;%PRI%&gt;%TIMESTAMP:::date-rfc3339% %HOSTNAME%</span><br><span class="line"><span class="meta">%</span><span class="bash">syslogtag:1:32%%msg:::sp-if-no-1st-sp%%msg%<span class="string">")</span></span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° %syslogtag:1:32%ï¼Œè¢«æˆªæ–­åˆ°32å­—ç¬¦ï¼Œè¿™ä¸ªä¹Ÿä¸æˆ‘æµ‹è¯•çš„ç»“æœä¸€è‡´ã€‚</p><p>æ‰€ä»¥å¦‚æœéœ€è¦å¤„ç†æ›´é•¿çš„tagï¼Œéœ€è¦ä¿®æ”¹ å‘é€ç«¯çš„templateæ¨¡æ¿ï¼Œå»æ‰ :1:32 é™åˆ¶ã€‚</p><p>ç„¶åç»‘å®šè¿™ä¸ªæ¨¡æ¿åˆ°å¯¹åº”çš„targetä¸Šã€‚</p><p>æ³¨æ„ï¼šæ¥æ”¶ç«¯å¯èƒ½ä¹Ÿè¦ç›¸åº”å¤„ç†ï¼Œæ‰èƒ½handleæ›´é•¿çš„tagåï¼ˆæœªæµ‹è¯•ï¼‰ã€‚</p><blockquote><p>å…è´£å£°æ˜ï¼šç”±äºæŠ˜è…¾è¿™ä¸ªrsyslogå¤ªç´¯ï¼Œæœ€åä¸€æ¡æš‚æ—¶æ²¡æœ‰Fixï¼Œå¦‚æœ‰éœ€è¦ï¼Œè¯·è‡ªè¡Œæµ‹è¯•åå†ç”¨ã€‚</p></blockquote><h3 id="å¦‚ä¸‹çš„ä¸¤ä¸ª-syslogtag-ï¼Œç”±äºå‰32ä¸ªå­—ç¬¦éƒ½ç›¸åŒï¼Œå¯¼è‡´æœ€åæ—¥å¿—å†™åˆ°åŒä¸€ä¸ªæ–‡ä»¶-databas-log-æŒ‰ç…§é€—å·åˆ‡å‰²å-äº†"><a href="#å¦‚ä¸‹çš„ä¸¤ä¸ª-syslogtag-ï¼Œç”±äºå‰32ä¸ªå­—ç¬¦éƒ½ç›¸åŒï¼Œå¯¼è‡´æœ€åæ—¥å¿—å†™åˆ°åŒä¸€ä¸ªæ–‡ä»¶-databas-log-æŒ‰ç…§é€—å·åˆ‡å‰²å-äº†" class="headerlink" title="å¦‚ä¸‹çš„ä¸¤ä¸ª%syslogtag%ï¼Œç”±äºå‰32ä¸ªå­—ç¬¦éƒ½ç›¸åŒï¼Œå¯¼è‡´æœ€åæ—¥å¿—å†™åˆ°åŒä¸€ä¸ªæ–‡ä»¶ databas.log (æŒ‰ç…§é€—å·åˆ‡å‰²å)äº†"></a>å¦‚ä¸‹çš„ä¸¤ä¸ª%syslogtag%ï¼Œç”±äºå‰32ä¸ªå­—ç¬¦éƒ½ç›¸åŒï¼Œå¯¼è‡´æœ€åæ—¥å¿—å†™åˆ°åŒä¸€ä¸ªæ–‡ä»¶ databas.log (æŒ‰ç…§é€—å·åˆ‡å‰²å)äº†</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">InputFileName /Data/logs/mqorder/order-mq-aws/database-stat.log</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileTag erp_mqorder-order-mq-aws,database-stat <span class="comment"># é•¿åº¦39</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileName /Data/logs/mqorder/order-mq-aws/database-timeout.log</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileTag erp_mqorder-order-mq-aws,database-timeout <span class="comment"># é•¿åº¦42</span></span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ³•-ï¼š"><a href="#è§£å†³æ–¹æ³•-ï¼š" class="headerlink" title="è§£å†³æ–¹æ³• ï¼š"></a>è§£å†³æ–¹æ³• ï¼š</h3><p>åœ¨å‘é€ç«¯çš„ä¸»é…ç½®æ–‡ä»¶ /etc/rsyslog.confé‡Œä¿®æ”¹å‘é€è§„åˆ™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment">### begin forwarding rule ###</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">template LongTagForwardFormat,<span class="string">"&lt;%PRI%&gt;%TIMESTAMP:::date-rfc3339% %HOSTNAME% %syslogtag%%msg:::sp-if-no-1st-sp%%msg%"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">WorkDirectory /var/lib/rsyslog <span class="comment"># where to place spool files</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionQueueFileName karlzhou_fwdRule <span class="comment"># unique name prefix for spool files</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionQueueMaxDiskSpace 5g <span class="comment"># 5gb space limit (use as much as possible)</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionQueueSaveOnShutdown on <span class="comment"># save messages to disk on shutdown</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionQueueType LinkedList <span class="comment"># run asynchronously</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionResumeRetryCount -1 <span class="comment"># infinite retries if host is down</span></span></span><br><span class="line">local5.* @@rsyslog.karlzhou.org:514;LongTagForwardFormat</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment">### end of the forwarding rule ###</span></span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­èµ·ä½œç”¨çš„å°±æ˜¯ LongTagForwardFormat è¿™ä¸ªæ¨¡æ¿ã€‚</p><h3 id="è§£å†³è¿‡ç¨‹-ï¼š"><a href="#è§£å†³è¿‡ç¨‹-ï¼š" class="headerlink" title="è§£å†³è¿‡ç¨‹ ï¼š"></a>è§£å†³è¿‡ç¨‹ ï¼š</h3><p>å‚è€ƒäº†ä¸Šé¢çš„é“¾æ¥: å®˜æ–¹è§£é‡ŠSending messages with tags larger than 32 characters å’Œ tag getting truncatedã€‚</p><p>å®˜æ–¹è§£é‡Šé‡Œæ˜¯ 5.8.6 çš„æ—§çš„è¯­æ³•ï¼Œè€ŒCentOS6.x Finalä¸Šè‡ªå¸¦çš„æ˜¯ 5.8.10ï¼Œ è¯­æ³•ä¸ä¸€æ ·ã€‚</p><p>ä»å®˜ç½‘ä¸‹è½½5.8.10çš„æºç : <a href="http://www.rsyslog.com/files/download/rsyslog/rsyslog-5.8.10.tar.gz" target="_blank" rel="noopener">http://www.rsyslog.com/files/download/rsyslog/rsyslog-5.8.10.tar.gz</a></p><p>å…¨æ–‡æœç´¢å…³é”®å­— %syslogtagï¼Œ æœ€ç»ˆåœ¨å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶æ‰¾åˆ°è››ä¸é©¬è¿¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rsyslog-5.8.10/tools/smfwd.c</span><br><span class="line"></span><br><span class="line">rsyslog-5.8.10/tools/smtradfile.c</span><br><span class="line"></span><br><span class="line">rsyslog-5.8.10/tools/smtradfwd.c</span><br><span class="line"></span><br><span class="line">rsyslog-5.8.10/tools/syslogd.c</span><br><span class="line"></span><br><span class="line">å…¨æ–‡æœç´¢å…³é”®å­— ForwardFormat:</span><br><span class="line"></span><br><span class="line">rsyslog-5.8.10/tools/syslogd.c</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/* hardcoded standard templates (used for defaults) */</span><br><span class="line">static uchar template_DebugFormat[] = "\"Debug line with all properties:\nFROMHOST: '%FROMHOST%', fromhost-ip: '%fromhost-ip%', HOSTNAME: '%HOSTNAME%', PRI: %PRI%,\nsyslogtag '%syslogtag%', programname: '%programname%', APP-NAME: '%APP-NAME%', PROCID: '%PROCID%', MSGID: '%MSGID%',\nTIMESTAMP: '%TIMESTAMP%', STRUCTURED-DATA: '%STRUCTURED-DATA%',\nmsg: '%msg%'\nescaped msg: '%msg:::drop-cc%'\ninputname: %inputname% rawmsg: '%rawmsg%'\n\n\"";</span><br><span class="line">static uchar template_SyslogProtocol23Format[] = "\"&lt;%PRI%&gt;1 %TIMESTAMP:::date-rfc3339% %HOSTNAME% %APP-NAME% %PROCID% %MSGID% %STRUCTURED-DATA% %msg%\n\"";</span><br><span class="line">static uchar template_TraditionalFileFormat[] = "=RSYSLOG_TraditionalFileFormat";</span><br><span class="line">static uchar template_FileFormat[] = "=RSYSLOG_FileFormat";</span><br><span class="line">static uchar template_ForwardFormat[] = "=RSYSLOG_ForwardFormat";</span><br><span class="line">static uchar template_TraditionalForwardFormat[] = "=RSYSLOG_TraditionalForwardFormat";</span><br><span class="line">static uchar template_WallFmt[] = "\"\r\n\7Message from syslogd@%HOSTNAME% at %timegenerated% ...\r\n %syslogtag%%msg%\n\r\"";</span><br><span class="line">static uchar template_StdUsrMsgFmt[] = "\" %syslogtag%%msg%\n\r\"";</span><br><span class="line">static uchar template_StdDBFmt[] = "\"insert into SystemEvents (Message, Facility, FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values ('%msg%', %syslogfacility%, '%HOSTNAME%', %syslogpriority%, '%timereported:::date-mysql%', '%timegenerated:::date-mysql%', %iut%, '%syslogtag%')\",SQL";</span><br><span class="line">static uchar template_StdPgSQLFmt[] = "\"insert into SystemEvents (Message, Facility, FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values ('%msg%', %syslogfacility%, '%HOSTNAME%', %syslogpriority%, '%timereported:::date-pgsql%', '%timegenerated:::date-pgsql%', %iut%, '%syslogtag%')\",STDSQL";</span><br><span class="line">static uchar template_spoofadr[] = "\"%fromhost-ip%\"";</span><br><span class="line">/* end templates */</span><br></pre></td></tr></table></figure><p>æ­£å¦‚å®˜ç½‘é“¾æ¥æ‰€è¯´ï¼Œæºç é‡Œ hardcoded é‡Œå¤šä¸ªé»˜è®¤æ¨¡æ¿æ ¼å¼ï¼Œ</p><p>å…¶ä¸­æˆ‘ä»¬éœ€è¦å…³æ³¨çš„å°±æ˜¯ RSYSLOG_ForwardFormat, å¯¹åº”çš„æ–‡ä»¶å³ï¼šrsyslog-5.8.10/tools/smfwd.cã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/* smfwd.c</span><br><span class="line">* This is a strgen module for the traditional (network) forwarding format.</span><br><span class="line">*</span><br><span class="line">* Format generated:</span><br><span class="line">* "&lt;%PRI%&gt;%TIMESTAMP:::date-rfc3339% %HOSTNAME% %syslogtag:1:32%%msg:::sp-if-no-1st-sp%%msg%"</span><br><span class="line">*</span><br><span class="line">* NOTE: read comments in module-template.h to understand how this file</span><br><span class="line">* works!</span><br><span class="line">*</span><br><span class="line">* File begun on 2010-06-01 by RGerhards</span><br><span class="line">*</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œå°±èƒ½æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„æ­£ç¡®çš„é»˜è®¤æ ¼å¼äº†, å¯ä»¥çœ‹åˆ° %syslogtag% æˆªå–äº†å‰é¢32ä¸ªå­—ç¬¦ï¼ŒæŠŠForwardFormatè§„åˆ™æ›¿æ¢æˆå®Œæ•´çš„ %syslogtag% å³å¯ï¼Œæ³¨æ„ï¼šæœ€å¤§çš„é•¿åº¦æ˜¯512ã€‚</p><h3 id="æ¥ä¸‹æ¥â€¦â€¦"><a href="#æ¥ä¸‹æ¥â€¦â€¦" class="headerlink" title="æ¥ä¸‹æ¥â€¦â€¦"></a>æ¥ä¸‹æ¥â€¦â€¦</h3><p>é€šè¿‡ä¸€ç•ªè®¾ç½®ï¼Œæˆ‘ä»¬å·²ç»èƒ½æˆåŠŸæ”¶é›†è‹¥å¹²å°çº¿ä¸Šæœºå™¨çš„æ—¥å¿—äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> tree -I <span class="string">"*gz|*log"</span> /Data/logs/</span></span><br><span class="line">/Data/logs/</span><br><span class="line">â”œâ”€â”€ gateway</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.18</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.19</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.195</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.197</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.198</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â””â”€â”€ 172.31.70.20</span><br><span class="line">â”‚   â””â”€â”€ archived</span><br><span class="line">â”œâ”€â”€ product</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.118</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.119</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.23</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â””â”€â”€ 172.31.70.24</span><br><span class="line">â”‚   â””â”€â”€ archived</span><br><span class="line">...</span><br><span class="line"><span class="meta">#</span><span class="bash"> du -sh /Data/logs</span></span><br><span class="line">271G /Data/logs</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p><blockquote><p>ä¸Šç™¾å°æœºå™¨çš„ä¸Šå‡ ç™¾Gçš„æ—¥å¿—ï¼Œæ€ä¹ˆæ‰èƒ½é¿å…æ¥æ”¶ç«¯ç¡¬ç›˜çˆ†æ‰ï¼Ÿ</p></blockquote><p>å¾—ç”¨å¦ä¸€ä¸ªLinuxè‡ªå¸¦çš„è„šæœ¬ /usr/sbin/logrotate, æ¥é…åˆ rsyslogã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux_command </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux_command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†</title>
      <link href="/2020/03/05/Centos-%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/"/>
      <url>/2020/03/05/Centos-%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><strong>è¿›ç¨‹æ˜¯å·²å¯åŠ¨çš„å¯æ‰§è¡Œç¨‹åºçš„è¿è¡Œå®ä¾‹ï¼Œè¿›ç¨‹æœ‰ä»¥ä¸‹ç»„æˆéƒ¨åˆ†ï¼š</strong>   </p><p><strong>å·²åˆ†é…å†…å­˜çš„åœ°å€ç©ºé—´ï¼›</strong>   </p><p><strong>å®‰å…¨å±æ€§ï¼ŒåŒ…æ‹¬æ‰€æœ‰æƒå‡­æ®å’Œç‰¹æƒï¼›</strong>   </p><p><strong>ç¨‹åºä»£ç çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ‰§è¡Œçº¿ç¨‹ï¼›</strong>   </p><p><strong>è¿›ç¨‹çŠ¶æ€</strong></p><p><strong>ç¨‹åºï¼š</strong> äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé™æ€ /bin/date, /usr/sbin/httpdï¼Œ/usr/sbin/sshd, /usr/local/nginx/sbin/nginx ã€‚</p><p><strong>è¿›ç¨‹ï¼š</strong> æ˜¯ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ï¼Œ åŠ¨æ€ï¼Œæœ‰ç”Ÿå‘½å‘¨æœŸåŠè¿è¡ŒçŠ¶æ€ã€‚</p><h2 id="è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"></a>è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="640.png" alt="Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†"></p><p><strong>æè¿°å¦‚ä¸‹ï¼š</strong></p><p>çˆ¶è¿›ç¨‹å¤åˆ¶è‡ªå·±çš„åœ°å€ç©ºé—´ï¼ˆfork  <strong>[fÉ”:k]</strong> åˆ†å‰ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼ˆå­ï¼‰è¿›ç¨‹ç»“æ„ã€‚æ¯ä¸ªæ–°è¿›ç¨‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¿›ç¨‹ ID ï¼ˆPIDï¼‰ï¼Œæ»¡è¶³è·Ÿè¸ªå®‰å…¨æ€§ä¹‹éœ€ã€‚PID å’Œ çˆ¶è¿›ç¨‹ ID ï¼ˆPPIDï¼‰æ˜¯å­è¿›ç¨‹ç¯å¢ƒçš„å…ƒç´ ï¼Œä»»ä½•è¿›ç¨‹éƒ½å¯ä»¥åˆ›å»ºå­è¿›ç¨‹ï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½æ˜¯ç¬¬ä¸€ä¸ªç³»ç»Ÿè¿›ç¨‹çš„åä»£ã€‚</p><p><strong>centos5æˆ–6PIDä¸º1çš„è¿›ç¨‹æ˜¯ï¼š</strong>init   </p><p><strong>centos7 PIDä¸º1çš„è¿›ç¨‹æ˜¯ï¼š</strong>systemd</p><p><strong>åƒµå°¸è¿›ç¨‹ï¼š</strong>ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨forkåˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨waitæˆ–waitpidè·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ã€‚è¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµå°¸è¿›ç¨‹ã€‚</p><p><strong>ç”¨è‡ªå·±çš„è¯è¡¨è¾¾</strong>:çˆ¶è¿›ç¨‹é€€å‡ºäº†ï¼Œå­è¿›ç¨‹æ²¡æœ‰é€€å‡ºï¼Œ é‚£ä¹ˆè¿™äº›å­è¿›ç¨‹å°±æ²¡æœ‰çˆ¶è¿›ç¨‹æ¥ç®¡ç†äº†ï¼Œå°±å˜æˆåƒµå°¸è¿›ç¨‹ã€‚</p><h2 id="è¿›ç¨‹çš„å±æ€§"><a href="#è¿›ç¨‹çš„å±æ€§" class="headerlink" title="è¿›ç¨‹çš„å±æ€§"></a>è¿›ç¨‹çš„å±æ€§</h2><p><strong>è¿›ç¨‹IDï¼ˆPID)ï¼š</strong>æ˜¯å”¯ä¸€çš„æ•°å€¼ï¼Œç”¨æ¥åŒºåˆ†è¿›ç¨‹</p><p><strong>çˆ¶è¿›ç¨‹çš„IDï¼ˆPPID)</strong></p><p><strong>å¯åŠ¨è¿›ç¨‹çš„ç”¨æˆ·ID</strong>ï¼ˆUIDï¼‰å’Œæ‰€å½’å±çš„ç»„ï¼ˆGIDï¼‰</p><p><strong>è¿›ç¨‹çŠ¶æ€ï¼š</strong>çŠ¶æ€åˆ†ä¸ºè¿è¡ŒRã€ä¼‘çœ Sã€åƒµå°¸Z</p><p><strong>è¿›ç¨‹æ‰§è¡Œçš„ä¼˜å…ˆçº§</strong></p><p><strong>è¿›ç¨‹æ‰€è¿æ¥çš„ç»ˆç«¯å</strong></p><p><strong>è¿›ç¨‹èµ„æºå ç”¨ï¼š</strong>æ¯”å¦‚å ç”¨èµ„æºå¤§å°ï¼ˆå†…å­˜ã€CPUå ç”¨é‡ï¼‰</p><h2 id="ä½¿ç”¨psæŸ¥çœ‹è¿›ç¨‹å·¥å…·"><a href="#ä½¿ç”¨psæŸ¥çœ‹è¿›ç¨‹å·¥å…·" class="headerlink" title="ä½¿ç”¨psæŸ¥çœ‹è¿›ç¨‹å·¥å…·"></a>ä½¿ç”¨psæŸ¥çœ‹è¿›ç¨‹å·¥å…·</h2><h3 id="å¸¸ç”¨çš„å‚æ•°ï¼š"><a href="#å¸¸ç”¨çš„å‚æ•°ï¼š" class="headerlink" title="å¸¸ç”¨çš„å‚æ•°ï¼š"></a>å¸¸ç”¨çš„å‚æ•°ï¼š</h3><p><strong>a:</strong> <strong>æ˜¾ç¤ºè·Ÿå½“å‰ç»ˆç«¯å…³è”çš„æ‰€æœ‰è¿›ç¨‹</strong></p><p><strong>u:</strong> <strong>åŸºäºç”¨æˆ·çš„æ ¼å¼æ˜¾ç¤ºï¼ˆ</strong>U: æ˜¾ç¤ºæŸç”¨æˆ·IDæ‰€æœ‰çš„è¿›ç¨‹ï¼‰</p><p><strong>x:</strong> <strong>æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ï¼Œä¸ä»¥ç»ˆç«¯æœºæ¥åŒºåˆ†</strong></p><h3 id="å¸¸ç”¨çš„é€‰é¡¹ç»„åˆ"><a href="#å¸¸ç”¨çš„é€‰é¡¹ç»„åˆ" class="headerlink" title="å¸¸ç”¨çš„é€‰é¡¹ç»„åˆ"></a>å¸¸ç”¨çš„é€‰é¡¹ç»„åˆ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-01 ~]# ps -aux|more  ##æ˜¯ç”¨BSDçš„æ ¼å¼æ¥æ˜¾ç¤ºè¿›ç¨‹</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  0.0  0.0 128148  6684 ?        Ss   11æœˆ01   0:09 /usr/lib/syste</span><br><span class="line">md/systemd --switched-root --system --deserialize 22</span><br><span class="line">root         2  0.0  0.0      0     0 ?        S    11æœˆ01   0:00 [kthreadd]</span><br><span class="line">root         3  0.0  0.0      0     0 ?        S    11æœˆ01   0:00 [ksoftirqd/0]</span><br><span class="line">root         5  0.0  0.0      0     0 ?        S&lt;   11æœˆ01   0:00 [kworker/0:0H]</span><br><span class="line">root         6  0.0  0.0      0     0 ?        S    11æœˆ01   0:00 [kworker/u8:0]</span><br><span class="line">root         7  0.0  0.0      0     0 ?        S    11æœˆ01   0:00 [migration/0]</span><br><span class="line">root         8  0.0  0.0      0     0 ?        S    11æœˆ01   0:00 [rcu_bh]</span><br><span class="line">root         9  0.0  0.0      0     0 ?        S    11æœˆ01   0:12 [rcu_sched]</span><br><span class="line">root        10  0.0  0.0      0     0 ?        S&lt;   11æœˆ01   0:00 [lru-add-drain</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#åŒ…å«çš„ä¿¡æ¯å¦‚ä¸‹</span></span></span><br><span class="line">USER:      è¿è¡Œè¿›ç¨‹çš„ç”¨æˆ·</span><br><span class="line">PIDï¼š      è¿›ç¨‹ID</span><br><span class="line"><span class="meta">%</span><span class="bash">CPU:  ã€€ã€€CPUå ç”¨ç‡</span></span><br><span class="line"><span class="meta">%</span><span class="bash">MEM:      å†…å­˜å ç”¨ç‡</span></span><br><span class="line">VSZï¼š      å ç”¨è™šæ‹Ÿå†…å­˜</span><br><span class="line">RSS:       å ç”¨å®é™…å†…å­˜ é©»ç•™å†…å­˜</span><br><span class="line">TTYï¼š      è¿›ç¨‹è¿è¡Œçš„ç»ˆç«¯</span><br><span class="line">STATï¼š     è¿›ç¨‹çŠ¶æ€     man ps (/STATE)            </span><br><span class="line">      R     è¿è¡Œ</span><br><span class="line">      S     å¯ä¸­æ–­ç¡çœ  Sleep</span><br><span class="line">      D     ä¸å¯ä¸­æ–­ç¡çœ </span><br><span class="line">      T     åœæ­¢çš„è¿›ç¨‹ </span><br><span class="line">      Z     åƒµå°¸è¿›ç¨‹</span><br><span class="line">      X     æ­»æ‰çš„è¿›ç¨‹</span><br><span class="line">      </span><br><span class="line">      Ss     sè¿›ç¨‹çš„é¢†å¯¼è€…ï¼Œçˆ¶è¿›ç¨‹</span><br><span class="line">      S&lt; ã€€ã€€ &lt;ä¼˜å…ˆçº§è¾ƒé«˜çš„è¿›ç¨‹</span><br><span class="line">      SN     Nä¼˜å…ˆçº§è¾ƒä½çš„è¿›ç¨‹</span><br><span class="line">      R+      +è¡¨ç¤ºæ˜¯å‰å°çš„è¿›ç¨‹ç»„</span><br><span class="line">      Sl     ä»¥çº¿ç¨‹çš„æ–¹å¼è¿è¡Œ    </span><br><span class="line">START:     è¿›ç¨‹çš„å¯åŠ¨æ—¶é—´</span><br><span class="line">TIMEï¼š     è¿›ç¨‹å ç”¨CPUçš„æ€»æ—¶é—´</span><br><span class="line">COMMANDï¼š  è¿›ç¨‹æ–‡ä»¶ï¼Œè¿›ç¨‹å</span><br><span class="line"></span><br><span class="line">[root@docker-01 ~]# ps -ef|head  ##æ˜¯ç”¨æ ‡å‡†çš„æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 11æœˆ01 ?      00:00:09 /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class="line">root         2     0  0 11æœˆ01 ?      00:00:00 [kthreadd]</span><br><span class="line">root         3     2  0 11æœˆ01 ?      00:00:00 [ksoftirqd/0]</span><br><span class="line">root         5     2  0 11æœˆ01 ?      00:00:00 [kworker/0:0H]</span><br><span class="line">root         6     2  0 11æœˆ01 ?      00:00:00 [kworker/u8:0]</span><br><span class="line">root         7     2  0 11æœˆ01 ?      00:00:00 [migration/0]</span><br><span class="line">root         8     2  0 11æœˆ01 ?      00:00:00 [rcu_bh]</span><br><span class="line">root         9     2  0 11æœˆ01 ?      00:00:12 [rcu_sched]</span><br><span class="line">root        10     2  0 11æœˆ01 ?      00:00:00 [lru-add-drain]</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#åŒ…å«çš„ä¿¡æ¯å¦‚ä¸‹</span></span></span><br><span class="line">UID: å¯åŠ¨è¿™äº›è¿›ç¨‹çš„ç”¨æˆ·</span><br><span class="line">PID: è¿›ç¨‹çš„ID</span><br><span class="line">PPID: çˆ¶è¿›ç¨‹çš„è¿›ç¨‹å·</span><br><span class="line">C: è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸä¸­çš„CPUåˆ©ç”¨ç‡</span><br><span class="line">STIME: è¿›ç¨‹å¯åŠ¨æ—¶çš„ç³»ç»Ÿæ—¶é—´</span><br><span class="line">TTY: è¡¨æ˜è¿›ç¨‹åœ¨å“ªä¸ªç»ˆç«¯è®¾å¤‡ä¸Šè¿è¡Œã€‚å¦‚æœæ˜¾ç¤º  ?è¡¨ç¤ºä¸ç»ˆç«¯æ— å…³ï¼Œè¿™ç§è¿›ç¨‹ä¸€èˆ¬æ˜¯å†…æ ¸æ€è¿›ç¨‹ã€‚å¦å¤–ï¼Œ tty1-tty6 æ˜¯æœ¬æœºä¸Šé¢çš„ç™»å…¥è€…ç¨‹åºï¼Œè‹¥ä¸º pts/0Â ç­‰ï¼Œåˆ™è¡¨ç¤ºè¿è¡Œåœ¨è™šæ‹Ÿç»ˆç«¯ä¸Šçš„è¿›ç¨‹ã€‚</span><br><span class="line">TIME: è¿è¡Œè¿›ç¨‹ä¸€å…±ç´¯è®¡å ç”¨çš„CPUæ—¶é—´</span><br><span class="line">CMD: å¯åŠ¨çš„ç¨‹åºåç§°</span><br></pre></td></tr></table></figure><p><img src="640-1.png" alt="Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†"></p><p><img src="640-2.jpeg" alt="Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†"></p><h3 id="å¯¹è¿›ç¨‹çš„æŒ‡å®šåˆ—è¿›è¡Œæ’åº"><a href="#å¯¹è¿›ç¨‹çš„æŒ‡å®šåˆ—è¿›è¡Œæ’åº" class="headerlink" title="å¯¹è¿›ç¨‹çš„æŒ‡å®šåˆ—è¿›è¡Œæ’åº"></a>å¯¹è¿›ç¨‹çš„æŒ‡å®šåˆ—è¿›è¡Œæ’åº</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-01 ~]# ps aux --sort %cpu |less  ##å‡åºæ’åº</span><br><span class="line">[root@docker-01 ~]# ps aux --sort -%cpu |less  ##é™åºæ’åº</span><br><span class="line">[root@docker-01 ~]# ps aux --sort rss |less</span><br><span class="line">[root@docker-01 ~]# ps aux --sort -rss |less</span><br></pre></td></tr></table></figure><h3 id="ä¸å¯ä¸­æ–­çŠ¶æ€"><a href="#ä¸å¯ä¸­æ–­çŠ¶æ€" class="headerlink" title="ä¸å¯ä¸­æ–­çŠ¶æ€"></a>ä¸å¯ä¸­æ–­çŠ¶æ€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-01 ~]# tar -zcvf usr-tar.gz /usr/</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##ç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸æ–­æŸ¥çœ‹çŠ¶æ€ï¼Œç”±S+ï¼ŒR+å˜ä¸ºD+</span></span></span><br><span class="line">[root@docker-01 ~]# ps -axu|grep tar</span><br><span class="line">root     25426  3.8  0.0 123688  1552 pts/0    R+   10:31   0:01 tar -zcvf usr-tar.gz /usr/</span><br><span class="line">root     25447  0.0  0.0 112724   984 pts/1    S+   10:31   0:00 grep --color=auto tar</span><br><span class="line">root     25426  3.8  0.0 123688  1552 pts/0    D+   10:31   0:01 tar -zcvf usr-tar.gz /usr/</span><br><span class="line">root     25447  0.0  0.0 112724   984 pts/1    S+   10:31   0:00 grep --color=auto tar</span><br></pre></td></tr></table></figure><h2 id="æ‰¾å‡ºç³»ç»Ÿä¸­ä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹"><a href="#æ‰¾å‡ºç³»ç»Ÿä¸­ä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹" class="headerlink" title="æ‰¾å‡ºç³»ç»Ÿä¸­ä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹"></a>æ‰¾å‡ºç³»ç»Ÿä¸­ä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹</h2><h3 id="è¿è¡Œtopï¼Œ-æ‰¾å‡ºä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹ï¼ŒæŒ‰å¤§å†™çš„Pï¼Œå¯ä»¥æŒ‰CPUä½¿ç”¨ç‡æ¥æ’åºæ˜¾ç¤º"><a href="#è¿è¡Œtopï¼Œ-æ‰¾å‡ºä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹ï¼ŒæŒ‰å¤§å†™çš„Pï¼Œå¯ä»¥æŒ‰CPUä½¿ç”¨ç‡æ¥æ’åºæ˜¾ç¤º" class="headerlink" title="è¿è¡Œtopï¼Œ æ‰¾å‡ºä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹ï¼ŒæŒ‰å¤§å†™çš„Pï¼Œå¯ä»¥æŒ‰CPUä½¿ç”¨ç‡æ¥æ’åºæ˜¾ç¤º"></a>è¿è¡Œtopï¼Œ æ‰¾å‡ºä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹ï¼ŒæŒ‰å¤§å†™çš„Pï¼Œå¯ä»¥æŒ‰CPUä½¿ç”¨ç‡æ¥æ’åºæ˜¾ç¤º</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-01 ~]# top</span><br><span class="line">top - 10:48:16 up 1 day, 18:41,  2 users,  load average: 0.00, 0.04, 0.08</span><br><span class="line">Tasks: 111 total,   2 running, 109 sleeping,   0 stopped,   0 zombie</span><br><span class="line"><span class="meta">%</span><span class="bash">Cpu(s):  0.1 us,  0.1 sy,  0.0 ni, 99.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 </span></span><br><span class="line">KiB Mem : 16266520 total, 11269388 free,  2162204 used,  2834928 buff/cache</span><br><span class="line">KiB Swap:  2097148 total,  2097148 free,        0 used. 13687952 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND  </span><br><span class="line">17427 kibana    20   0 2515164   1.3g  10324 S   0.7  8.3   9:05.29 node     </span><br><span class="line">17255 elastic+  20   0 4713976 308280  15708 S   0.3  1.9  11:09.30 java</span><br></pre></td></tr></table></figure><h3 id="åœ¨linuxç³»ç»Ÿä¸­ä¸€ä¸ªè¿›ç¨‹ï¼Œæœ€å¤šå¯ä»¥ä½¿ç”¨100-cpuå¯¹å—ï¼Ÿ"><a href="#åœ¨linuxç³»ç»Ÿä¸­ä¸€ä¸ªè¿›ç¨‹ï¼Œæœ€å¤šå¯ä»¥ä½¿ç”¨100-cpuå¯¹å—ï¼Ÿ" class="headerlink" title="åœ¨linuxç³»ç»Ÿä¸­ä¸€ä¸ªè¿›ç¨‹ï¼Œæœ€å¤šå¯ä»¥ä½¿ç”¨100%cpuå¯¹å—ï¼Ÿ"></a>åœ¨linuxç³»ç»Ÿä¸­ä¸€ä¸ªè¿›ç¨‹ï¼Œæœ€å¤šå¯ä»¥ä½¿ç”¨100%cpuå¯¹å—ï¼Ÿ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# top</span><br><span class="line">top - 10:51:24 up 61 days, 23:00,  2 users,  load average: 46.56, 48.38, 34.85</span><br><span class="line">Tasks: 267 total,   1 running, 266 sleeping,   0 stopped,   0 zombie</span><br><span class="line">Cpu(s): 96.9%us,  1.6%sy,  0.0%ni,  0.3%id,  0.0%wa,  0.5%hi,  0.5%si,  0.2%st</span><br><span class="line">Mem:  71545156k total, 71079896k used,   465260k free,    58836k buffers</span><br><span class="line">Swap:  2097148k total,        0k used,  2097148k free, 18012268k cached</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND           </span><br><span class="line">13073 smgadmin  20   0 5451m 1.4g  21m S 130.5  2.0 184:57.92 java              </span><br><span class="line">30753 smgadmin  20   0 4801m 1.3g  21m S 92.7  2.0  20:14.24 java    </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#å¯ä»¥çœ‹åˆ°javaï¼ˆè„ç‰›æ¼æ´ï¼Œç”¨äºææƒï¼‰ è¿›ç¨‹ä½¿ç”¨130.5%</span></span></span><br></pre></td></tr></table></figure><p><strong>æ³¨</strong></p><p>å¦‚æœä½ çš„4æ ¸å¿ƒçš„cpuï¼Œä½ å¯ä»¥è¿è¡Œ400%</p><h2 id="IsofæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ‰“å¼€çš„ç«¯å£-TCPã€UDP"><a href="#IsofæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ‰“å¼€çš„ç«¯å£-TCPã€UDP" class="headerlink" title="IsofæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ‰“å¼€çš„ç«¯å£(TCPã€UDP)"></a>IsofæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ‰“å¼€çš„ç«¯å£(TCPã€UDP)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-01 ~]# yum install lsof </span><br><span class="line">[root@docker-01 ~]# vim a.txt</span><br><span class="line">[root@docker-01 ~]# ps -axu | grep a.txt</span><br><span class="line">root     25526  0.0  0.0 151532  5200 pts/0    S+   10:55   0:00 vim a.txt</span><br><span class="line">root     25560  0.0  0.0 112724  1004 pts/1    S+   10:57   0:00 grep --color=auto a.txt</span><br><span class="line">[root@docker-01 ~]# lsof -p 25526  ##ä¸€èˆ¬ç”¨äºæŸ¥çœ‹æœ¨é©¬è¿›ç¨‹ï¼Œåœ¨è¯»å“ªäº›æ–‡ä»¶</span><br><span class="line">[root@docker-01 ~]# lsof -i :22  ##ç”¨äºæŸ¥çœ‹ç«¯å£ï¼Œæˆ–æŸ¥çœ‹é»‘å®¢å¼€å¯çš„åé—¨ç«¯å£æ˜¯å“ªä¸ªè¿›ç¨‹åœ¨ä½¿ç”¨</span><br></pre></td></tr></table></figure><h2 id="è¿›ç¨‹ä¼˜å…ˆçº§nice"><a href="#è¿›ç¨‹ä¼˜å…ˆçº§nice" class="headerlink" title="è¿›ç¨‹ä¼˜å…ˆçº§nice"></a>è¿›ç¨‹ä¼˜å…ˆçº§nice</h2><h3 id="è¿›ç¨‹è°ƒåº¦åŠå¤šä»»åŠ¡"><a href="#è¿›ç¨‹è°ƒåº¦åŠå¤šä»»åŠ¡" class="headerlink" title="è¿›ç¨‹è°ƒåº¦åŠå¤šä»»åŠ¡"></a>è¿›ç¨‹è°ƒåº¦åŠå¤šä»»åŠ¡</h3><p>æ¯ä¸ªCPUï¼ˆæˆ–CPUæ ¸å¿ƒï¼‰åœ¨ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šåªèƒ½å¤„ç†ä¸€ä¸ªè¿›ç¨‹ï¼Œé€šè¿‡æ—¶é—´ç‰‡æŠ€æœ¯ï¼ŒLinuxå®é™…èƒ½å¤Ÿè¿è¡Œçš„è¿›ç¨‹ï¼ˆå’Œçº¿ç¨‹æ•°ï¼‰å¯ä»¥è¶…<br>å‡ºå®é™…å¯ç”¨çš„CPUåŠæ ¸å¿ƒæ•°é‡ã€‚Linuxå†…æ ¸<strong>è¿›ç¨‹è°ƒåº¦ç¨‹åº</strong>å°†å¤šä¸ªè¿›ç¨‹åœ¨CPUæ ¸å¿ƒä¸Šå¿«é€Ÿåˆ‡æ¢ï¼Œä»è€Œç»™ç”¨æˆ·å¤šä¸ªè¿›ç¨‹åœ¨åŒæ—¶è¿è¡Œçš„å°è±¡ã€‚</p><h3 id="ç›¸å¯¹ä¼˜å…ˆçº§-nice"><a href="#ç›¸å¯¹ä¼˜å…ˆçº§-nice" class="headerlink" title="ç›¸å¯¹ä¼˜å…ˆçº§ nice"></a>ç›¸å¯¹ä¼˜å…ˆçº§ nice</h3><p>ç”±äºä¸æ˜¯æ¯ä¸ªè¿›ç¨‹éƒ½ä¸å…¶ä»–è¿›ç¨‹åŒæ ·é‡è¦ï¼Œå¯å‘ŠçŸ¥<strong>è¿›ç¨‹è°ƒåº¦ç¨‹åº</strong>ä¸ºä¸åŒçš„è¿›ç¨‹ä½¿ç”¨ä¸åŒçš„<strong>è°ƒåº¦ç­–ç•¥</strong>ã€‚å¸¸è§„ç³»ç»Ÿä¸Šè¿è¡Œçš„å¤§å¤š<br>æ•°è¿›ç¨‹æ‰€ä½¿ç”¨çš„è°ƒåº¦ç­–ç•¥ä¸º <strong>SCHED_OTHER</strong> (ä¹Ÿç§°ä¸ºSCHED_NORMAL)ï¼Œä½†è¿˜æœ‰å…¶å®ƒä¸€äº›è°ƒåº¦ç­–ç•¥ç”¨äºä¸åŒçš„ç›®çš„ã€‚</p><p>SCHED_OTHER è°ƒåº¦ç­–ç•¥è¿è¡Œçš„è¿›ç¨‹çš„<strong>ç›¸å¯¹ä¼˜å…ˆçº§</strong>ç§°ä¸ºè¿›ç¨‹çš„ nice å€¼ï¼Œå¯ä»¥æœ‰40ç§ä¸åŒçº§åˆ«çš„niceå€¼ã€‚</p><p><img src="641.png" alt="Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†"></p><p><strong>nice å€¼è¶Šé«˜ï¼š è¡¨ç¤ºä¼˜å…ˆçº§è¶Šä½ï¼Œä¾‹å¦‚+19ï¼Œè¯¥è¿›ç¨‹å®¹æ˜“å°†CPU ä½¿ç”¨é‡è®©ç»™å…¶ä»–è¿›ç¨‹ã€‚</strong><br><strong>nice å€¼è¶Šä½ï¼š è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¾‹å¦‚-20ï¼Œè¯¥è¿›ç¨‹æ›´ä¸å€¾å‘äºè®©å‡ºCPUã€‚</strong></p><h3 id="niceå¯åŠ¨çº§åˆ«çš„è®¾ç½®"><a href="#niceå¯åŠ¨çº§åˆ«çš„è®¾ç½®" class="headerlink" title="niceå¯åŠ¨çº§åˆ«çš„è®¾ç½®"></a>niceå¯åŠ¨çº§åˆ«çš„è®¾ç½®</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#å¯åŠ¨è¿›ç¨‹æ—¶ï¼Œé€šå¸¸ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„ niceçº§åˆ«ï¼Œé»˜è®¤ä¸º0ã€‚</span></span></span><br><span class="line">[root@docker-01 ~]# sleep 6000 &amp; </span><br><span class="line">[1] 25601</span><br><span class="line">[root@docker-01 ~]# ps axo command,pid,nice |grep sleep</span><br><span class="line">sleep 6000                  25601   0</span><br><span class="line">grep --color=auto sleep     25603   0</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#æŒ‡å®šå¯åŠ¨çº§åˆ«ä¸º5</span></span></span><br><span class="line">[root@docker-01 ~]# nice -n 5 sleep 6000 &amp; </span><br><span class="line">[2] 25605</span><br><span class="line">[1]   å·²æ€æ­»               sleep 6000</span><br><span class="line">[root@docker-01 ~]# ps axo command,pid,nice |grep sleep</span><br><span class="line">sleep 6000                  25605   5</span><br><span class="line">grep --color=auto sleep     25607   0</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#æ›´æ”¹ç°æœ‰è¿›ç¨‹çš„niceçº§åˆ«</span></span></span><br><span class="line">25605 (è¿›ç¨‹ ID) æ—§ä¼˜å…ˆçº§ä¸º 5ï¼Œæ–°ä¼˜å…ˆçº§ä¸º -15</span><br><span class="line">[root@docker-01 ~]# ps axo command,pid,nice |grep sleep</span><br><span class="line">sleep 6000                  25605 -15</span><br><span class="line">grep --color=auto sleep     25611   0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux_application </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux_application </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
