<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜</title>
      <link href="/2020/03/09/docker-nextcloud%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E5%90%8C%E6%AD%A5%E7%BD%91%E7%9B%98/"/>
      <url>/2020/03/09/docker-nextcloud%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E5%90%8C%E6%AD%A5%E7%BD%91%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<h1 id="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"><a href="#docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜" class="headerlink" title="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></a>docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p><code>nextcloud</code>æ˜¯ä¸€æ¬¾å¼€æºç§æœ‰äº‘æ–¹æ¡ˆï¼ŒGitHubå¼€æºåœ°å€ï¼š<a href="https://github.com/nextcloudï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ç”¨`nextcloud`æ¥æ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜ã€‚" target="_blank" rel="noopener">https://github.com/nextcloudï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ç”¨`nextcloud`æ¥æ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜ã€‚</a></p><p>ä¹‹å‰å°±æœ‰æ­å»ºç§æœ‰ç½‘ç›˜çš„éœ€æ±‚ï¼Œæ¯•ç«Ÿå›½å¤–ç½‘ç›˜å®¹é‡å°ï¼Œé€Ÿåº¦æ…¢ï¼Œå›½å†…ç›®å‰ä¹Ÿå°±åªæœ‰115å’Œç™¾åº¦äº‘åœ¨è‹Ÿå»¶æ®‹å–˜ï¼Œ115å·²æ˜¯åŠæ®‹ï¼Œç™¾åº¦äº‘é™é€Ÿä¸è¯´ï¼Œè¿˜ä¼šå°†å°å§å§å˜æˆ8ç§’æ•™è‚²ç‰‡ï¼Œå…ˆä¸è®ºè¿™ç§å·çª¥ä¸ªäººç½‘ç›˜éšç§çš„è¡Œä¸ºæ˜¯å¦è¿æ³•ï¼Œè¦çŸ¥é“ç™¾åº¦äº‘åˆ é™¤è¿™äº›ä¸œè¥¿çš„æ—¶å€™å¯æ²¡æœ‰å‘ŠçŸ¥ç”¨æˆ·ï¼Œæ›´ä¸ç”¨è¯´ä»»ä½•çš„æé†’å’Œäº¤æµäº†ï¼ŒæŠŠèµ„æ–™ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠä¸ªäººéšç§çš„èµ„æ–™æ”¾åœ¨ç™¾åº¦äº‘å®åœ¨æ˜¯æ”¾å¿ƒä¸ä¸‹ã€‚</p><p>æ€»çš„æ¥çœ‹ç›®å‰å…¬æœ‰ç½‘ç›˜å¤§éƒ½ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œä¹Ÿå°±å‚¬ç”Ÿäº†ä¸€å¤§æ‰¹å¼€æºç§æœ‰ç½‘ç›˜ï¼Œ<code>nextcloud</code>å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚</p><h2 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h2><ul><li>cenntos 7</li><li>2Gå†…å­˜, 2Må¸¦å®½(å¸¦å®½è¶Šå¤§, åŒæ­¥è¶Šæµç•…)</li></ul><h2 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 ~]# yum -y install docker</span><br><span class="line">[root@elasticsearch-04 ~]# systemctl start docker</span><br><span class="line">[root@elasticsearch-04 ~]# systemctl enable docker</span><br></pre></td></tr></table></figure><h2 id="è·å–nextcloudé•œåƒ-å®Œæˆç½‘ç›˜æ­å»º-ç»“æŸğŸ”š"><a href="#è·å–nextcloudé•œåƒ-å®Œæˆç½‘ç›˜æ­å»º-ç»“æŸğŸ”š" class="headerlink" title="è·å–nextcloudé•œåƒ, å®Œæˆç½‘ç›˜æ­å»º(ç»“æŸğŸ”š)"></a>è·å–nextcloudé•œåƒ, å®Œæˆç½‘ç›˜æ­å»º(ç»“æŸğŸ”š)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-04 html]# docker run -d -p 8080:80 nextcloud</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®ä¸»æœºipçš„8080ç«¯å£-ä¸ºç½‘ç›˜è®¾ç½®ç®¡ç†å‘˜åç§°å’Œå¯†ç "><a href="#è®¿é—®ä¸»æœºipçš„8080ç«¯å£-ä¸ºç½‘ç›˜è®¾ç½®ç®¡ç†å‘˜åç§°å’Œå¯†ç " class="headerlink" title="è®¿é—®ä¸»æœºipçš„8080ç«¯å£,ä¸ºç½‘ç›˜è®¾ç½®ç®¡ç†å‘˜åç§°å’Œå¯†ç "></a>è®¿é—®ä¸»æœºipçš„8080ç«¯å£,ä¸ºç½‘ç›˜è®¾ç½®ç®¡ç†å‘˜åç§°å’Œå¯†ç </h2><p>æ¯”å¦‚æˆ‘çš„vpsä¸»æœºipä¸º<code>172.17.120.14</code>, é‚£ä¹ˆæˆ‘è®¿é—®çš„å°±æ˜¯<code>172.17.120.14:8080</code></p><p><img src="01.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="è¿›å…¥ç½‘ç›˜å-å¯ä»¥è·å–å…¨å¹³å°çš„å®¢æˆ·ç«¯"><a href="#è¿›å…¥ç½‘ç›˜å-å¯ä»¥è·å–å…¨å¹³å°çš„å®¢æˆ·ç«¯" class="headerlink" title="è¿›å…¥ç½‘ç›˜å, å¯ä»¥è·å–å…¨å¹³å°çš„å®¢æˆ·ç«¯"></a>è¿›å…¥ç½‘ç›˜å, å¯ä»¥è·å–å…¨å¹³å°çš„å®¢æˆ·ç«¯</h2><p><img src="02.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><blockquote><ul><li>è‡³æ­¤ç½‘ç›˜å·²ç»æ­å»ºå®Œæˆï¼</li></ul></blockquote><h2 id="è‡ªç”±å­˜å–æ–‡ä»¶"><a href="#è‡ªç”±å­˜å–æ–‡ä»¶" class="headerlink" title="è‡ªç”±å­˜å–æ–‡ä»¶"></a>è‡ªç”±å­˜å–æ–‡ä»¶</h2><p>å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯ä¸Šä¼ å›¾ç‰‡, ä¹Ÿå¯ä»¥ç›´æ¥æ‹–æ‹½ä¸Šä¼ </p><p><img src="03.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><p><img src="04.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="æŠŠæ–‡ä»¶åˆ†äº«ç»™å¥½å‹"><a href="#æŠŠæ–‡ä»¶åˆ†äº«ç»™å¥½å‹" class="headerlink" title="æŠŠæ–‡ä»¶åˆ†äº«ç»™å¥½å‹"></a>æŠŠæ–‡ä»¶åˆ†äº«ç»™å¥½å‹</h2><p><img src="05.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="å®ç°åŒæ­¥ç›˜çš„åŠŸèƒ½-ç”¨webdriveè¿æ¥"><a href="#å®ç°åŒæ­¥ç›˜çš„åŠŸèƒ½-ç”¨webdriveè¿æ¥" class="headerlink" title="å®ç°åŒæ­¥ç›˜çš„åŠŸèƒ½(ç”¨webdriveè¿æ¥)"></a>å®ç°åŒæ­¥ç›˜çš„åŠŸèƒ½(ç”¨webdriveè¿æ¥)</h2><h4 id="ç‚¹å‡»å³ä¸‹è§’è®¾ç½®"><a href="#ç‚¹å‡»å³ä¸‹è§’è®¾ç½®" class="headerlink" title="ç‚¹å‡»å³ä¸‹è§’è®¾ç½®"></a>ç‚¹å‡»å³ä¸‹è§’è®¾ç½®</h4><p><img src="06.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h4 id="è·å–webdavåœ°å€"><a href="#è·å–webdavåœ°å€" class="headerlink" title="è·å–webdavåœ°å€"></a>è·å–webdavåœ°å€</h4><p><img src="07.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h4 id="macç›´æ¥æŒ‚è½½"><a href="#macç›´æ¥æŒ‚è½½" class="headerlink" title="macç›´æ¥æŒ‚è½½"></a>macç›´æ¥æŒ‚è½½</h4><p><img src="08.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h4 id="è¿æ¥æœåŠ¡å™¨"><a href="#è¿æ¥æœåŠ¡å™¨" class="headerlink" title="è¿æ¥æœåŠ¡å™¨"></a>è¿æ¥æœåŠ¡å™¨</h4><p><img src="09.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h4 id="è®¤è¯"><a href="#è®¤è¯" class="headerlink" title="è®¤è¯"></a>è®¤è¯</h4><p><img src="010.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h4 id="æŒ‚è½½æˆåŠŸ"><a href="#æŒ‚è½½æˆåŠŸ" class="headerlink" title="æŒ‚è½½æˆåŠŸ"></a>æŒ‚è½½æˆåŠŸ</h4><p><img src="011.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="å®¢æˆ·ç«¯è¿æ¥ã€‚transmitæ”¯æŒwebdavåè®®-å¯ä»¥è®©æˆ‘ä»¬åœ¨ç½‘ç»œçŠ¶å†µå¾ˆå·®çš„æƒ…å†µä¸‹-ä¹Ÿèƒ½è¿›è¡Œç¨³å®šåŒæ­¥"><a href="#å®¢æˆ·ç«¯è¿æ¥ã€‚transmitæ”¯æŒwebdavåè®®-å¯ä»¥è®©æˆ‘ä»¬åœ¨ç½‘ç»œçŠ¶å†µå¾ˆå·®çš„æƒ…å†µä¸‹-ä¹Ÿèƒ½è¿›è¡Œç¨³å®šåŒæ­¥" class="headerlink" title="å®¢æˆ·ç«¯è¿æ¥ã€‚transmitæ”¯æŒwebdavåè®®, å¯ä»¥è®©æˆ‘ä»¬åœ¨ç½‘ç»œçŠ¶å†µå¾ˆå·®çš„æƒ…å†µä¸‹,ä¹Ÿèƒ½è¿›è¡Œç¨³å®šåŒæ­¥"></a>å®¢æˆ·ç«¯è¿æ¥ã€‚transmitæ”¯æŒwebdavåè®®, å¯ä»¥è®©æˆ‘ä»¬åœ¨ç½‘ç»œçŠ¶å†µå¾ˆå·®çš„æƒ…å†µä¸‹,ä¹Ÿèƒ½è¿›è¡Œç¨³å®šåŒæ­¥</h2><p><img src="012.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="æ‰‹æœºè¿æ¥"><a href="#æ‰‹æœºè¿æ¥" class="headerlink" title="æ‰‹æœºè¿æ¥"></a>æ‰‹æœºè¿æ¥</h2><h4 id="è¾“å…¥ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç "><a href="#è¾“å…¥ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç " class="headerlink" title="è¾“å…¥ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç "></a>è¾“å…¥ç®¡ç†å‘˜è´¦æˆ·å’Œå¯†ç </h4><p><img src="013.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><p><img src="014.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h4 id="è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç "><a href="#è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç " class="headerlink" title="è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç "></a>è¾“å…¥ç®¡ç†å‘˜è´¦å·å¯†ç </h4><p><img src="015.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h4 id="å¯ä»¥çœ‹åˆ°åˆšåˆšåœ¨æµè§ˆå™¨ä¸Šä¼ çš„å›¾ç‰‡"><a href="#å¯ä»¥çœ‹åˆ°åˆšåˆšåœ¨æµè§ˆå™¨ä¸Šä¼ çš„å›¾ç‰‡" class="headerlink" title="å¯ä»¥çœ‹åˆ°åˆšåˆšåœ¨æµè§ˆå™¨ä¸Šä¼ çš„å›¾ç‰‡"></a>å¯ä»¥çœ‹åˆ°åˆšåˆšåœ¨æµè§ˆå™¨ä¸Šä¼ çš„å›¾ç‰‡</h4><p><img src="016.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h4 id="æ‰‹æœºä¸Šä¼ å›¾ç‰‡"><a href="#æ‰‹æœºä¸Šä¼ å›¾ç‰‡" class="headerlink" title="æ‰‹æœºä¸Šä¼ å›¾ç‰‡"></a>æ‰‹æœºä¸Šä¼ å›¾ç‰‡</h4><p><img src="017.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h4 id="pcå¯ä»¥æŸ¥çœ‹æ‰‹æœºä¸Šä¼ çš„å›¾ç‰‡"><a href="#pcå¯ä»¥æŸ¥çœ‹æ‰‹æœºä¸Šä¼ çš„å›¾ç‰‡" class="headerlink" title="pcå¯ä»¥æŸ¥çœ‹æ‰‹æœºä¸Šä¼ çš„å›¾ç‰‡"></a>pcå¯ä»¥æŸ¥çœ‹æ‰‹æœºä¸Šä¼ çš„å›¾ç‰‡</h4><p><img src="018.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="è®°ç¬”è®°"><a href="#è®°ç¬”è®°" class="headerlink" title="è®°ç¬”è®°"></a>è®°ç¬”è®°</h2><p><img src="023.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><h2 id="æ¢ç´¢æ’ä»¶"><a href="#æ¢ç´¢æ’ä»¶" class="headerlink" title="æ¢ç´¢æ’ä»¶"></a>æ¢ç´¢æ’ä»¶</h2><p>ç‚¹å‡»é¡µé¢å³ä¸Šè§’é½¿è½®å›¾æ ‡, å¯ä»¥å®‰è£…æ’ä»¶</p><p><img src="019.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><p><img src="020.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><p><img src="021.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p><p><img src="022.png" alt="docker-nextcloudæ­å»ºç§æœ‰åŒæ­¥ç½‘ç›˜"></p>]]></content>
      
      
      <categories>
          
          <category> Linux_docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux_docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bcâ€”æ•°å­—è®¡ç®—å™¨</title>
      <link href="/2020/03/07/bc-%E6%95%B0%E5%AD%97%E8%AE%A1%E7%AE%97%E5%99%A8/"/>
      <url>/2020/03/07/bc-%E6%95%B0%E5%AD%97%E8%AE%A1%E7%AE%97%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="bcâ€”æ•°å­—è®¡ç®—å™¨"><a href="#bcâ€”æ•°å­—è®¡ç®—å™¨" class="headerlink" title="bcâ€”æ•°å­—è®¡ç®—å™¨"></a>bcâ€”æ•°å­—è®¡ç®—å™¨</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>bcå‘½ä»¤æ˜¯ä¸€ç§æ”¯æŒä»»æ„ç²¾åº¦çš„äº¤äº’æ‰§è¡Œçš„è®¡ç®—å™¨è¯­è¨€ã€‚bashå†…ç½®äº†å¯¹æ•´æ•°å››åˆ™è¿ç®—çš„æ”¯æŒï¼Œä½†æ˜¯å¹¶ä¸æ”¯æŒæµ®ç‚¹è¿ç®—ï¼Œè€Œbcå‘½ä»¤å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿›è¡Œæµ®ç‚¹è¿ç®—ï¼Œå½“ç„¶æ•´æ•°è¿ç®—ä¹Ÿä¸å†è¯ä¸‹ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# yum install bc</span><br></pre></td></tr></table></figure><h2 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch-03 ~]# bc(é€‰é¡¹)(å‚æ•°)</span><br><span class="line">-iï¼šå¼ºåˆ¶è¿›å…¥äº¤äº’å¼æ¨¡å¼ï¼›</span><br><span class="line">-lï¼šå®šä¹‰ä½¿ç”¨çš„æ ‡å‡†æ•°å­¦åº“ï¼›</span><br><span class="line">-wï¼šå¯¹POSIX bcçš„æ‰©å±•ç»™å‡ºè­¦å‘Šä¿¡æ¯ï¼›</span><br><span class="line">-qï¼šä¸æ‰“å°æ­£å¸¸çš„GNU bcç¯å¢ƒä¿¡æ¯ï¼›</span><br><span class="line">-vï¼šæ˜¾ç¤ºæŒ‡ä»¤ç‰ˆæœ¬ä¿¡æ¯ï¼›</span><br><span class="line">-hï¼šæ˜¾ç¤ºæŒ‡ä»¤çš„å¸®åŠ©ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure><h2 id="è®¡ç®—åŠ å‡ä¹˜é™¤"><a href="#è®¡ç®—åŠ å‡ä¹˜é™¤" class="headerlink" title="è®¡ç®—åŠ å‡ä¹˜é™¤"></a>è®¡ç®—åŠ å‡ä¹˜é™¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# bc</span><br><span class="line">2+3</span><br><span class="line">5</span><br><span class="line">5-2</span><br><span class="line">3</span><br><span class="line">2+3*1</span><br><span class="line">5</span><br><span class="line">6/2</span><br><span class="line">3</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¾“å…¥ quit é€€å‡º</span></span><br></pre></td></tr></table></figure><h2 id="ç®¡é“ç¬¦è¾“å…¥"><a href="#ç®¡é“ç¬¦è¾“å…¥" class="headerlink" title="ç®¡é“ç¬¦è¾“å…¥"></a>ç®¡é“ç¬¦è¾“å…¥</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# echo "1.212*3" | bc </span><br><span class="line">3.636</span><br></pre></td></tr></table></figure><h2 id="è®¾å®šå°æ•°ç²¾åº¦"><a href="#è®¾å®šå°æ•°ç²¾åº¦" class="headerlink" title="è®¾å®šå°æ•°ç²¾åº¦"></a>è®¾å®šå°æ•°ç²¾åº¦</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# echo "scale=3;3/8" | bc</span><br><span class="line">.375</span><br><span class="line"><span class="meta">#</span><span class="bash">å‚æ•°scale=3æ˜¯å°†bcè¾“å‡ºç»“æœçš„å°æ•°ä½è®¾ç½®ä¸º3ä½</span></span><br></pre></td></tr></table></figure><h2 id="å°†åè¿›åˆ¶è½¬æ¢æˆäºŒè¿›åˆ¶"><a href="#å°†åè¿›åˆ¶è½¬æ¢æˆäºŒè¿›åˆ¶" class="headerlink" title="å°†åè¿›åˆ¶è½¬æ¢æˆäºŒè¿›åˆ¶"></a>å°†åè¿›åˆ¶è½¬æ¢æˆäºŒè¿›åˆ¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# #!/bin/bash</span><br><span class="line">[root@RedHat_test ~]# abc=11000000</span><br><span class="line">[root@RedHat_test ~]# echo "obase=10;ibase=2;$abc" | bc</span><br><span class="line">192</span><br></pre></td></tr></table></figure><h2 id="å°†åè¿›åˆ¶è½¬åå…­è¿›åˆ¶"><a href="#å°†åè¿›åˆ¶è½¬åå…­è¿›åˆ¶" class="headerlink" title="å°†åè¿›åˆ¶è½¬åå…­è¿›åˆ¶"></a>å°†åè¿›åˆ¶è½¬åå…­è¿›åˆ¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# m=31</span><br><span class="line">[root@RedHat_test ~]# n=$(echo "obase=16;$m"|bc)</span><br><span class="line">[root@RedHat_test ~]# echo $n</span><br><span class="line">1F</span><br></pre></td></tr></table></figure><h2 id="å°†åå…­è¿›åˆ¶è½¬åè¿›åˆ¶"><a href="#å°†åå…­è¿›åˆ¶è½¬åè¿›åˆ¶" class="headerlink" title="å°†åå…­è¿›åˆ¶è½¬åè¿›åˆ¶"></a>å°†åå…­è¿›åˆ¶è½¬åè¿›åˆ¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# m=1E</span><br><span class="line">[root@RedHat_test ~]# n=$(echo "obase=10;ibase=16;$m"|bc)</span><br><span class="line">[root@RedHat_test ~]# echo $n</span><br><span class="line">30</span><br></pre></td></tr></table></figure><h2 id="è®¡ç®—å¹³æ–¹å’Œå¹³æ–¹æ ¹"><a href="#è®¡ç®—å¹³æ–¹å’Œå¹³æ–¹æ ¹" class="headerlink" title="è®¡ç®—å¹³æ–¹å’Œå¹³æ–¹æ ¹"></a>è®¡ç®—å¹³æ–¹å’Œå¹³æ–¹æ ¹</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# echo "10^10" | bc</span><br><span class="line">10000000000</span><br><span class="line">[root@RedHat_test ~]# echo "sqrt(100)" | bc</span><br><span class="line">10</span><br></pre></td></tr></table></figure><h2 id="è®¡ç®—å¹³å‡å€¼"><a href="#è®¡ç®—å¹³å‡å€¼" class="headerlink" title="è®¡ç®—å¹³å‡å€¼"></a>è®¡ç®—å¹³å‡å€¼</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@RedHat_test ~]# cat script.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¨ˆç®—å…©å€‹æ•¸çš„å¹³å‡å€¼</span></span><br><span class="line">ans=$(echo "($1 + $2) / 2" | bc -l)</span><br><span class="line">echo "å¹³å‡ç‚ºï¼š$ans"</span><br><span class="line">[root@RedHat_test ~]# chmod +x script.sh</span><br><span class="line">[root@RedHat_test ~]# ./script.sh 12 34</span><br><span class="line">å¹³å‡ç‚ºï¼š23.00000000000000000000</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux_command </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux_command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rsyslogâ€”æ—¥å¿—åŠé›†ä¸­åŒ–ç®¡ç†</title>
      <link href="/2020/03/07/rsyslog-%E6%97%A5%E5%BF%97%E9%9B%86%E4%B8%AD%E5%8C%96%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/"/>
      <url>/2020/03/07/rsyslog-%E6%97%A5%E5%BF%97%E9%9B%86%E4%B8%AD%E5%8C%96%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="rsyslogdâ€”æ—¥å¿—åŠé›†ä¸­åŒ–ç®¡ç†"><a href="#rsyslogdâ€”æ—¥å¿—åŠé›†ä¸­åŒ–ç®¡ç†" class="headerlink" title="rsyslogdâ€”æ—¥å¿—åŠé›†ä¸­åŒ–ç®¡ç†"></a>rsyslogdâ€”æ—¥å¿—åŠé›†ä¸­åŒ–ç®¡ç†</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>rsyslog åœ¨Linuxä¸Šè‡ªå¸¦ï¼Œå…¼å®¹syslogè¯­æ³•ï¼Œåœ¨syslogåŸºç¡€ä¸Šå¢åŠ äº†æ›´å¤šåè®®çš„æ”¯æŒï¼Œé…åˆé¢å¤–moduleæ’ä»¶å¯ä»¥å®Œæˆå¾ˆå¤šåœºæ™¯çš„ä½¿ç”¨ã€‚å€Ÿç”¨ä¸‹å®˜ç½‘çš„å›¾ç‰‡ï¼š</p><p><img src="640-3.jpeg" alt="rsyslog-æ—¥å¿—é›†ä¸­åŒ–ç®¡ç†å·¥å…·"></p><p>æ³¨ï¼š Windows å¹³å°éœ€è¦ nxlog ï¼ˆnxlog æ˜¯ç”¨C è¯­è¨€å†™çš„ä¸€ä¸ªè·¨å¹³å°æ—¥å¿—æ”¶é›†å¤„ç†è½¯ä»¶ï¼‰ã€‚</p><p>æœ€è¿‘é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦æŠŠçº¿ä¸Šç¯å¢ƒçš„debugæ—¥å¿—åŠé›†ä¸­åŒ–æ”¶é›†èµ·æ¥ï¼Œä¸€æ–¹é¢æ˜¯æ–¹ä¾¿å¼€å‘è°ƒè¯•ï¼›ä¸€æ–¹é¢æ˜¯é¿å…ç›´æ¥åˆ°çº¿ä¸Šç¯å¢ƒæŸ¥çœ‹ï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ã€‚</p><h2 id="å¸¸ç”¨å¯é€‰æ–¹æ¡ˆ"><a href="#å¸¸ç”¨å¯é€‰æ–¹æ¡ˆ" class="headerlink" title="å¸¸ç”¨å¯é€‰æ–¹æ¡ˆ"></a>å¸¸ç”¨å¯é€‰æ–¹æ¡ˆ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rsyslogå‘é€ç«¯ + rsyslogæ¥æ”¶ç«¯ï¼š ç›´æ¥å­˜åœ¨æ¥æ”¶ç«¯çš„æœ¬åœ°ç¡¬ç›˜</span><br><span class="line"></span><br><span class="line">rsyslogå‘é€ç«¯ + logstashæ¥æ”¶ç«¯ + &lt;åç»­ç¬¬ä¸‰æ–¹å¤„ç†&gt;ï¼š æ¥å—åˆ°logæ›´æ–°è¡Œåï¼Œé€šè¿‡logstashç®€å•å¤„ç†åï¼Œå¯ä»¥ç»§ç»­å¾€ç¬¬ä¸‰æ–¹å¤„ç†ï¼Œå¦‚æ”¾åˆ°ElasticSearchï¼Œæˆ–è€…æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—Kfakaç­‰</span><br><span class="line"></span><br><span class="line">rsyslogå‘é€ç«¯ + Splunkï¼š Splunkæ˜¯å•†ä¸šè½¯ä»¶ï¼Œä¹Ÿæ˜¯ä¸šå†…ç”¨çš„æ¯”è¾ƒå¤šçš„æ–¹å¼ï¼Œä»·æ ¼ä¸è²</span><br></pre></td></tr></table></figure><p>åŸºæœ¬åŸç†å’Œå¤„ç†æµç¨‹éƒ½æ˜¯ç±»ä¼¼çš„ï¼š ç›‘æ§æœ¬åœ°logæ–‡ä»¶å†…å®¹çš„å˜åŒ–ï¼Œç„¶åæŠŠå˜åŒ–çš„æ–‡ä»¶å†…å®¹å‘é€åˆ°è¿œç«¯æ”¶é›†æœåŠ¡ä¸Šã€‚</p><p>ä¾‹å¦‚å¸¸è¯´çš„ELKstackï¼ˆElasticSearch+Logstash+Kibanaï¼‰çš„ç¬¬ä¸€æ­¥éƒ½æ˜¯é…ç½®rsyslogå‘é€ç«¯ã€‚</p><p>ä¸ç®¡å“ªç§æ–¹æ¡ˆéƒ½å¾—ç›‘æ§æœ¬åœ°æ–‡ä»¶çš„å˜åŒ–ï¼Œrsyslogå±äºå¿…é€‰ã€‚æˆ‘ä»¬éœ€æ±‚æ¯”è¾ƒç®€å•ï¼Œæš‚æ—¶é€‰ç”¨äº†è½åœ°åˆ°æœ¬åœ°ç›˜ï¼Œé»˜è®¤å­˜å‚¨15å¤©debugæ—¥å¿—ã€‚</p><p>æœ¬æ–‡ä¸»è¦ä»‹ç»rsyslogå‘é€ç«¯ã€æ¥æ”¶ç«¯çš„é…ç½®ï¼Œä»¥åŠé‡åˆ°çš„ä¸€äº›å‘ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>åœ¨CentOS 6.8 Final ä¸Šè‡ªå¸¦çš„ç‰ˆæœ¬ä¸º 5.8.10ã€‚å¦‚éœ€æœ€æ–°ç‰ˆæœ¬ï¼Œå¯å‚è€ƒå®˜ç½‘ã€‚</p><p> <a href="http://www.rsyslog.com" target="_blank" rel="noopener">http://www.rsyslog.com</a> </p><p>V5ç‰ˆæœ¬å¼€å‘äº2010å¹´ï¼Œå±äºæ¯”è¾ƒæ—§çš„ç‰ˆæœ¬ï¼Œæœ€æ–°ç‰ˆæœ¬æ˜¯V8ï¼Œæ”¯æŒäº†æ›´å¤šçš„å­—ç¬¦ä¸²å¤„ç†å‡½æ•°å’Œæ›´å¤šmoduleï¼Œå½“ç„¶æ€§èƒ½ä¹Ÿæ›´å¥½ã€‚</p><p>ç¼ºç‚¹æ˜¯ï¼šæ–°æ—§é…ç½®è¯­æ³•ä¸å…¼å®¹ï¼Œè€Œé‡‡ç”¨å†…ç½®ç‰ˆæœ¬çš„å¦ä¸€ä¸ªå·æ‡’çš„å¥½å¤„æ˜¯äº‘ç«¯çš„é•œåƒä¹Ÿä¸éœ€è¦å†é¢å¤–å‡çº§ï¼Œèƒ½æ”¯æŒæ›´å¤šè€æœºå™¨ã€‚</p><p>åé¢ä»‹ç»ä»¥V5ç‰ˆæœ¬ä¸ºä¾‹ï¼Œå¦‚æœ‰ä¸åŒçš„ï¼Œä¼šå•ç‹¬æŒ‡å‡ºã€‚</p><h2 id="é…ç½®æ–‡ä»¶ä»‹ç»"><a href="#é…ç½®æ–‡ä»¶ä»‹ç»" class="headerlink" title="é…ç½®æ–‡ä»¶ä»‹ç»"></a>é…ç½®æ–‡ä»¶ä»‹ç»</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/sbin/rsyslogd : æ‰§è¡Œæ–‡ä»¶</span><br><span class="line"></span><br><span class="line">/etc/rsyslog.conf : ä¸»é…ç½®æ–‡ä»¶:</span><br><span class="line"></span><br><span class="line">/etc/rsyslog.d/*.conf : è‡ªå®šä¹‰é…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">/etc/init.d/rsyslog restart : ä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œé‡å¯æœåŠ¡</span><br></pre></td></tr></table></figure><h2 id="ä¸€ä»½é…ç½®æ–‡ä»¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†"><a href="#ä¸€ä»½é…ç½®æ–‡ä»¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†" class="headerlink" title="ä¸€ä»½é…ç½®æ–‡ä»¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†"></a>ä¸€ä»½é…ç½®æ–‡ä»¶ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MODULES</span><br><span class="line">RULES</span><br><span class="line">å…¨å±€æŒ‡ä»¤ï¼Œæ¨¡æ¿ï¼Œæ¨¡å—å‚æ•°ç­‰</span><br></pre></td></tr></table></figure><p>è‡ªå¸¦çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼Œå‚è€ƒåé¢çš„æ³¨é‡Šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rsyslog v5 configuration file</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For more information see /usr/share/doc/rsyslog-*/rsyslog_conf.html</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you experience problems, see http://www.rsyslog.com/doc/troubleshoot.html</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### MODULES #### # æ¨¡å—æ”¾åœ¨å¼€å¤´åŠ è½½</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ModLoad imuxsock <span class="comment"># provides support for local system logging (e.g. via logger command) # å¯ä»¥ç”¨æ¥è°ƒè¯•ï¼Œç¨åæœ‰ä¾‹å­</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ModLoad imklog <span class="comment"># provides kernel logging support (previously done by rklogd)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ModLoad</span> immark <span class="comment"># provides --MARK-- message capability</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides UDP syslog reception</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ModLoad</span> imudp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$UDPServerRun</span> 514</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides TCP syslog reception <span class="comment"># TCP serverï¼Œæ¥æ”¶ç«¯éœ€è¦åŠ è½½è¿™ä¸ªæ¨¡å—ï¼Œå‘é€ç«¯ä¸éœ€è¦</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ModLoad</span> imtcp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$InputTCPServerRun</span> 514</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### GLOBAL DIRECTIVES ####</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Use default timestamp format</span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat <span class="comment"># æ¶ˆæ¯æ ¼å¼</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> File syncing capability is disabled by default. This feature is usually not required,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> not useful and an extreme performance hit</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionFileEnableSync</span> on</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### RULES #### # ç”¨æ¥æŒ‡å®šå“ªç§ç±»å‹çš„ï¼Œå“ªç§çº§åˆ«çš„logï¼Œå‘é€ç»™è°å¤„ç†</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Log all kernel messages to the console.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Logging much <span class="keyword">else</span> clutters up the screen.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kern.* /dev/console</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Log anything (except mail) of level info or higher.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Don<span class="string">'t log private authentication messages!</span></span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none /var/log/messages</span><br><span class="line"><span class="meta">#</span><span class="bash"> The authpriv file has restricted access.</span></span><br><span class="line">authpriv.* /var/log/secure</span><br><span class="line"><span class="meta">#</span><span class="bash"> Log all the mail messages <span class="keyword">in</span> one place.</span></span><br><span class="line">mail.* -/var/log/maillog # '-' è¡¨ç¤ºå¼‚æ­¥</span><br><span class="line"><span class="meta">#</span><span class="bash"> Log cron stuff</span></span><br><span class="line">cron.* /var/log/cron</span><br><span class="line"><span class="meta">#</span><span class="bash"> Everybody gets emergency messages</span></span><br><span class="line">*.emerg *</span><br><span class="line"><span class="meta">#</span><span class="bash"> Save news errors of level crit and higher <span class="keyword">in</span> a special file.</span></span><br><span class="line">uucp,news.crit /var/log/spooler</span><br><span class="line"><span class="meta">#</span><span class="bash"> Save boot messages also to boot.log</span></span><br><span class="line">local7.* /var/log/boot.log # localå¼€å¤´çš„æ˜¯è‡ªå®šä¹‰çš„æ—¥å¿—ç±»å‹</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment">### begin forwarding rule ###</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The statement between the begin ... end define a SINGLE forwarding</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rule. They belong together, <span class="keyword">do</span> NOT split them. If you create multiple</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> forwarding rules, duplicate the whole block!</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Remote Logging (we use TCP <span class="keyword">for</span> reliable delivery)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> An on-disk queue is created <span class="keyword">for</span> this action. If the remote host is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> down, messages are spooled to disk and sent when it is up again.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$WorkDirectory</span> /var/lib/rsyslog <span class="comment"># where to place spool files</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionQueueFileName</span> fwdRule1 <span class="comment"># unique name prefix for spool files</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionQueueMaxDiskSpace</span> 1g <span class="comment"># 1gb space limit (use as much as possible)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionQueueSaveOnShutdown</span> on <span class="comment"># save messages to disk on shutdown</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionQueueType</span> LinkedList <span class="comment"># run asynchronously</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ActionResumeRetryCount</span> -1 <span class="comment"># infinite retries if host is down</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> remote host is: name/ip:port, e.g. 192.168.0.1:514, port optional</span></span><br><span class="line"><span class="meta">#</span><span class="bash">*.* @@remote-host:514</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment">### end of the forwarding rule ###</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Finally include all config files <span class="keyword">in</span> /etc/rsyslog.d. This allows overrides</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of the default configuration above.</span></span><br><span class="line"><span class="meta">$</span><span class="bash">IncludeConfig /etc/rsyslog.d/*.conf <span class="comment"># è¿™é‡Œä¼šè‡ªåŠ¨åŠ è½½è‡ªå®šä¹‰çš„*.confé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥è¦†ç›–é»˜è®¤å‚æ•°</span></span></span><br></pre></td></tr></table></figure><h2 id="æ¨¡å—-imfile"><a href="#æ¨¡å—-imfile" class="headerlink" title="æ¨¡å— imfile"></a>æ¨¡å— imfile</h2><p>ä¸ºäº†å®Œæˆæˆ‘ä»¬çš„ä»»åŠ¡ï¼Œé™¤äº†ä¸Šé¢é»˜è®¤çš„æ¨¡å—ï¼Œè¿˜éœ€è¦åŠ è½½ imfileï¼Œ,æ¥æŒ‡å®šç›‘æ§å“ªäº›æ–‡ä»¶ï¼Œå‚è€ƒæ–‡æ¡£ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">ModLoad imfile <span class="comment"># Load the imfile input module</span></span></span><br></pre></td></tr></table></figure><p>è¯¥æ¨¡å—æŠŠæ ‡å‡†çš„æ–‡æœ¬æ–‡ä»¶è½¬æ¢æˆsyslogçš„messageæ ¼å¼ï¼Œ æ‰€è°“æ ‡å‡†æ–‡æœ¬æ˜¯æŒ‡ï¼šä¿æŠ¤å¯æ‰“å°çš„å­—ç¬¦ï¼Œæ¯è¡Œä»¥ LFä½œä¸ºåˆ†éš”ç¬¦å·ã€‚ æ”¯æŒæ–‡ä»¶æ­£åœ¨åœ¨logrotateçš„æ—¶å€™ï¼Œä»èƒ½æ­£ç¡®å¤„ç†ã€‚</p><p>å®ƒä¼šæŠŠç›‘æ§æ–‡ä»¶çš„è¯»å–åˆ°å“ªä¸€ä¸ªä½ç½®ï¼ˆç±»ä¼¼æ¸¸æ ‡cursorï¼‰ï¼Œå­˜å‚¨åœ¨stateæ–‡ä»¶é‡Œï¼ˆç”± $WorkDirectory æŒ‡å®šï¼‰ã€‚</p><p>è¯¥æ¨¡å—æ”¯æŒå¦‚ä¸‹æŒ‡ä»¤ï¼Œä¸€ç»„å¦‚ä¸‹è®¾ç½®ï¼Œå¯ä»¥ç§°ä¸ºä¸€ä¸ª <strong>listener</strong>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">InputFileName /path/to/file <span class="comment"># å¾…ç›‘æ§çš„æ–‡ä»¶è·¯å¾„</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileTag tag <span class="comment"># æ–‡ä»¶å”¯ä¸€æ ‡è¯†tagï¼Œæœ€å¥½ä¿æŒå”¯ä¸€ï¼Œç”¨äºæ¥æ”¶ç«¯åŒºåˆ†åŸå§‹logæ–‡ä»¶ï¼Œå¯ä»¥åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚":"ã€","ç­‰</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileStateFile /path/to/state/file</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ã€é‡è¦ã€‘éœ€è¦ä¿è¯å‘é€ç«¯å”¯ä¸€ï¼Œè®°å½•è¯»å–åˆ°å“ªå„¿ï¼ŒçŠ¶æ€æ–‡ä»¶ä¿å­˜åœ¨<span class="variable">$WorkDirectory</span>ï¼Œé»˜è®¤ä¸º /var/lib/rsyslog</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœæŸä¸ªè¦ç›‘æ§çš„æ–‡ä»¶åå˜åŒ–äº†ï¼Œä¸€å®šè¦é‡æ–°è®¾ç½®è¯¥å€¼</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileFacility facility <span class="comment"># logç±»å‹ï¼Œé»˜è®¤local0ï¼Œ localå¼€å¤´çš„è¡¨ç¤ºè‡ªå®šä¹‰ç±»å‹</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileSeverity severity <span class="comment"># logçº§åˆ«ï¼šinfoï¼Œwarningï¼Œé»˜è®¤notice</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputRunFileMonitor <span class="comment"># å¯åŠ¨ç›‘æ§å½“å‰çš„æ–‡ä»¶ï¼Œå¦‚æœå¿˜è®°è¿™è¡Œï¼Œåˆ™å•¥äº‹ä¹Ÿä¸ä¼šå‘ç”Ÿ</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFilePollInterval seconds <span class="comment"># å…¨å±€è®¾ç½®ï¼Œé»˜è®¤è½®è¯¢æ˜¯10s</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFilePersistStateInterval lines <span class="comment"># æ¯å¤šå°‘è¡Œæ›´æ–°stateæ–‡ä»¶çŠ¶æ€</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileReadMode mode <span class="comment"># å®˜ç½‘ç«Ÿç„¶æ²¡è¿™ä¸ªè§£é‡Šï¼Œä¸è¿‡ä¹Ÿæ²¡ç”¨åˆ°ã€‚ã€‚ã€‚</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileMaxLinesAtOnce number</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤10240ï¼Œå¦‚æœåœ¨å‘é€ç«¯ï¼Œéœ€è¦åŒæ—¶ç›‘æ§å¤šä¸ªæ–‡ä»¶ï¼Œä¼šå¤„ç†å®Œå½“å‰æ–‡ä»¶ç‰¹å®šè¡Œåï¼Œåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼Œé¿å…ä¸€ä¸ªæ–‡ä»¶ä¸€ç›´å ç”¨å¤„ç†ï¼Œå¯¼è‡´æ”¶é›†åˆ«çš„æ–‡ä»¶ä¸åŠæ—¶ã€‚</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileBindRuleset ruleset <span class="comment"># å±äºè¾ƒé«˜çº§çš„è®¾ç½®ï¼Œå¯ä»¥æŠŠè¿™ä¸ªlistenerç»‘å®šåˆ°ç‰¹ç‚¹çš„è§„åˆ™(http://www.rsyslog.com/doc/v5-stable/concepts/multi_ruleset.html)</span></span></span><br></pre></td></tr></table></figure><p>æ¥æ”¶ç«¯é…ç½®ï¼Œæ³¨æ„tagé‡Œçš„é€—å· <strong>â€˜,â€™</strong>ï¼Œç¨ååœ¨æ¥æ”¶ç«¯ï¼Œä¼šå®ƒæ¥åˆ†éš”ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> For product, total 19 files.</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileName /Data/logs/product/cache-Statistic.log</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileTag product,cache-Statistic</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileSeverity info</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileStateFile state_product_cache-Statistic</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFilePersistStateInterval 25000</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileFacility local5</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputRunFileMonitor</span></span><br></pre></td></tr></table></figure><h2 id="Rule-è®¾ç½®"><a href="#Rule-è®¾ç½®" class="headerlink" title="Rule è®¾ç½®"></a>Rule è®¾ç½®</h2><p>ä¸€æ¡ruleçš„è¯­æ³•æ ¼å¼å¦‚ï¼š <Facility>.<Severity> <Target></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Log cron stuff</span></span><br><span class="line">cron.* /var/log/cron</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®°å½•infoåˆ°æœ¬åœ°messagesæ–‡ä»¶ï¼Œ.none ç»“å°¾è¡¨ç¤ºæ’é™¤æ‰è¿™äº›æ–‡ä»¶ç±»å‹ã€‚</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none /var/log/messages</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰€æœ‰ä¸ºlocal5çš„ä»»æ„çº§åˆ«æ—¥å¿—å‘é€åˆ°è¿œç«¯514</span></span><br><span class="line">local5.* @@192.168.56.10:514</span><br></pre></td></tr></table></figure><h2 id="Facility"><a href="#Facility" class="headerlink" title="Facility"></a>Facility</h2><p>æ—¥å¿—è®¾å¤‡(å¯ä»¥ç†è§£ä¸ºæ—¥å¿—ç±»å‹):</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">auth #pamäº§ç”Ÿçš„æ—¥å¿—ï¼Œè®¤è¯æ—¥å¿—</span><br><span class="line">authpriv #ssh,ftpç­‰ç™»å½•ä¿¡æ¯çš„éªŒè¯ä¿¡æ¯ï¼Œè®¤è¯æˆæƒè®¤è¯</span><br><span class="line">cron #æ—¶é—´ä»»åŠ¡ç›¸å…³</span><br><span class="line">kern #å†…æ ¸</span><br><span class="line">lpr #æ‰“å°</span><br><span class="line">mail #é‚®ä»¶</span><br><span class="line">mark(syslog) #rsyslogæœåŠ¡å†…éƒ¨çš„ä¿¡æ¯,æ—¶é—´æ ‡è¯†</span><br><span class="line">news #æ–°é—»ç»„</span><br><span class="line">user #ç”¨æˆ·ç¨‹åºäº§ç”Ÿçš„ç›¸å…³ä¿¡æ¯</span><br><span class="line">uucp #unix to unix copy, unixä¸»æœºä¹‹é—´ç›¸å…³çš„é€šè®¯</span><br><span class="line">local 1~7 #è‡ªå®šä¹‰çš„æ—¥å¿—è®¾å¤‡</span><br></pre></td></tr></table></figure><h2 id="Severity"><a href="#Severity" class="headerlink" title="Severity"></a>Severity</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">debug #æœ‰è°ƒå¼ä¿¡æ¯çš„ï¼Œæ—¥å¿—ä¿¡æ¯æœ€å¤š</span><br><span class="line">info #ä¸€èˆ¬ä¿¡æ¯çš„æ—¥å¿—ï¼Œæœ€å¸¸ç”¨</span><br><span class="line">notice #æœ€å…·æœ‰é‡è¦æ€§çš„æ™®é€šæ¡ä»¶çš„ä¿¡æ¯</span><br><span class="line">warning, warn #è­¦å‘Šçº§åˆ«</span><br><span class="line">err, error #é”™è¯¯çº§åˆ«ï¼Œé˜»æ­¢æŸä¸ªåŠŸèƒ½æˆ–è€…æ¨¡å—ä¸èƒ½æ­£å¸¸å·¥ä½œçš„ä¿¡æ¯</span><br><span class="line">crit #ä¸¥é‡çº§åˆ«ï¼Œé˜»æ­¢æ•´ä¸ªç³»ç»Ÿæˆ–è€…æ•´ä¸ªè½¯ä»¶ä¸èƒ½æ­£å¸¸å·¥ä½œçš„ä¿¡æ¯</span><br><span class="line">alert #éœ€è¦ç«‹åˆ»ä¿®æ”¹çš„ä¿¡æ¯</span><br><span class="line">emerg, panic #å†…æ ¸å´©æºƒç­‰ä¸¥é‡ä¿¡æ¯</span><br></pre></td></tr></table></figure><h2 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ä»¶ï¼š /var/log/messages</span><br><span class="line"></span><br><span class="line">ç”¨æˆ·ï¼š rootï¼Œ*ï¼ˆè¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·ï¼‰ï¼Œ ä¼šå‘åˆ°/var/spool/mail/æ”¶ä»¶ç®±é‡Œ</span><br><span class="line"></span><br><span class="line">æ—¥å¿—æœåŠ¡å™¨ï¼š @192.168.56.10 æˆ–è€… @@192.168.56.10</span><br><span class="line"></span><br><span class="line">ç®¡é“ï¼š | COMMAND</span><br><span class="line"></span><br><span class="line">ä¸€ä¸ª @ è¡¨ç¤º UDP, ä¸¤ä¸ª @@ è¡¨ç¤º TCP åè®®ã€‚</span><br></pre></td></tr></table></figure><h2 id="æ¨¡æ¿-template"><a href="#æ¨¡æ¿-template" class="headerlink" title="æ¨¡æ¿$template"></a>æ¨¡æ¿$template</h2><p>æ¨¡æ¿ $templateï¼Œ æœ€ä¸»è¦çš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œåœ¨ æ¥æ”¶ç«¯ å¯ç”¨æ¥å®šä¹‰æ¶ˆæ¯æ ¼å¼ã€æ–‡ä»¶åã€‚ä¸»è¦æ˜¯åœ¨æ¥æ”¶ç«¯ä½¿ç”¨ã€‚</p><p>å¯å‚è€ƒ å®˜æ–¹æ–‡æ¡£Templates</p><p>è¯­æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">template &lt;name&gt;,&lt;å†…å®¹&gt;,&lt;å¯é€‰é¡¹&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template MyTemplateName,<span class="string">"\7Text %property% some more text\n"</span>,&lt;options&gt;</span></span><br></pre></td></tr></table></figure><p>é»˜è®¤çš„æ¶ˆæ¯æ ¼å¼ RSYSLOG_TraditionalFileFormat</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;æ¥æ”¶å†…å®¹çš„æ—¶é—´&gt; &lt;å‘é€è€…çš„hostname&gt; &lt;$InputFileTag&gt; &lt;åŸå§‹æ¶ˆæ¯%msg%&gt;</span><br><span class="line">Dec 18 20:39:27 jumper-172-31-56-18 karltestdemoTag blala... dummy msg</span><br></pre></td></tr></table></figure><p>å¦‚æœåªéœ€è¦æ˜¾ç¤ºåŸå§‹æ¶ˆæ¯ï¼Œå¯è®¾ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">template CleanMsgFormat,<span class="string">"%msg%\n"</span></span></span><br></pre></td></tr></table></figure><h2 id="å†…ç½®å±æ€§-Properties"><a href="#å†…ç½®å±æ€§-Properties" class="headerlink" title="å†…ç½®å±æ€§ Properties"></a>å†…ç½®å±æ€§ Properties</h2><p>æ¨¡æ¿é‡Œæ”¯æŒä¸€äº› å†…ç½®çš„å˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash">msg%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">syslogfacility%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">HOSTNAME%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">syslogpriority%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">timereported:::date-mysql%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">timegenerated:::date-mysql%</span></span><br><span class="line"><span class="meta">%</span><span class="bash">iut%</span></span><br><span class="line">'%syslogtag%'</span><br></pre></td></tr></table></figure><h2 id="å±æ€§å¤„ç†-Property-Replacer"><a href="#å±æ€§å¤„ç†-Property-Replacer" class="headerlink" title="å±æ€§å¤„ç† Property Replacer"></a>å±æ€§å¤„ç† Property Replacer</h2><p>Property Replacer ç”¨æ¥å¤„ç†å˜é‡ï¼Œæ”¯æŒä¸€äº›ç®€å•çš„å­—ç¬¦ä¸²å¤„ç†ï¼Œå¦‚å¤§å°å†™ï¼Œsubstringç­‰ï¼Œç±»ä¼¼jinja2çš„filteræ¦‚å¿µã€‚</p><p>ç‰ˆæœ¬è¶Šæ–°æ”¯æŒçš„å¤„ç†å‡½æ•°è¶Šå¼ºå¤§ã€‚</p><p>è¯­æ³•ï¼š </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash">property:fromChar:toChar:options%</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For product</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template productFileFormat,<span class="string">"/Data/logs/product/%fromhost-ip%/%syslogtag:F,44:2%-%<span class="variable">$YEAR</span>%%<span class="variable">$MONTH</span>%%<span class="variable">$DAY</span>%.log"</span></span></span><br><span class="line">if $syslogtag startswith 'product' then ?productFileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨æ¥æ”¶ç«¯ä¼šä¿å­˜ä¸º /Data/logs/product/198.168.56.123/karltest_demo-20161218.log</p><p>è§£é‡Šä¸‹è¿™ä¸ªæŒ‡ä»¤%syslogtag:F,44:2%</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">F : - ä»£è¡¨è‡ªå®šä¹‰ä¸€ä¸ªåˆ†éš”ç¬¦</span><br><span class="line"></span><br><span class="line">44 : - æ˜¯é€—å· , çš„ ASCII ç å€¼ï¼Œå¦‚éœ€è¦åˆ«çš„åˆ†éš”ç¬¦ï¼Œéœ€è¦æŸ¥å¯¹åº” ASCII å€¼</span><br><span class="line"></span><br><span class="line">2 : - å–åˆ†éš”åçš„ç¬¬äºŒä¸ªå­—æ®µ</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å°±æ˜¯ï¼š å‡è®¾å‘é€ç«¯è‡ªå®šä¹‰çš„tagä¸º $InputFileTag product,karltest_demoï¼Œ</p><p>å¦‚æœtagä»¥productå¼€å§‹ï¼Œåˆ™å–å‡ºé€—å·åˆ†éš”çš„ç¬¬äºŒä¸ªå­—æ®µä½œä¸ºä¿å­˜çš„æ–‡ä»¶åï¼Œè¿™ä¹Ÿæ˜¯ä¸ºå•¥ä¸Šé¢tagé‡Œè¦è®¾ç½®ä¸€ä¸ªé€—å·çš„ç¼˜æ•…ã€‚</p><p>å¦å¤–ï¼Œè¿˜æ”¯æŒä¸€å®šçš„ regex è¯­æ³•ï¼Œå¯ä»¥è¿›è¡Œæ›´é«˜çº§çš„æ§åˆ¶ã€‚å®˜æ–¹æä¾›äº†ä¸€ä¸ªåœ¨çº¿çš„ regex è¯­æ³•æµ‹è¯•ã€‚</p><p><em>å‹æƒ…æé†’ï¼šçœŸçš„å¾ˆéš¾ç”¨ã€‚ã€‚ã€‚</em></p><h2 id="åœæ­¢æŒ‡ä»¤"><a href="#åœæ­¢æŒ‡ä»¤" class="headerlink" title="åœæ­¢æŒ‡ä»¤"></a>åœæ­¢æŒ‡ä»¤</h2><p>ä¸Šé¢çš„æ¥æ”¶ç«¯ï¼Œåœ¨ä¸€æ¡è§„åˆ™åï¼ŒåŠ ä¸Šäº†å¦‚ä¸‹çš„æŒ‡ä»¤ï¼ˆä¹Ÿå«åœæ­¢æŒ‡ä»¤ï¼‰ï¼Œä»£è¡¨å¦‚æœlogè¢«å½“å‰çš„ruleå·²ç»å¤„ç†è¿‡äº†ï¼Œåˆ™å®Œæˆæœ¬æ¬¡æ‰§è¡Œï¼Œè·³è¿‡åç»­ruleçš„å¤„ç†ã€‚ ç±»ä¼¼ C++é‡Œ switch/caseï¼Œå¦‚æœå¿˜è®°åŠ breakçš„ç©¿é€å‰¯ä½œç”¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp; ~</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªæŒ‡ä»¤ï¼Œåˆ™ä¸€æ¡æ–°æ¥çš„æ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªruleå¤„ç†ã€‚ è¿™é‡Œæˆ‘ä»¬å¹¶ä¸éœ€è¦ï¼Œåªè¦å‘½ä¸­å°±ä¿å­˜åˆ°æ¥æ”¶ç«¯åŒåçš„æ–‡ä»¶é‡Œã€‚</p><h2 id="å‘é€ç«¯é…ç½®"><a href="#å‘é€ç«¯é…ç½®" class="headerlink" title="å‘é€ç«¯é…ç½®"></a>å‘é€ç«¯é…ç½®</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. åŠ è½½ imfile æ¨¡å—</span><br><span class="line">2. æŒ‡å®šè¦ç›‘æ§çš„ log æ–‡ä»¶è·¯å¾„ï¼Œè®¾ç½®åˆé€‚çš„tag</span><br><span class="line">3. æŒ‡å®šè¿œç«¯çš„æ¥æ”¶ç«¯çš„åœ°å€</span><br></pre></td></tr></table></figure><p>å®Œæ•´é…ç½®ï¼š /etc/rsyslog.conf å’Œ /etc/rsyslog.d/product.conf</p><h1 id="æ¥æ”¶ç«¯é…ç½®"><a href="#æ¥æ”¶ç«¯é…ç½®" class="headerlink" title="æ¥æ”¶ç«¯é…ç½®"></a>æ¥æ”¶ç«¯é…ç½®</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. åŠ è½½ imtcp æ¨¡å—</span><br><span class="line">2. è®¾ç½® message æ ¼å¼</span><br><span class="line">3. è®¾ç½® æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼Œæ–‡ä»¶åæ ¼å¼</span><br></pre></td></tr></table></figure><p>å®Œæ•´é…ç½®ï¼š /etc/rsyslog.conf</p><h1 id="é‡åˆ°çš„å‘"><a href="#é‡åˆ°çš„å‘" class="headerlink" title="é‡åˆ°çš„å‘"></a>é‡åˆ°çš„å‘</h1><h4 id="UDP-or-TCP"><a href="#UDP-or-TCP" class="headerlink" title="UDP or TCP ?"></a>UDP or TCP ?</h4><p>ä¸€èˆ¬æ¥è¯´é€‰æ‹©TCPéƒ½æ˜¯OKçš„ï¼Œé™¤éå¿å—éƒ¨åˆ†ä¸¢å¤±ï¼Œåœ¨æ„å½±å“æ€§èƒ½ï¼Œå¯ä»¥æ”¹ç”¨UDPã€‚</p><p>ä½†æ˜¯æ³¨æ„ï¼šå¦‚æœä½ çš„æ¶ˆæ¯æ¯è¡Œå¤§å°è¶…è¿‡äº†4kï¼Œåªèƒ½ç”¨TCPã€‚è¿™æ˜¯å› ä¸ºUDPæ ˆå¤§å°é™åˆ¶çš„ã€‚</p><p>å¼•ç”¨å®˜æ–¹æœ‰å…³ MaxMessageSize çš„æè¿°ï¼š</p><blockquote><p>Note: testing showed that 4k seems to be the typical maximum for UDP based syslog. This is an IP stack restriction. Not always â€¦ but very often. If you go beyond that value, be sure to test that rsyslogd actually does what you think it should do ;) It is highly suggested to use a TCP based transport instead of UDP (plain TCP syslog, RELP). This resolves the UDP stack size restrictions.</p></blockquote><h4 id="å¦‚ä½•æµ‹è¯•ï¼š-vim-vs-echo"><a href="#å¦‚ä½•æµ‹è¯•ï¼š-vim-vs-echo" class="headerlink" title="å¦‚ä½•æµ‹è¯•ï¼š vim vs echo ?"></a>å¦‚ä½•æµ‹è¯•ï¼š vim vs echo ?</h4><p>é…ç½®å¥½æ¥æ”¶ç«¯ã€å‘é€ç«¯rsyslogåï¼Œéœ€è¦éªŒè¯ä¸‹æ˜¯å¦èƒ½æ­£ç¡®ä¼ é€æ–°çš„logè¡Œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. echoè¿½åŠ ï¼š echo "dummy message" &gt;&gt; /Data/logs/product/karltest.log</span><br><span class="line">2. vimç¼–è¾‘ï¼š vim /Data/logs/product/karltest.log</span><br></pre></td></tr></table></figure><p>ç”¨vimç¼–è¾‘åï¼Œä¿å­˜ä¼šåˆ·æ–°æ•´ä¸ªæ–‡ä»¶ï¼Œå¯¼è‡´rsyslogåœ¨æ¯”è¾ƒstate fileçš„æ—¶å€™ï¼Œè®¤ä¸ºå…¨éƒ¨æ˜¯æ–°å¢çš„è¡Œï¼Œä¼šåœ¨æ¥æ”¶ç«¯å‡ºç°é‡å¤çš„logè¡Œã€‚</p><p>æ‰€ä»¥æ­£ç¡®æµ‹è¯•æ–¹æ³•æ˜¯ç”¨ echo è¿½åŠ çš„æ–¹å¼ã€‚</p><blockquote><p>Tips:</p><p>å‘é€ç«¯ï¼šå¯ä»¥é…åˆ watch æ¥æµ‹è¯•ï¼š watch -n 1 â€œ echo $(date) dummy message &gt;&gt; /Data/logs/product/karltest.log â€œ</p><p>æ¥æ”¶ç«¯ï¼š tailf /Data/logs/karltest/karltest.log</p></blockquote><h4 id="æ¥æ”¶ç«¯ï¼šlogè¡Œå¤ªé•¿ï¼Œè¢«æˆªæ–­äº†"><a href="#æ¥æ”¶ç«¯ï¼šlogè¡Œå¤ªé•¿ï¼Œè¢«æˆªæ–­äº†" class="headerlink" title="æ¥æ”¶ç«¯ï¼šlogè¡Œå¤ªé•¿ï¼Œè¢«æˆªæ–­äº†"></a>æ¥æ”¶ç«¯ï¼šlogè¡Œå¤ªé•¿ï¼Œè¢«æˆªæ–­äº†</h4><p>é»˜è®¤å¤§å°æ˜¯2kï¼Œå¤§æ¦‚å¯ä»¥ä¿å­˜1000ä¸ªä¸­æ–‡å­—ç¬¦ï¼Œå‚è€ƒå®˜æ–¹è¯´æ˜ $MaxMessageSizeï¼Œ æœ€å°ä¹Ÿæ˜¯2kã€‚</p><p>åœ¨åŠ è½½imtcp/imudpä¹‹å‰è®¾ç½®ï¼Œ æ­¤é…ç½®åŒ…æ‹¬å‘é€å’Œæ¥æ”¶ï¼Œæ‰€ä»¥rsyslogå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯éƒ½è¦è®¾ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">MaxMessageSize 32k</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Provides TCP syslog reception</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$ModLoad</span> imtcp</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="variable">$InputTCPServerRun</span> 514</span></span><br></pre></td></tr></table></figure><h4 id="å‘é€ç«¯ï¼š-var-log-messages-æ–‡ä»¶å˜å¤§"><a href="#å‘é€ç«¯ï¼š-var-log-messages-æ–‡ä»¶å˜å¤§" class="headerlink" title="å‘é€ç«¯ï¼š/var/log/messages æ–‡ä»¶å˜å¤§"></a>å‘é€ç«¯ï¼š/var/log/messages æ–‡ä»¶å˜å¤§</h4><p>logé™¤äº†å‘é€åˆ°äº†æ¥æ”¶ç«¯ï¼Œè¿˜åœ¨æœ¬åœ° /var/log/messages é‡Œé‡å¤å‡ºç°äº†ï¼Œå¯¼è‡´messagesä¸ŠG</p><p>ç½ªé­ç¥¸é¦–æ˜¯é»˜è®¤çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹è¿™è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹å‰</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none /var/log/messages</span><br><span class="line"><span class="meta">#</span><span class="bash"> Fixå</span></span><br><span class="line">*.info;mail.none;authpriv.none;cron.none;local5.none;local6.none /var/log/messages</span><br></pre></td></tr></table></figure><p>å› ä¸ºå‰é¢æœ‰é€šé…ç¬¦ *.info å¯¼è‡´æˆ‘ä»¬è‡ªå®šä¹‰çš„ local5.info ä¹Ÿä¼šå†™åˆ°æœ¬åœ°messagesæ–‡ä»¶ã€‚</p><p>ä¸ºäº†ä¿é™©ï¼Œè¯·æŠŠæ¥æ”¶ç«¯ã€å‘é€ç«¯çš„é…ç½®æ–‡ä»¶éƒ½ä¿®æ”¹æ‰ï¼Œå¿½ç•¥æ‰local5ã€‚</p><h4 id="æ¥æ”¶ç«¯ï¼šæ¶ˆæ¯è¢«å¤šä¸ªruleå¤„ç†"><a href="#æ¥æ”¶ç«¯ï¼šæ¶ˆæ¯è¢«å¤šä¸ªruleå¤„ç†" class="headerlink" title="æ¥æ”¶ç«¯ï¼šæ¶ˆæ¯è¢«å¤šä¸ªruleå¤„ç†"></a>æ¥æ”¶ç«¯ï¼šæ¶ˆæ¯è¢«å¤šä¸ªruleå¤„ç†</h4><p>åœ¨å‘½ä¸­æŸæ¡ruleåï¼Œç›´æ¥breakåœæ­¢</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if $syslogtag startswith 'product' then ?productFileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ–°ç‰ˆæœ¬v6ä¹‹åï¼Œå˜ä¸ºï¼š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> rsyslogd: warning: ~ action is deprecated, consider using the <span class="string">'stop'</span> statement instead [try http://www.rsyslog.com/e/2307 ]</span></span><br><span class="line">if $syslogtag startswith 'product' then ?productFileFormat;CleanMsgFormat</span><br><span class="line">stop</span><br></pre></td></tr></table></figure><h4 id="æ¥æ”¶ç«¯ï¼š-ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ä¸å¯¹"><a href="#æ¥æ”¶ç«¯ï¼š-ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ä¸å¯¹" class="headerlink" title="æ¥æ”¶ç«¯ï¼š ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ä¸å¯¹"></a>æ¥æ”¶ç«¯ï¼š ä¿å­˜çš„æ–‡ä»¶è·¯å¾„ä¸å¯¹</h4><p>è¦æ³¨æ„è‡ªå®šä¹‰tagçš„å‰ç¼€åŒ¹é…ï¼Œå¦‚æœä¸¤ä¸ªtagæœ‰å…±åŒçš„å‰ç¼€ï¼Œéœ€è¦æŠŠé•¿çš„æ”¾åœ¨å‰é¢ï¼Œè°ƒæ•´å¥½é¡ºåºã€‚</p><p>Fix å‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> For erp_wms</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template erp_wms_FileFormat,<span class="string">"/Data/logs/erp/wms/%fromhost-ip%/%syslogtag:F,44:2%-%<span class="variable">$YEAR</span>%%<span class="variable">$MONTH</span>%%<span class="variable">$DAY</span>%.log"</span></span></span><br><span class="line">if $syslogtag startswith 'erp_wms' then ?erp_wms_FileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br><span class="line"><span class="meta">#</span><span class="bash"> For erp_wms3</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template erp_wms3_FileFormat,<span class="string">"/Data/logs/erp/wms3/%fromhost-ip%/%syslogtag:F,44:2%-%<span class="variable">$YEAR</span>%%<span class="variable">$MONTH</span>%%<span class="variable">$DAY</span>%.log"</span></span></span><br><span class="line">if $syslogtag startswith 'erp_wms3' then ?erp_wms3_FileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br></pre></td></tr></table></figure><p>Fix åï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿™é‡Œæ³¨æ„ä¸‹é¢çš„tagçš„é¡ºåºï¼Œ ä¸€å®šè¦è®©é•¿çš„tagï¼ˆerp_wms3ï¼‰ä¿æŒåœ¨ä¸Šé¢ï¼Œå› ä¸ºä»–ä»¬æœ‰å…±åŒçš„å‰ç¼€(erp_wms)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For erp_wms3</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template erp_wms3_FileFormat,<span class="string">"/Data/logs/erp/wms3/%fromhost-ip%/%syslogtag:F,44:2%-%<span class="variable">$YEAR</span>%%<span class="variable">$MONTH</span>%%<span class="variable">$DAY</span>%.log"</span></span></span><br><span class="line">if $syslogtag startswith 'erp_wms3' then ?erp_wms3_FileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br><span class="line"><span class="meta">#</span><span class="bash"> For erp_wms</span></span><br><span class="line"><span class="meta">$</span><span class="bash">template erp_wms_FileFormat,<span class="string">"/Data/logs/erp/wms/%fromhost-ip%/%syslogtag:F,44:2%-%<span class="variable">$YEAR</span>%%<span class="variable">$MONTH</span>%%<span class="variable">$DAY</span>%.log"</span></span></span><br><span class="line">if $syslogtag startswith 'erp_wms' then ?erp_wms_FileFormat;CleanMsgFormat</span><br><span class="line">&amp; ~</span><br></pre></td></tr></table></figure><h4 id="æ¥æ”¶ç«¯ï¼š-rsyslog-æ–‡ä»¶åå¤ªé•¿åè¢«æˆªæ–­"><a href="#æ¥æ”¶ç«¯ï¼š-rsyslog-æ–‡ä»¶åå¤ªé•¿åè¢«æˆªæ–­" class="headerlink" title="æ¥æ”¶ç«¯ï¼š rsyslog æ–‡ä»¶åå¤ªé•¿åè¢«æˆªæ–­"></a>æ¥æ”¶ç«¯ï¼š rsyslog æ–‡ä»¶åå¤ªé•¿åè¢«æˆªæ–­</h4><p>æ¯”å¦‚å‘é€ç«¯åŸå§‹æ–‡ä»¶åtag: productï¼Œcache_status_im_request.log</p><p>ä½†æ˜¯åˆ°äº†æ¥æ”¶ç«¯å°±æˆªæ–­äº†ï¼š cache_status_im_re-20161218.log</p><p>å› ä¸ºæœ¬æ¥åå­—å°±é•¿ï¼ŒåŠ ä¸Šäº†æ—¶é—´åæ›´é•¿äº†ï¼Œ</p><p>ä¸ªäººç†è§£ï¼ŒLinuxä¸­å…³äºæ–‡ä»¶åï¼ˆ255ï¼‰ï¼Œæ–‡ä»¶è·¯å¾„ï¼ˆ4096ï¼‰çš„é™åˆ¶å¦‚ä¸‹ï¼Œè€Œåœ¨æ¥æ”¶ç«¯ï¼Œéƒ½æ²¡æœ‰è¶…è¿‡è¿™ä¸ªé•¿åº¦ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /usr/include/linux/limits.h</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ifndef _LINUX_LIMITS_H</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define _LINUX_LIMITS_H</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define NR_OPEN         1024</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define NGROUPS_MAX    65536    /* supplemental group IDs are available */</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define ARG_MAX       131072    /* <span class="comment"># bytes of args + environ for exec() */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define LINK_MAX         127    /* <span class="comment"># links a file may have */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define MAX_CANON        255    /* size of the canonical input queue */</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define MAX_INPUT        255    /* size of the <span class="built_in">type</span>-ahead buffer */</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define NAME_MAX         255    /* <span class="comment"># chars in a file name */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define PATH_MAX        4096    /* <span class="comment"># chars in a path name including nul */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define PIPE_BUF        4096    /* <span class="comment"># bytes in atomic write to a pipe */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define XATTR_NAME_MAX   255    /* <span class="comment"># chars in an extended attribute name */</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">define XATTR_SIZE_MAX 65536    /* size of an extended attribute value (64k) */</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define XATTR_LIST_MAX 65536    /* size of extended attribute namelist (64k) */</span></span><br><span class="line"><span class="meta">#</span><span class="bash">define RTSIG_MAX         32</span></span><br><span class="line"><span class="meta">#</span><span class="bash">endif</span></span><br></pre></td></tr></table></figure><p>è¿›è¿‡ä¸€ç•ªè‰°éš¾çš„æµ‹è¯•å¤ç°ï¼ŒçŒœæµ‹æ˜¯ $InputFileTag è¿™ä¸ª %syslogtag%çš„åŸå› ã€‚</p><p>å®˜æ–¹è§£é‡ŠSending messages with tags larger than 32 charactersã€‚</p><p>å‘é€ç«¯é»˜è®¤çš„æ¨¡æ¿ä¸ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¿½ç•¥æ—§çš„5.8.6çš„è¯­æ³•</span></span><br><span class="line">template (name="ForwardFormat" type="string" string="&lt;%PRI%&gt;%TIMESTAMP:::date-rfc3339% %HOSTNAME%</span><br><span class="line"><span class="meta">%</span><span class="bash">syslogtag:1:32%%msg:::sp-if-no-1st-sp%%msg%<span class="string">")</span></span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° %syslogtag:1:32%ï¼Œè¢«æˆªæ–­åˆ°32å­—ç¬¦ï¼Œè¿™ä¸ªä¹Ÿä¸æˆ‘æµ‹è¯•çš„ç»“æœä¸€è‡´ã€‚</p><p>æ‰€ä»¥å¦‚æœéœ€è¦å¤„ç†æ›´é•¿çš„tagï¼Œéœ€è¦ä¿®æ”¹ å‘é€ç«¯çš„templateæ¨¡æ¿ï¼Œå»æ‰ :1:32 é™åˆ¶ã€‚</p><p>ç„¶åç»‘å®šè¿™ä¸ªæ¨¡æ¿åˆ°å¯¹åº”çš„targetä¸Šã€‚</p><p>æ³¨æ„ï¼šæ¥æ”¶ç«¯å¯èƒ½ä¹Ÿè¦ç›¸åº”å¤„ç†ï¼Œæ‰èƒ½handleæ›´é•¿çš„tagåï¼ˆæœªæµ‹è¯•ï¼‰ã€‚</p><blockquote><p>å…è´£å£°æ˜ï¼šç”±äºæŠ˜è…¾è¿™ä¸ªrsyslogå¤ªç´¯ï¼Œæœ€åä¸€æ¡æš‚æ—¶æ²¡æœ‰Fixï¼Œå¦‚æœ‰éœ€è¦ï¼Œè¯·è‡ªè¡Œæµ‹è¯•åå†ç”¨ã€‚</p></blockquote><h4 id="å¦‚ä¸‹çš„ä¸¤ä¸ª-syslogtag-ï¼Œç”±äºå‰32ä¸ªå­—ç¬¦éƒ½ç›¸åŒï¼Œå¯¼è‡´æœ€åæ—¥å¿—å†™åˆ°åŒä¸€ä¸ªæ–‡ä»¶-databas-log-æŒ‰ç…§é€—å·åˆ‡å‰²å-äº†"><a href="#å¦‚ä¸‹çš„ä¸¤ä¸ª-syslogtag-ï¼Œç”±äºå‰32ä¸ªå­—ç¬¦éƒ½ç›¸åŒï¼Œå¯¼è‡´æœ€åæ—¥å¿—å†™åˆ°åŒä¸€ä¸ªæ–‡ä»¶-databas-log-æŒ‰ç…§é€—å·åˆ‡å‰²å-äº†" class="headerlink" title="å¦‚ä¸‹çš„ä¸¤ä¸ª%syslogtag%ï¼Œç”±äºå‰32ä¸ªå­—ç¬¦éƒ½ç›¸åŒï¼Œå¯¼è‡´æœ€åæ—¥å¿—å†™åˆ°åŒä¸€ä¸ªæ–‡ä»¶ databas.log (æŒ‰ç…§é€—å·åˆ‡å‰²å)äº†"></a>å¦‚ä¸‹çš„ä¸¤ä¸ª%syslogtag%ï¼Œç”±äºå‰32ä¸ªå­—ç¬¦éƒ½ç›¸åŒï¼Œå¯¼è‡´æœ€åæ—¥å¿—å†™åˆ°åŒä¸€ä¸ªæ–‡ä»¶ databas.log (æŒ‰ç…§é€—å·åˆ‡å‰²å)äº†</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">InputFileName /Data/logs/mqorder/order-mq-aws/database-stat.log</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileTag erp_mqorder-order-mq-aws,database-stat <span class="comment"># é•¿åº¦39</span></span></span><br><span class="line">...</span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileName /Data/logs/mqorder/order-mq-aws/database-timeout.log</span></span><br><span class="line"><span class="meta">$</span><span class="bash">InputFileTag erp_mqorder-order-mq-aws,database-timeout <span class="comment"># é•¿åº¦42</span></span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ³•-ï¼š"><a href="#è§£å†³æ–¹æ³•-ï¼š" class="headerlink" title="è§£å†³æ–¹æ³• ï¼š"></a>è§£å†³æ–¹æ³• ï¼š</h4><p>åœ¨å‘é€ç«¯çš„ä¸»é…ç½®æ–‡ä»¶ /etc/rsyslog.confé‡Œä¿®æ”¹å‘é€è§„åˆ™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment">### begin forwarding rule ###</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">template LongTagForwardFormat,<span class="string">"&lt;%PRI%&gt;%TIMESTAMP:::date-rfc3339% %HOSTNAME% %syslogtag%%msg:::sp-if-no-1st-sp%%msg%"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">WorkDirectory /var/lib/rsyslog <span class="comment"># where to place spool files</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionQueueFileName karlzhou_fwdRule <span class="comment"># unique name prefix for spool files</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionQueueMaxDiskSpace 5g <span class="comment"># 5gb space limit (use as much as possible)</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionQueueSaveOnShutdown on <span class="comment"># save messages to disk on shutdown</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionQueueType LinkedList <span class="comment"># run asynchronously</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">ActionResumeRetryCount -1 <span class="comment"># infinite retries if host is down</span></span></span><br><span class="line">local5.* @@rsyslog.karlzhou.org:514;LongTagForwardFormat</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="comment">### end of the forwarding rule ###</span></span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­èµ·ä½œç”¨çš„å°±æ˜¯ LongTagForwardFormat è¿™ä¸ªæ¨¡æ¿ã€‚</p><h4 id="è§£å†³è¿‡ç¨‹-ï¼š"><a href="#è§£å†³è¿‡ç¨‹-ï¼š" class="headerlink" title="è§£å†³è¿‡ç¨‹ ï¼š"></a>è§£å†³è¿‡ç¨‹ ï¼š</h4><p>å‚è€ƒäº†ä¸Šé¢çš„é“¾æ¥: å®˜æ–¹è§£é‡ŠSending messages with tags larger than 32 characters å’Œ tag getting truncatedã€‚</p><p>å®˜æ–¹è§£é‡Šé‡Œæ˜¯ 5.8.6 çš„æ—§çš„è¯­æ³•ï¼Œè€ŒCentOS6.x Finalä¸Šè‡ªå¸¦çš„æ˜¯ 5.8.10ï¼Œ è¯­æ³•ä¸ä¸€æ ·ã€‚</p><p>ä»å®˜ç½‘ä¸‹è½½5.8.10çš„æºç : <a href="http://www.rsyslog.com/files/download/rsyslog/rsyslog-5.8.10.tar.gz" target="_blank" rel="noopener">http://www.rsyslog.com/files/download/rsyslog/rsyslog-5.8.10.tar.gz</a></p><p>å…¨æ–‡æœç´¢å…³é”®å­— %syslogtagï¼Œ æœ€ç»ˆåœ¨å¦‚ä¸‹å‡ ä¸ªæ–‡ä»¶æ‰¾åˆ°è››ä¸é©¬è¿¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rsyslog-5.8.10/tools/smfwd.c</span><br><span class="line"></span><br><span class="line">rsyslog-5.8.10/tools/smtradfile.c</span><br><span class="line"></span><br><span class="line">rsyslog-5.8.10/tools/smtradfwd.c</span><br><span class="line"></span><br><span class="line">rsyslog-5.8.10/tools/syslogd.c</span><br><span class="line"></span><br><span class="line">å…¨æ–‡æœç´¢å…³é”®å­— ForwardFormat:</span><br><span class="line"></span><br><span class="line">rsyslog-5.8.10/tools/syslogd.c</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/* hardcoded standard templates (used for defaults) */</span><br><span class="line">static uchar template_DebugFormat[] = "\"Debug line with all properties:\nFROMHOST: '%FROMHOST%', fromhost-ip: '%fromhost-ip%', HOSTNAME: '%HOSTNAME%', PRI: %PRI%,\nsyslogtag '%syslogtag%', programname: '%programname%', APP-NAME: '%APP-NAME%', PROCID: '%PROCID%', MSGID: '%MSGID%',\nTIMESTAMP: '%TIMESTAMP%', STRUCTURED-DATA: '%STRUCTURED-DATA%',\nmsg: '%msg%'\nescaped msg: '%msg:::drop-cc%'\ninputname: %inputname% rawmsg: '%rawmsg%'\n\n\"";</span><br><span class="line">static uchar template_SyslogProtocol23Format[] = "\"&lt;%PRI%&gt;1 %TIMESTAMP:::date-rfc3339% %HOSTNAME% %APP-NAME% %PROCID% %MSGID% %STRUCTURED-DATA% %msg%\n\"";</span><br><span class="line">static uchar template_TraditionalFileFormat[] = "=RSYSLOG_TraditionalFileFormat";</span><br><span class="line">static uchar template_FileFormat[] = "=RSYSLOG_FileFormat";</span><br><span class="line">static uchar template_ForwardFormat[] = "=RSYSLOG_ForwardFormat";</span><br><span class="line">static uchar template_TraditionalForwardFormat[] = "=RSYSLOG_TraditionalForwardFormat";</span><br><span class="line">static uchar template_WallFmt[] = "\"\r\n\7Message from syslogd@%HOSTNAME% at %timegenerated% ...\r\n %syslogtag%%msg%\n\r\"";</span><br><span class="line">static uchar template_StdUsrMsgFmt[] = "\" %syslogtag%%msg%\n\r\"";</span><br><span class="line">static uchar template_StdDBFmt[] = "\"insert into SystemEvents (Message, Facility, FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values ('%msg%', %syslogfacility%, '%HOSTNAME%', %syslogpriority%, '%timereported:::date-mysql%', '%timegenerated:::date-mysql%', %iut%, '%syslogtag%')\",SQL";</span><br><span class="line">static uchar template_StdPgSQLFmt[] = "\"insert into SystemEvents (Message, Facility, FromHost, Priority, DeviceReportedTime, ReceivedAt, InfoUnitID, SysLogTag) values ('%msg%', %syslogfacility%, '%HOSTNAME%', %syslogpriority%, '%timereported:::date-pgsql%', '%timegenerated:::date-pgsql%', %iut%, '%syslogtag%')\",STDSQL";</span><br><span class="line">static uchar template_spoofadr[] = "\"%fromhost-ip%\"";</span><br><span class="line">/* end templates */</span><br></pre></td></tr></table></figure><p>æ­£å¦‚å®˜ç½‘é“¾æ¥æ‰€è¯´ï¼Œæºç é‡Œ hardcoded é‡Œå¤šä¸ªé»˜è®¤æ¨¡æ¿æ ¼å¼ï¼Œ</p><p>å…¶ä¸­æˆ‘ä»¬éœ€è¦å…³æ³¨çš„å°±æ˜¯ RSYSLOG_ForwardFormat, å¯¹åº”çš„æ–‡ä»¶å³ï¼šrsyslog-5.8.10/tools/smfwd.cã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/* smfwd.c</span><br><span class="line">* This is a strgen module for the traditional (network) forwarding format.</span><br><span class="line">*</span><br><span class="line">* Format generated:</span><br><span class="line">* "&lt;%PRI%&gt;%TIMESTAMP:::date-rfc3339% %HOSTNAME% %syslogtag:1:32%%msg:::sp-if-no-1st-sp%%msg%"</span><br><span class="line">*</span><br><span class="line">* NOTE: read comments in module-template.h to understand how this file</span><br><span class="line">* works!</span><br><span class="line">*</span><br><span class="line">* File begun on 2010-06-01 by RGerhards</span><br><span class="line">*</span><br></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œå°±èƒ½æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„æ­£ç¡®çš„é»˜è®¤æ ¼å¼äº†, å¯ä»¥çœ‹åˆ° %syslogtag% æˆªå–äº†å‰é¢32ä¸ªå­—ç¬¦ï¼ŒæŠŠForwardFormatè§„åˆ™æ›¿æ¢æˆå®Œæ•´çš„ %syslogtag% å³å¯ï¼Œæ³¨æ„ï¼šæœ€å¤§çš„é•¿åº¦æ˜¯512ã€‚</p><h4 id="æ¥ä¸‹æ¥â€¦â€¦"><a href="#æ¥ä¸‹æ¥â€¦â€¦" class="headerlink" title="æ¥ä¸‹æ¥â€¦â€¦"></a>æ¥ä¸‹æ¥â€¦â€¦</h4><p>é€šè¿‡ä¸€ç•ªè®¾ç½®ï¼Œæˆ‘ä»¬å·²ç»èƒ½æˆåŠŸæ”¶é›†è‹¥å¹²å°çº¿ä¸Šæœºå™¨çš„æ—¥å¿—äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> tree -I <span class="string">"*gz|*log"</span> /Data/logs/</span></span><br><span class="line">/Data/logs/</span><br><span class="line">â”œâ”€â”€ gateway</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.18</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.19</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.195</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.197</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.198</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â””â”€â”€ 172.31.70.20</span><br><span class="line">â”‚   â””â”€â”€ archived</span><br><span class="line">â”œâ”€â”€ product</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.118</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.119</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â”œâ”€â”€ 172.31.70.23</span><br><span class="line">â”‚   â”‚   â””â”€â”€ archived</span><br><span class="line">â”‚   â””â”€â”€ 172.31.70.24</span><br><span class="line">â”‚   â””â”€â”€ archived</span><br><span class="line">...</span><br><span class="line"><span class="meta">#</span><span class="bash"> du -sh /Data/logs</span></span><br><span class="line">271G /Data/logs</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š</p><blockquote><p>ä¸Šç™¾å°æœºå™¨çš„ä¸Šå‡ ç™¾Gçš„æ—¥å¿—ï¼Œæ€ä¹ˆæ‰èƒ½é¿å…æ¥æ”¶ç«¯ç¡¬ç›˜çˆ†æ‰ï¼Ÿ</p></blockquote><p>å¾—ç”¨å¦ä¸€ä¸ªLinuxè‡ªå¸¦çš„è„šæœ¬ /usr/sbin/logrotate, æ¥é…åˆ rsyslogã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux_command </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux_command </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†</title>
      <link href="/2020/03/05/Centos7-%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/"/>
      <url>/2020/03/05/Centos7-%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†"><a href="#Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†" class="headerlink" title="Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†"></a><strong>Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†</strong></h1><h2 id="ä»€ä¹ˆæ˜¯è¿›ç¨‹"><a href="#ä»€ä¹ˆæ˜¯è¿›ç¨‹" class="headerlink" title="ä»€ä¹ˆæ˜¯è¿›ç¨‹"></a>ä»€ä¹ˆæ˜¯è¿›ç¨‹</h2><p><strong>è¿›ç¨‹æ˜¯å·²å¯åŠ¨çš„å¯æ‰§è¡Œç¨‹åºçš„è¿è¡Œå®ä¾‹ï¼Œè¿›ç¨‹æœ‰ä»¥ä¸‹ç»„æˆéƒ¨åˆ†ï¼š</strong>   </p><p><strong>å·²åˆ†é…å†…å­˜çš„åœ°å€ç©ºé—´ï¼›</strong>   </p><p><strong>å®‰å…¨å±æ€§ï¼ŒåŒ…æ‹¬æ‰€æœ‰æƒå‡­æ®å’Œç‰¹æƒï¼›</strong>   </p><p><strong>ç¨‹åºä»£ç çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ‰§è¡Œçº¿ç¨‹ï¼›</strong>   </p><p><strong>è¿›ç¨‹çŠ¶æ€</strong></p><p><strong>ç¨‹åºï¼š</strong> äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé™æ€ /bin/date, /usr/sbin/httpdï¼Œ/usr/sbin/sshd, /usr/local/nginx/sbin/nginx ã€‚</p><p><strong>è¿›ç¨‹ï¼š</strong> æ˜¯ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ï¼Œ åŠ¨æ€ï¼Œæœ‰ç”Ÿå‘½å‘¨æœŸåŠè¿è¡ŒçŠ¶æ€ã€‚</p><h2 id="è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ"></a>è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="640.png" alt="Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†"></p><p><strong>æè¿°å¦‚ä¸‹ï¼š</strong></p><p>çˆ¶è¿›ç¨‹å¤åˆ¶è‡ªå·±çš„åœ°å€ç©ºé—´ï¼ˆfork  <strong>[fÉ”:k]</strong> åˆ†å‰ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„ï¼ˆå­ï¼‰è¿›ç¨‹ç»“æ„ã€‚æ¯ä¸ªæ–°è¿›ç¨‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è¿›ç¨‹ ID ï¼ˆPIDï¼‰ï¼Œæ»¡è¶³è·Ÿè¸ªå®‰å…¨æ€§ä¹‹éœ€ã€‚PID å’Œ çˆ¶è¿›ç¨‹ ID ï¼ˆPPIDï¼‰æ˜¯å­è¿›ç¨‹ç¯å¢ƒçš„å…ƒç´ ï¼Œä»»ä½•è¿›ç¨‹éƒ½å¯ä»¥åˆ›å»ºå­è¿›ç¨‹ï¼Œæ‰€æœ‰è¿›ç¨‹éƒ½æ˜¯ç¬¬ä¸€ä¸ªç³»ç»Ÿè¿›ç¨‹çš„åä»£ã€‚</p><p><strong>centos5æˆ–6PIDä¸º1çš„è¿›ç¨‹æ˜¯ï¼š</strong>init   </p><p><strong>centos7 PIDä¸º1çš„è¿›ç¨‹æ˜¯ï¼š</strong>systemd</p><p><strong>åƒµå°¸è¿›ç¨‹ï¼š</strong>ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨forkåˆ›å»ºå­è¿›ç¨‹ï¼Œå¦‚æœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨waitæˆ–waitpidè·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ã€‚è¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµå°¸è¿›ç¨‹ã€‚</p><p><strong>ç”¨è‡ªå·±çš„è¯è¡¨è¾¾</strong>:çˆ¶è¿›ç¨‹é€€å‡ºäº†ï¼Œå­è¿›ç¨‹æ²¡æœ‰é€€å‡ºï¼Œ é‚£ä¹ˆè¿™äº›å­è¿›ç¨‹å°±æ²¡æœ‰çˆ¶è¿›ç¨‹æ¥ç®¡ç†äº†ï¼Œå°±å˜æˆåƒµå°¸è¿›ç¨‹ã€‚</p><h2 id="è¿›ç¨‹çš„å±æ€§"><a href="#è¿›ç¨‹çš„å±æ€§" class="headerlink" title="è¿›ç¨‹çš„å±æ€§"></a>è¿›ç¨‹çš„å±æ€§</h2><p><strong>è¿›ç¨‹IDï¼ˆPID)ï¼š</strong>æ˜¯å”¯ä¸€çš„æ•°å€¼ï¼Œç”¨æ¥åŒºåˆ†è¿›ç¨‹</p><p><strong>çˆ¶è¿›ç¨‹çš„IDï¼ˆPPID)</strong></p><p><strong>å¯åŠ¨è¿›ç¨‹çš„ç”¨æˆ·ID</strong>ï¼ˆUIDï¼‰å’Œæ‰€å½’å±çš„ç»„ï¼ˆGIDï¼‰</p><p><strong>è¿›ç¨‹çŠ¶æ€ï¼š</strong>çŠ¶æ€åˆ†ä¸ºè¿è¡ŒRã€ä¼‘çœ Sã€åƒµå°¸Z</p><p><strong>è¿›ç¨‹æ‰§è¡Œçš„ä¼˜å…ˆçº§</strong></p><p><strong>è¿›ç¨‹æ‰€è¿æ¥çš„ç»ˆç«¯å</strong></p><p><strong>è¿›ç¨‹èµ„æºå ç”¨ï¼š</strong>æ¯”å¦‚å ç”¨èµ„æºå¤§å°ï¼ˆå†…å­˜ã€CPUå ç”¨é‡ï¼‰</p><h2 id="ä½¿ç”¨psæŸ¥çœ‹è¿›ç¨‹å·¥å…·"><a href="#ä½¿ç”¨psæŸ¥çœ‹è¿›ç¨‹å·¥å…·" class="headerlink" title="ä½¿ç”¨psæŸ¥çœ‹è¿›ç¨‹å·¥å…·"></a>ä½¿ç”¨psæŸ¥çœ‹è¿›ç¨‹å·¥å…·</h2><h3 id="å¸¸ç”¨çš„å‚æ•°ï¼š"><a href="#å¸¸ç”¨çš„å‚æ•°ï¼š" class="headerlink" title="å¸¸ç”¨çš„å‚æ•°ï¼š"></a>å¸¸ç”¨çš„å‚æ•°ï¼š</h3><p><strong>a:</strong> <strong>æ˜¾ç¤ºè·Ÿå½“å‰ç»ˆç«¯å…³è”çš„æ‰€æœ‰è¿›ç¨‹</strong></p><p><strong>u:</strong> <strong>åŸºäºç”¨æˆ·çš„æ ¼å¼æ˜¾ç¤ºï¼ˆ</strong>U: æ˜¾ç¤ºæŸç”¨æˆ·IDæ‰€æœ‰çš„è¿›ç¨‹ï¼‰</p><p><strong>x:</strong> <strong>æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ï¼Œä¸ä»¥ç»ˆç«¯æœºæ¥åŒºåˆ†</strong></p><h3 id="å¸¸ç”¨çš„é€‰é¡¹ç»„åˆ"><a href="#å¸¸ç”¨çš„é€‰é¡¹ç»„åˆ" class="headerlink" title="å¸¸ç”¨çš„é€‰é¡¹ç»„åˆ"></a>å¸¸ç”¨çš„é€‰é¡¹ç»„åˆ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-01 ~]# ps -aux|more  ##æ˜¯ç”¨BSDçš„æ ¼å¼æ¥æ˜¾ç¤ºè¿›ç¨‹</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  0.0  0.0 128148  6684 ?        Ss   11æœˆ01   0:09 /usr/lib/syste</span><br><span class="line">md/systemd --switched-root --system --deserialize 22</span><br><span class="line">root         2  0.0  0.0      0     0 ?        S    11æœˆ01   0:00 [kthreadd]</span><br><span class="line">root         3  0.0  0.0      0     0 ?        S    11æœˆ01   0:00 [ksoftirqd/0]</span><br><span class="line">root         5  0.0  0.0      0     0 ?        S&lt;   11æœˆ01   0:00 [kworker/0:0H]</span><br><span class="line">root         6  0.0  0.0      0     0 ?        S    11æœˆ01   0:00 [kworker/u8:0]</span><br><span class="line">root         7  0.0  0.0      0     0 ?        S    11æœˆ01   0:00 [migration/0]</span><br><span class="line">root         8  0.0  0.0      0     0 ?        S    11æœˆ01   0:00 [rcu_bh]</span><br><span class="line">root         9  0.0  0.0      0     0 ?        S    11æœˆ01   0:12 [rcu_sched]</span><br><span class="line">root        10  0.0  0.0      0     0 ?        S&lt;   11æœˆ01   0:00 [lru-add-drain</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#åŒ…å«çš„ä¿¡æ¯å¦‚ä¸‹</span></span></span><br><span class="line">USER:      è¿è¡Œè¿›ç¨‹çš„ç”¨æˆ·</span><br><span class="line">PIDï¼š      è¿›ç¨‹ID</span><br><span class="line"><span class="meta">%</span><span class="bash">CPU:  ã€€ã€€CPUå ç”¨ç‡</span></span><br><span class="line"><span class="meta">%</span><span class="bash">MEM:      å†…å­˜å ç”¨ç‡</span></span><br><span class="line">VSZï¼š      å ç”¨è™šæ‹Ÿå†…å­˜</span><br><span class="line">RSS:       å ç”¨å®é™…å†…å­˜ é©»ç•™å†…å­˜</span><br><span class="line">TTYï¼š      è¿›ç¨‹è¿è¡Œçš„ç»ˆç«¯</span><br><span class="line">STATï¼š     è¿›ç¨‹çŠ¶æ€     man ps (/STATE)            </span><br><span class="line">      R     è¿è¡Œ</span><br><span class="line">      S     å¯ä¸­æ–­ç¡çœ  Sleep</span><br><span class="line">      D     ä¸å¯ä¸­æ–­ç¡çœ </span><br><span class="line">      T     åœæ­¢çš„è¿›ç¨‹ </span><br><span class="line">      Z     åƒµå°¸è¿›ç¨‹</span><br><span class="line">      X     æ­»æ‰çš„è¿›ç¨‹</span><br><span class="line">      </span><br><span class="line">      Ss     sè¿›ç¨‹çš„é¢†å¯¼è€…ï¼Œçˆ¶è¿›ç¨‹</span><br><span class="line">      S&lt; ã€€ã€€ &lt;ä¼˜å…ˆçº§è¾ƒé«˜çš„è¿›ç¨‹</span><br><span class="line">      SN     Nä¼˜å…ˆçº§è¾ƒä½çš„è¿›ç¨‹</span><br><span class="line">      R+      +è¡¨ç¤ºæ˜¯å‰å°çš„è¿›ç¨‹ç»„</span><br><span class="line">      Sl     ä»¥çº¿ç¨‹çš„æ–¹å¼è¿è¡Œ    </span><br><span class="line">START:     è¿›ç¨‹çš„å¯åŠ¨æ—¶é—´</span><br><span class="line">TIMEï¼š     è¿›ç¨‹å ç”¨CPUçš„æ€»æ—¶é—´</span><br><span class="line">COMMANDï¼š  è¿›ç¨‹æ–‡ä»¶ï¼Œè¿›ç¨‹å</span><br><span class="line"></span><br><span class="line">[root@docker-01 ~]# ps -ef|head  ##æ˜¯ç”¨æ ‡å‡†çš„æ ¼å¼æ˜¾ç¤ºè¿›ç¨‹</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 11æœˆ01 ?      00:00:09 /usr/lib/systemd/systemd --switched-root --system --deserialize 22</span><br><span class="line">root         2     0  0 11æœˆ01 ?      00:00:00 [kthreadd]</span><br><span class="line">root         3     2  0 11æœˆ01 ?      00:00:00 [ksoftirqd/0]</span><br><span class="line">root         5     2  0 11æœˆ01 ?      00:00:00 [kworker/0:0H]</span><br><span class="line">root         6     2  0 11æœˆ01 ?      00:00:00 [kworker/u8:0]</span><br><span class="line">root         7     2  0 11æœˆ01 ?      00:00:00 [migration/0]</span><br><span class="line">root         8     2  0 11æœˆ01 ?      00:00:00 [rcu_bh]</span><br><span class="line">root         9     2  0 11æœˆ01 ?      00:00:12 [rcu_sched]</span><br><span class="line">root        10     2  0 11æœˆ01 ?      00:00:00 [lru-add-drain]</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#åŒ…å«çš„ä¿¡æ¯å¦‚ä¸‹</span></span></span><br><span class="line">UID: å¯åŠ¨è¿™äº›è¿›ç¨‹çš„ç”¨æˆ·</span><br><span class="line">PID: è¿›ç¨‹çš„ID</span><br><span class="line">PPID: çˆ¶è¿›ç¨‹çš„è¿›ç¨‹å·</span><br><span class="line">C: è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸä¸­çš„CPUåˆ©ç”¨ç‡</span><br><span class="line">STIME: è¿›ç¨‹å¯åŠ¨æ—¶çš„ç³»ç»Ÿæ—¶é—´</span><br><span class="line">TTY: è¡¨æ˜è¿›ç¨‹åœ¨å“ªä¸ªç»ˆç«¯è®¾å¤‡ä¸Šè¿è¡Œã€‚å¦‚æœæ˜¾ç¤º  ?è¡¨ç¤ºä¸ç»ˆç«¯æ— å…³ï¼Œè¿™ç§è¿›ç¨‹ä¸€èˆ¬æ˜¯å†…æ ¸æ€è¿›ç¨‹ã€‚å¦å¤–ï¼Œ tty1-tty6 æ˜¯æœ¬æœºä¸Šé¢çš„ç™»å…¥è€…ç¨‹åºï¼Œè‹¥ä¸º pts/0Â ç­‰ï¼Œåˆ™è¡¨ç¤ºè¿è¡Œåœ¨è™šæ‹Ÿç»ˆç«¯ä¸Šçš„è¿›ç¨‹ã€‚</span><br><span class="line">TIME: è¿è¡Œè¿›ç¨‹ä¸€å…±ç´¯è®¡å ç”¨çš„CPUæ—¶é—´</span><br><span class="line">CMD: å¯åŠ¨çš„ç¨‹åºåç§°</span><br></pre></td></tr></table></figure><p><img src="640-1.png" alt="Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†"></p><p><img src="640-2.jpeg" alt="Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†"></p><h3 id="å¯¹è¿›ç¨‹çš„æŒ‡å®šåˆ—è¿›è¡Œæ’åº"><a href="#å¯¹è¿›ç¨‹çš„æŒ‡å®šåˆ—è¿›è¡Œæ’åº" class="headerlink" title="å¯¹è¿›ç¨‹çš„æŒ‡å®šåˆ—è¿›è¡Œæ’åº"></a>å¯¹è¿›ç¨‹çš„æŒ‡å®šåˆ—è¿›è¡Œæ’åº</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-01 ~]# ps aux --sort %cpu |less  ##å‡åºæ’åº</span><br><span class="line">[root@docker-01 ~]# ps aux --sort -%cpu |less  ##é™åºæ’åº</span><br><span class="line">[root@docker-01 ~]# ps aux --sort rss |less</span><br><span class="line">[root@docker-01 ~]# ps aux --sort -rss |less</span><br></pre></td></tr></table></figure><h3 id="ä¸å¯ä¸­æ–­çŠ¶æ€"><a href="#ä¸å¯ä¸­æ–­çŠ¶æ€" class="headerlink" title="ä¸å¯ä¸­æ–­çŠ¶æ€"></a>ä¸å¯ä¸­æ–­çŠ¶æ€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-01 ~]# tar -zcvf usr-tar.gz /usr/</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##ç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸æ–­æŸ¥çœ‹çŠ¶æ€ï¼Œç”±S+ï¼ŒR+å˜ä¸ºD+</span></span></span><br><span class="line">[root@docker-01 ~]# ps -axu|grep tar</span><br><span class="line">root     25426  3.8  0.0 123688  1552 pts/0    R+   10:31   0:01 tar -zcvf usr-tar.gz /usr/</span><br><span class="line">root     25447  0.0  0.0 112724   984 pts/1    S+   10:31   0:00 grep --color=auto tar</span><br><span class="line">root     25426  3.8  0.0 123688  1552 pts/0    D+   10:31   0:01 tar -zcvf usr-tar.gz /usr/</span><br><span class="line">root     25447  0.0  0.0 112724   984 pts/1    S+   10:31   0:00 grep --color=auto tar</span><br></pre></td></tr></table></figure><h2 id="æ‰¾å‡ºç³»ç»Ÿä¸­ä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹"><a href="#æ‰¾å‡ºç³»ç»Ÿä¸­ä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹" class="headerlink" title="æ‰¾å‡ºç³»ç»Ÿä¸­ä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹"></a>æ‰¾å‡ºç³»ç»Ÿä¸­ä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹</h2><h3 id="è¿è¡Œtopï¼Œ-æ‰¾å‡ºä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹ï¼ŒæŒ‰å¤§å†™çš„Pï¼Œå¯ä»¥æŒ‰CPUä½¿ç”¨ç‡æ¥æ’åºæ˜¾ç¤º"><a href="#è¿è¡Œtopï¼Œ-æ‰¾å‡ºä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹ï¼ŒæŒ‰å¤§å†™çš„Pï¼Œå¯ä»¥æŒ‰CPUä½¿ç”¨ç‡æ¥æ’åºæ˜¾ç¤º" class="headerlink" title="è¿è¡Œtopï¼Œ æ‰¾å‡ºä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹ï¼ŒæŒ‰å¤§å†™çš„Pï¼Œå¯ä»¥æŒ‰CPUä½¿ç”¨ç‡æ¥æ’åºæ˜¾ç¤º"></a>è¿è¡Œtopï¼Œ æ‰¾å‡ºä½¿ç”¨CPUæœ€å¤šçš„è¿›ç¨‹ï¼ŒæŒ‰å¤§å†™çš„Pï¼Œå¯ä»¥æŒ‰CPUä½¿ç”¨ç‡æ¥æ’åºæ˜¾ç¤º</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-01 ~]# top</span><br><span class="line">top - 10:48:16 up 1 day, 18:41,  2 users,  load average: 0.00, 0.04, 0.08</span><br><span class="line">Tasks: 111 total,   2 running, 109 sleeping,   0 stopped,   0 zombie</span><br><span class="line"><span class="meta">%</span><span class="bash">Cpu(s):  0.1 us,  0.1 sy,  0.0 ni, 99.8 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 </span></span><br><span class="line">KiB Mem : 16266520 total, 11269388 free,  2162204 used,  2834928 buff/cache</span><br><span class="line">KiB Swap:  2097148 total,  2097148 free,        0 used. 13687952 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND  </span><br><span class="line">17427 kibana    20   0 2515164   1.3g  10324 S   0.7  8.3   9:05.29 node     </span><br><span class="line">17255 elastic+  20   0 4713976 308280  15708 S   0.3  1.9  11:09.30 java</span><br></pre></td></tr></table></figure><h3 id="åœ¨linuxç³»ç»Ÿä¸­ä¸€ä¸ªè¿›ç¨‹ï¼Œæœ€å¤šå¯ä»¥ä½¿ç”¨100-cpuå¯¹å—ï¼Ÿ"><a href="#åœ¨linuxç³»ç»Ÿä¸­ä¸€ä¸ªè¿›ç¨‹ï¼Œæœ€å¤šå¯ä»¥ä½¿ç”¨100-cpuå¯¹å—ï¼Ÿ" class="headerlink" title="åœ¨linuxç³»ç»Ÿä¸­ä¸€ä¸ªè¿›ç¨‹ï¼Œæœ€å¤šå¯ä»¥ä½¿ç”¨100%cpuå¯¹å—ï¼Ÿ"></a>åœ¨linuxç³»ç»Ÿä¸­ä¸€ä¸ªè¿›ç¨‹ï¼Œæœ€å¤šå¯ä»¥ä½¿ç”¨100%cpuå¯¹å—ï¼Ÿ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# top</span><br><span class="line">top - 10:51:24 up 61 days, 23:00,  2 users,  load average: 46.56, 48.38, 34.85</span><br><span class="line">Tasks: 267 total,   1 running, 266 sleeping,   0 stopped,   0 zombie</span><br><span class="line">Cpu(s): 96.9%us,  1.6%sy,  0.0%ni,  0.3%id,  0.0%wa,  0.5%hi,  0.5%si,  0.2%st</span><br><span class="line">Mem:  71545156k total, 71079896k used,   465260k free,    58836k buffers</span><br><span class="line">Swap:  2097148k total,        0k used,  2097148k free, 18012268k cached</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND           </span><br><span class="line">13073 smgadmin  20   0 5451m 1.4g  21m S 130.5  2.0 184:57.92 java              </span><br><span class="line">30753 smgadmin  20   0 4801m 1.3g  21m S 92.7  2.0  20:14.24 java    </span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#å¯ä»¥çœ‹åˆ°javaï¼ˆè„ç‰›æ¼æ´ï¼Œç”¨äºææƒï¼‰ è¿›ç¨‹ä½¿ç”¨130.5%</span></span></span><br></pre></td></tr></table></figure><p><strong>æ³¨</strong></p><p>å¦‚æœä½ çš„4æ ¸å¿ƒçš„cpuï¼Œä½ å¯ä»¥è¿è¡Œ400%</p><h2 id="IsofæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ‰“å¼€çš„ç«¯å£-TCPã€UDP"><a href="#IsofæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ‰“å¼€çš„ç«¯å£-TCPã€UDP" class="headerlink" title="IsofæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ‰“å¼€çš„ç«¯å£(TCPã€UDP)"></a>IsofæŸ¥çœ‹è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼Œæ‰“å¼€æ–‡ä»¶çš„è¿›ç¨‹ï¼Œè¿›ç¨‹æ‰“å¼€çš„ç«¯å£(TCPã€UDP)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@docker-01 ~]# yum install lsof </span><br><span class="line">[root@docker-01 ~]# vim a.txt</span><br><span class="line">[root@docker-01 ~]# ps -axu | grep a.txt</span><br><span class="line">root     25526  0.0  0.0 151532  5200 pts/0    S+   10:55   0:00 vim a.txt</span><br><span class="line">root     25560  0.0  0.0 112724  1004 pts/1    S+   10:57   0:00 grep --color=auto a.txt</span><br><span class="line">[root@docker-01 ~]# lsof -p 25526  ##ä¸€èˆ¬ç”¨äºæŸ¥çœ‹æœ¨é©¬è¿›ç¨‹ï¼Œåœ¨è¯»å“ªäº›æ–‡ä»¶</span><br><span class="line">[root@docker-01 ~]# lsof -i :22  ##ç”¨äºæŸ¥çœ‹ç«¯å£ï¼Œæˆ–æŸ¥çœ‹é»‘å®¢å¼€å¯çš„åé—¨ç«¯å£æ˜¯å“ªä¸ªè¿›ç¨‹åœ¨ä½¿ç”¨</span><br></pre></td></tr></table></figure><h2 id="è¿›ç¨‹ä¼˜å…ˆçº§nice"><a href="#è¿›ç¨‹ä¼˜å…ˆçº§nice" class="headerlink" title="è¿›ç¨‹ä¼˜å…ˆçº§nice"></a>è¿›ç¨‹ä¼˜å…ˆçº§nice</h2><h3 id="è¿›ç¨‹è°ƒåº¦åŠå¤šä»»åŠ¡"><a href="#è¿›ç¨‹è°ƒåº¦åŠå¤šä»»åŠ¡" class="headerlink" title="è¿›ç¨‹è°ƒåº¦åŠå¤šä»»åŠ¡"></a>è¿›ç¨‹è°ƒåº¦åŠå¤šä»»åŠ¡</h3><p>æ¯ä¸ªCPUï¼ˆæˆ–CPUæ ¸å¿ƒï¼‰åœ¨ä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šåªèƒ½å¤„ç†ä¸€ä¸ªè¿›ç¨‹ï¼Œé€šè¿‡æ—¶é—´ç‰‡æŠ€æœ¯ï¼ŒLinuxå®é™…èƒ½å¤Ÿè¿è¡Œçš„è¿›ç¨‹ï¼ˆå’Œçº¿ç¨‹æ•°ï¼‰å¯ä»¥è¶…<br>å‡ºå®é™…å¯ç”¨çš„CPUåŠæ ¸å¿ƒæ•°é‡ã€‚Linuxå†…æ ¸<strong>è¿›ç¨‹è°ƒåº¦ç¨‹åº</strong>å°†å¤šä¸ªè¿›ç¨‹åœ¨CPUæ ¸å¿ƒä¸Šå¿«é€Ÿåˆ‡æ¢ï¼Œä»è€Œç»™ç”¨æˆ·å¤šä¸ªè¿›ç¨‹åœ¨åŒæ—¶è¿è¡Œçš„å°è±¡ã€‚</p><h3 id="ç›¸å¯¹ä¼˜å…ˆçº§-nice"><a href="#ç›¸å¯¹ä¼˜å…ˆçº§-nice" class="headerlink" title="ç›¸å¯¹ä¼˜å…ˆçº§ nice"></a>ç›¸å¯¹ä¼˜å…ˆçº§ nice</h3><p>ç”±äºä¸æ˜¯æ¯ä¸ªè¿›ç¨‹éƒ½ä¸å…¶ä»–è¿›ç¨‹åŒæ ·é‡è¦ï¼Œå¯å‘ŠçŸ¥<strong>è¿›ç¨‹è°ƒåº¦ç¨‹åº</strong>ä¸ºä¸åŒçš„è¿›ç¨‹ä½¿ç”¨ä¸åŒçš„<strong>è°ƒåº¦ç­–ç•¥</strong>ã€‚å¸¸è§„ç³»ç»Ÿä¸Šè¿è¡Œçš„å¤§å¤š<br>æ•°è¿›ç¨‹æ‰€ä½¿ç”¨çš„è°ƒåº¦ç­–ç•¥ä¸º <strong>SCHED_OTHER</strong> (ä¹Ÿç§°ä¸ºSCHED_NORMAL)ï¼Œä½†è¿˜æœ‰å…¶å®ƒä¸€äº›è°ƒåº¦ç­–ç•¥ç”¨äºä¸åŒçš„ç›®çš„ã€‚</p><p>SCHED_OTHER è°ƒåº¦ç­–ç•¥è¿è¡Œçš„è¿›ç¨‹çš„<strong>ç›¸å¯¹ä¼˜å…ˆçº§</strong>ç§°ä¸ºè¿›ç¨‹çš„ nice å€¼ï¼Œå¯ä»¥æœ‰40ç§ä¸åŒçº§åˆ«çš„niceå€¼ã€‚</p><p><img src="641.png" alt="Centos7-ç³»ç»Ÿè¿›ç¨‹ç®¡ç†"></p><p><strong>nice å€¼è¶Šé«˜ï¼š è¡¨ç¤ºä¼˜å…ˆçº§è¶Šä½ï¼Œä¾‹å¦‚+19ï¼Œè¯¥è¿›ç¨‹å®¹æ˜“å°†CPU ä½¿ç”¨é‡è®©ç»™å…¶ä»–è¿›ç¨‹ã€‚</strong><br><strong>nice å€¼è¶Šä½ï¼š è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ï¼Œä¾‹å¦‚-20ï¼Œè¯¥è¿›ç¨‹æ›´ä¸å€¾å‘äºè®©å‡ºCPUã€‚</strong></p><h3 id="niceå¯åŠ¨çº§åˆ«çš„è®¾ç½®"><a href="#niceå¯åŠ¨çº§åˆ«çš„è®¾ç½®" class="headerlink" title="niceå¯åŠ¨çº§åˆ«çš„è®¾ç½®"></a>niceå¯åŠ¨çº§åˆ«çš„è®¾ç½®</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#å¯åŠ¨è¿›ç¨‹æ—¶ï¼Œé€šå¸¸ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹çš„ niceçº§åˆ«ï¼Œé»˜è®¤ä¸º0ã€‚</span></span></span><br><span class="line">[root@docker-01 ~]# sleep 6000 &amp; </span><br><span class="line">[1] 25601</span><br><span class="line">[root@docker-01 ~]# ps axo command,pid,nice |grep sleep</span><br><span class="line">sleep 6000                  25601   0</span><br><span class="line">grep --color=auto sleep     25603   0</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#æŒ‡å®šå¯åŠ¨çº§åˆ«ä¸º5</span></span></span><br><span class="line">[root@docker-01 ~]# nice -n 5 sleep 6000 &amp; </span><br><span class="line">[2] 25605</span><br><span class="line">[1]   å·²æ€æ­»               sleep 6000</span><br><span class="line">[root@docker-01 ~]# ps axo command,pid,nice |grep sleep</span><br><span class="line">sleep 6000                  25605   5</span><br><span class="line">grep --color=auto sleep     25607   0</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#æ›´æ”¹ç°æœ‰è¿›ç¨‹çš„niceçº§åˆ«</span></span></span><br><span class="line">25605 (è¿›ç¨‹ ID) æ—§ä¼˜å…ˆçº§ä¸º 5ï¼Œæ–°ä¼˜å…ˆçº§ä¸º -15</span><br><span class="line">[root@docker-01 ~]# ps axo command,pid,nice |grep sleep</span><br><span class="line">sleep 6000                  25605 -15</span><br><span class="line">grep --color=auto sleep     25611   0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux_application </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux_application </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
